<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç›´æ¥ç™»å½•æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .result { margin: 10px 0; padding: 10px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        input { margin: 5px; padding: 5px; width: 200px; }
        button { padding: 10px 15px; margin: 5px; }
        pre { background: #f8f9fa; padding: 10px; overflow-x: auto; max-height: 300px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>ğŸ” ç›´æ¥ç™»å½•æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>ä½¿ç”¨ authStore.loginUser</h2>
        <input type="text" id="studentId" value="20210001" placeholder="å­¦å·">
        <input type="password" id="password" value="123456" placeholder="å¯†ç ">
        <button onclick="testAuthStoreLogin()">æµ‹è¯• authStore ç™»å½•</button>
        <div id="authStoreResult"></div>
    </div>

    <div class="test-section">
        <h2>ç›´æ¥è°ƒç”¨ API</h2>
        <button onclick="testDirectAPI()">æµ‹è¯•ç›´æ¥ API è°ƒç”¨</button>
        <div id="directAPIResult"></div>
    </div>

    <div class="test-section">
        <h2>æµ‹è¯•ç©ºå­¦å·</h2>
        <button onclick="testEmptyStudentId()">æµ‹è¯•ç©ºå­¦å·ç™»å½•</button>
        <div id="emptyResult"></div>
    </div>

    <script type="module">
        import { validateLoginParams } from './src/utils/validation.js'
        import { login } from './src/api/auth.js'
        import { validatedApi } from './src/api/index.js'
        
        window.testAuthStoreLogin = async function() {
            const studentId = document.getElementById('studentId').value
            const password = document.getElementById('password').value
            const resultDiv = document.getElementById('authStoreResult')
            
            resultDiv.innerHTML = '<div class="result">æ¨¡æ‹Ÿ authStore ç™»å½•ä¸­...</div>'
            
            try {
                console.log('ğŸ” å¼€å§‹æ¨¡æ‹Ÿ authStore.loginUser')
                console.log('ğŸ“ å‚æ•°:', { studentId, password })
                
                // æ¨¡æ‹Ÿ authStore.loginUser çš„é€»è¾‘
                const credentials = { studentId, password, rememberMe: false }
                console.log('ğŸ“ æ„é€ çš„ç™»å½•å‡­æ®:', credentials)
                
                const response = await validatedApi.login(credentials)
                console.log('âœ… æ¨¡æ‹Ÿ authStore ç™»å½•æˆåŠŸ:', response)
                
                resultDiv.innerHTML = `<div class="result success">
                    <strong>æ¨¡æ‹Ÿ authStore ç™»å½•æˆåŠŸ!</strong><br>
                    <pre>${JSON.stringify(response, null, 2)}</pre>
                </div>`
            } catch (error) {
                console.error('âŒ æ¨¡æ‹Ÿ authStore ç™»å½•å¤±è´¥:', error)
                
                resultDiv.innerHTML = `<div class="result error">
                    <strong>æ¨¡æ‹Ÿ authStore ç™»å½•å¤±è´¥!</strong><br>
                    <pre>é”™è¯¯: ${error.message || error}
é”™è¯¯è¯¦æƒ…: ${error.stack || 'æ— å †æ ˆä¿¡æ¯'}</pre>
                </div>`
            }
        }
        
        window.testDirectAPI = async function() {
            const studentId = document.getElementById('studentId').value
            const password = document.getElementById('password').value
            const resultDiv = document.getElementById('directAPIResult')
            
            resultDiv.innerHTML = '<div class="result">ç›´æ¥è°ƒç”¨ API ä¸­...</div>'
            
            try {
                console.log('ğŸ” å¼€å§‹æµ‹è¯•ç›´æ¥ API è°ƒç”¨')
                
                // æ­¥éª¤1: éªŒè¯å‚æ•°
                const credentials = { studentId, password, rememberMe: false }
                console.log('ğŸ“ ç™»å½•å‡­æ®:', credentials)
                
                const validatedCredentials = await validateLoginParams(credentials)
                console.log('âœ… éªŒè¯åçš„å‡­æ®:', validatedCredentials)
                
                // æ­¥éª¤2: è°ƒç”¨ç™»å½•API
                const result = await login(validatedCredentials)
                console.log('âœ… ç›´æ¥ API è°ƒç”¨æˆåŠŸ:', result)
                
                resultDiv.innerHTML = `<div class="result success">
                    <strong>ç›´æ¥ API è°ƒç”¨æˆåŠŸ!</strong><br>
                    <pre>éªŒè¯åå‡­æ®: ${JSON.stringify(validatedCredentials, null, 2)}
ç™»å½•ç»“æœ: ${JSON.stringify(result, null, 2)}</pre>
                </div>`
            } catch (error) {
                console.error('âŒ ç›´æ¥ API è°ƒç”¨å¤±è´¥:', error)
                
                resultDiv.innerHTML = `<div class="result error">
                    <strong>ç›´æ¥ API è°ƒç”¨å¤±è´¥!</strong><br>
                    <pre>é”™è¯¯: ${error.message || error}
é”™è¯¯è¯¦æƒ…: ${error.stack || 'æ— å †æ ˆä¿¡æ¯'}</pre>
                </div>`
            }
        }
        
        window.testEmptyStudentId = async function() {
            const resultDiv = document.getElementById('emptyResult')
            
            resultDiv.innerHTML = '<div class="result">æµ‹è¯•ç©ºå­¦å·ç™»å½•...</div>'
            
            try {
                console.log('ğŸ” å¼€å§‹æµ‹è¯•ç©ºå­¦å·ç™»å½•')
                
                const credentials = { studentId: '', password: '123456', rememberMe: false }
                console.log('ğŸ“ ç©ºå­¦å·ç™»å½•å‡­æ®:', credentials)
                
                const validatedCredentials = await validateLoginParams(credentials)
                console.log('âœ… éªŒè¯é€šè¿‡ (ä¸åº”è¯¥å‘ç”Ÿ):', validatedCredentials)
                
                resultDiv.innerHTML = `<div class="result error">
                    <strong>æ„å¤–: ç©ºå­¦å·éªŒè¯é€šè¿‡äº†!</strong><br>
                    <pre>${JSON.stringify(validatedCredentials, null, 2)}</pre>
                </div>`
            } catch (error) {
                console.error('âŒ ç©ºå­¦å·éªŒè¯å¤±è´¥ (é¢„æœŸè¡Œä¸º):', error)
                
                resultDiv.innerHTML = `<div class="result success">
                    <strong>ç©ºå­¦å·æ­£ç¡®è¢«æ‹’ç» (é¢„æœŸè¡Œä¸º)</strong><br>
                    <pre>é”™è¯¯: ${error.message || error}</pre>
                </div>`
            }
        }
    </script>
</body>
</html>