<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¨¡æ‹Ÿç™»å½•é¡µé¢æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .result { margin: 10px 0; padding: 10px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        input { margin: 5px; padding: 8px; width: 200px; border: 1px solid #ccc; border-radius: 4px; }
        button { padding: 10px 15px; margin: 5px; background: #1989fa; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #1677ff; }
        pre { background: #f8f9fa; padding: 10px; overflow-x: auto; max-height: 300px; overflow-y: auto; }
        .form-group { margin: 15px 0; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
    </style>
</head>
<body>
    <h1>ğŸ” æ¨¡æ‹Ÿç™»å½•é¡µé¢æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>æ¨¡æ‹Ÿç™»å½•è¡¨å•</h2>
        <div class="form-group">
            <label for="studentId">å­¦å·:</label>
            <input type="text" id="studentIdInput" placeholder="è¯·è¾“å…¥å­¦å·" oninput="updateStudentId()">
        </div>
        <div class="form-group">
            <label for="password">å¯†ç :</label>
            <input type="password" id="passwordInput" placeholder="è¯·è¾“å…¥å¯†ç " oninput="updatePassword()">
        </div>
        <button onclick="simulateLogin()">æ¨¡æ‹Ÿç™»å½•</button>
        <button onclick="clearForm()">æ¸…ç©ºè¡¨å•</button>
        <div id="formResult"></div>
    </div>

    <div class="test-section">
        <h2>å½“å‰è¡¨å•çŠ¶æ€</h2>
        <div id="formState"></div>
    </div>

    <script type="module">
        import { validateLoginParams } from './src/utils/validation.js'
        import { validatedApi } from './src/api/index.js'
        
        // æ¨¡æ‹Ÿ Vue çš„å“åº”å¼æ•°æ®
        let form = {
            studentId: '',
            password: ''
        }
        
        window.updateStudentId = function() {
            const input = document.getElementById('studentIdInput')
            form.studentId = input.value
            updateFormState()
        }
        
        window.updatePassword = function() {
            const input = document.getElementById('passwordInput')
            form.password = input.value
            updateFormState()
        }
        
        window.updateFormState = function() {
            const stateDiv = document.getElementById('formState')
            stateDiv.innerHTML = `
                <pre>å½“å‰è¡¨å•æ•°æ®:
{
  studentId: "${form.studentId}",
  password: "${form.password}"
}

studentId ç±»å‹: ${typeof form.studentId}
studentId é•¿åº¦: ${form.studentId.length}
studentId æ˜¯å¦ä¸ºç©º: ${!form.studentId}

password ç±»å‹: ${typeof form.password}
password é•¿åº¦: ${form.password.length}
password æ˜¯å¦ä¸ºç©º: ${!form.password}</pre>
            `
        }
        
        window.clearForm = function() {
            form.studentId = ''
            form.password = ''
            document.getElementById('studentIdInput').value = ''
            document.getElementById('passwordInput').value = ''
            updateFormState()
        }
        
        window.simulateLogin = async function() {
            const resultDiv = document.getElementById('formResult')
            
            console.log('ğŸ” å¼€å§‹æ¨¡æ‹Ÿç™»å½•æµç¨‹')
            console.log('ğŸ“ è¡¨å•æ•°æ®:', form)
            
            // è¯¦ç»†è°ƒè¯•è¡¨å•æ•°æ®
            console.log('ğŸ” è¯¦ç»†è°ƒè¯•:')
            console.log('- form ç±»å‹:', typeof form)
            console.log('- form.studentId:', form.studentId)
            console.log('- form.studentId ç±»å‹:', typeof form.studentId)
            console.log('- form.studentId é•¿åº¦:', form.studentId ? form.studentId.length : 'N/A')
            console.log('- form.password:', form.password)
            console.log('- form.password ç±»å‹:', typeof form.password)
            console.log('- form.password é•¿åº¦:', form.password ? form.password.length : 'N/A')
            
            // ç®€å•éªŒè¯
            if (!form.studentId) {
                console.log('âŒ å­¦å·ä¸ºç©ºï¼Œæ˜¾ç¤ºæç¤º')
                resultDiv.innerHTML = `<div class="result error">
                    <strong>ç™»å½•å¤±è´¥!</strong><br>
                    è¯·å¡«å†™å­¦å·
                </div>`
                return
            }
            if (!form.password) {
                console.log('âŒ å¯†ç ä¸ºç©ºï¼Œæ˜¾ç¤ºæç¤º')
                resultDiv.innerHTML = `<div class="result error">
                    <strong>ç™»å½•å¤±è´¥!</strong><br>
                    è¯·å¡«å†™å¯†ç 
                </div>`
                return
            }
            
            console.log('âœ… å‰ç«¯éªŒè¯é€šè¿‡ï¼Œå¼€å§‹è°ƒç”¨ç™»å½•API')
            resultDiv.innerHTML = '<div class="result">ç™»å½•ä¸­...</div>'
            
            try {
                console.log('ğŸ” è°ƒç”¨ç™»å½•APIå‚æ•°:')
                console.log('- studentId:', form.studentId)
                console.log('- password:', form.password)
                
                // æ„é€ ç™»å½•å‡­æ®
                const credentials = { studentId: form.studentId, password: form.password, rememberMe: false }
                console.log('ğŸ“ æ„é€ çš„ç™»å½•å‡­æ®:', credentials)
                
                const response = await validatedApi.login(credentials)
                console.log('âœ… ç™»å½•APIå“åº”:', response)
                
                resultDiv.innerHTML = `<div class="result success">
                    <strong>ç™»å½•æˆåŠŸ!</strong><br>
                    <pre>${JSON.stringify(response, null, 2)}</pre>
                </div>`
            } catch (error) {
                console.error('âŒ ç™»å½•é”™è¯¯:', error)
                console.error('âŒ é”™è¯¯ç±»å‹:', typeof error)
                console.error('âŒ é”™è¯¯æ¶ˆæ¯:', error.message)
                console.error('âŒ é”™è¯¯è¯¦æƒ…:', error)
                
                resultDiv.innerHTML = `<div class="result error">
                    <strong>ç™»å½•å¤±è´¥!</strong><br>
                    <pre>é”™è¯¯: ${error.message || error}
é”™è¯¯è¯¦æƒ…: ${error.stack || 'æ— å †æ ˆä¿¡æ¯'}</pre>
                </div>`
            }
        }
        
        // åˆå§‹åŒ–è¡¨å•çŠ¶æ€æ˜¾ç¤º
        updateFormState()
    </script>
</body>
</html>