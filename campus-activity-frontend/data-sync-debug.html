<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°æ®åŒæ­¥é—®é¢˜è¯Šæ–­</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            background: #f5f5f5;
        }
        .container { 
            max-width: 800px; 
            margin: 0 auto; 
            background: white; 
            padding: 20px; 
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .section { 
            margin: 20px 0; 
            padding: 15px; 
            border: 1px solid #ddd; 
            border-radius: 5px;
            background: #fafafa;
        }
        .log { 
            background: #f8f9fa; 
            border: 1px solid #dee2e6; 
            padding: 10px; 
            margin: 10px 0; 
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        button { 
            padding: 10px 20px; 
            margin: 5px; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer;
            background: #007bff;
            color: white;
        }
        button:hover { background: #0056b3; }
        button.danger { background: #dc3545; }
        button.danger:hover { background: #c82333; }
        button.success { background: #28a745; }
        button.success:hover { background: #218838; }
        .activity-item {
            background: white;
            border: 1px solid #ddd;
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
        }
        .activity-title { font-weight: bold; color: #333; }
        .activity-info { font-size: 14px; color: #666; margin-top: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” æ´»åŠ¨æ•°æ®åŒæ­¥é—®é¢˜è¯Šæ–­å·¥å…·</h1>
        
        <div class="section">
            <h3>ğŸ“Š å½“å‰æ•°æ®çŠ¶æ€</h3>
            <div id="dataStatus">æ£€æŸ¥ä¸­...</div>
        </div>

        <div class="section">
            <h3>ğŸ”§ æµ‹è¯•æ“ä½œ</h3>
            <button onclick="checkLocalStorage()">æ£€æŸ¥localStorageæ•°æ®</button>
            <button onclick="simulateCreateActivity()">æ¨¡æ‹Ÿåˆ›å»ºæ´»åŠ¨</button>
            <button onclick="simulateDataRefresh()">æ¨¡æ‹Ÿæ•°æ®åˆ·æ–°</button>
            <button onclick="clearAllData()" class="danger">æ¸…ç©ºæ‰€æœ‰æ•°æ®</button>
            <button onclick="initDefaultData()" class="success">åˆå§‹åŒ–é»˜è®¤æ•°æ®</button>
        </div>

        <div class="section">
            <h3>ğŸ“‹ å½“å‰æ´»åŠ¨åˆ—è¡¨</h3>
            <div id="activityList">åŠ è½½ä¸­...</div>
        </div>

        <div class="section">
            <h3>ğŸ“ æ“ä½œæ—¥å¿—</h3>
            <div id="log" class="log"></div>
        </div>
    </div>

    <script>
        let logContainer = document.getElementById('log');
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            logContainer.textContent += `[${timestamp}] ${message}\n`;
            logContainer.scrollTop = logContainer.scrollHeight;
            console.log(message);
        }

        function checkLocalStorage() {
            log('ğŸ” æ£€æŸ¥localStorageæ•°æ®...');
            
            try {
                const activitiesData = localStorage.getItem('campus_activities');
                if (activitiesData) {
                    const activities = JSON.parse(activitiesData);
                    log(`âœ… localStorageä¸­æœ‰ ${activities.length} ä¸ªæ´»åŠ¨`);
                    activities.forEach((activity, index) => {
                        log(`  ${index + 1}. ${activity.title} (ID: ${activity.id})`);
                    });
                } else {
                    log('âŒ localStorageä¸­æ²¡æœ‰æ´»åŠ¨æ•°æ®');
                }
            } catch (error) {
                log(`âŒ è¯»å–localStorageå¤±è´¥: ${error.message}`);
            }
            
            updateDataStatus();
            updateActivityList();
        }

        function simulateCreateActivity() {
            log('ğŸ¯ æ¨¡æ‹Ÿåˆ›å»ºæ´»åŠ¨...');
            
            try {
                // è·å–å½“å‰æ´»åŠ¨æ•°æ®
                let activities = [];
                const existingData = localStorage.getItem('campus_activities');
                if (existingData) {
                    activities = JSON.parse(existingData);
                }
                
                // åˆ›å»ºæ–°æ´»åŠ¨
                const newActivity = {
                    id: Date.now().toString(), // ä½¿ç”¨æ—¶é—´æˆ³ä½œä¸ºID
                    title: `æµ‹è¯•æ´»åŠ¨_${new Date().toLocaleTimeString()}`,
                    type: 'test',
                    category: 'test',
                    locationName: 'æµ‹è¯•åœ°ç‚¹',
                    description: 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•åˆ›å»ºçš„æ´»åŠ¨',
                    startTime: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString(),
                    endTime: new Date(Date.now() + 26 * 60 * 60 * 1000).toISOString(),
                    currentParticipants: 1,
                    maxParticipants: 20,
                    organizer: { id: 1, name: 'æµ‹è¯•ç”¨æˆ·', creditScore: 80 },
                    distance: 0,
                    isEnrolled: false,
                    status: 'open',
                    createdAt: new Date().toISOString()
                };
                
                // æ·»åŠ åˆ°æ´»åŠ¨åˆ—è¡¨å¼€å¤´
                activities.unshift(newActivity);
                
                // ä¿å­˜åˆ°localStorage
                localStorage.setItem('campus_activities', JSON.stringify(activities));
                
                log(`âœ… æˆåŠŸåˆ›å»ºæ´»åŠ¨: ${newActivity.title} (ID: ${newActivity.id})`);
                log(`ğŸ“Š å½“å‰æ´»åŠ¨æ€»æ•°: ${activities.length}`);
                
            } catch (error) {
                log(`âŒ åˆ›å»ºæ´»åŠ¨å¤±è´¥: ${error.message}`);
            }
            
            updateDataStatus();
            updateActivityList();
        }

        function simulateDataRefresh() {
            log('ğŸ”„ æ¨¡æ‹Ÿæ•°æ®åˆ·æ–°...');
            
            // æ¨¡æ‹Ÿstore.loadActivities()çš„è¡Œä¸º
            try {
                const activitiesData = localStorage.getItem('campus_activities');
                if (activitiesData) {
                    const activities = JSON.parse(activitiesData);
                    log(`âœ… ä»localStorageé‡æ–°åŠ è½½äº† ${activities.length} ä¸ªæ´»åŠ¨`);
                } else {
                    log('âŒ localStorageä¸­æ²¡æœ‰æ•°æ®å¯åˆ·æ–°');
                }
            } catch (error) {
                log(`âŒ æ•°æ®åˆ·æ–°å¤±è´¥: ${error.message}`);
            }
            
            updateDataStatus();
            updateActivityList();
        }

        function clearAllData() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ´»åŠ¨æ•°æ®å—ï¼Ÿ')) {
                log('ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰æ•°æ®...');
                localStorage.removeItem('campus_activities');
                log('âœ… æ•°æ®å·²æ¸…ç©º');
                updateDataStatus();
                updateActivityList();
            }
        }

        function initDefaultData() {
            log('ğŸ“¦ åˆå§‹åŒ–é»˜è®¤æ•°æ®...');
            
            const defaultActivities = [
                {
                    id: "1",
                    title: 'ä¸­åŒ»å…»ç”Ÿè®²åº§',
                    type: 'study',
                    category: 'study',
                    locationName: 'å­¦æœ¯æŠ¥å‘Šå…',
                    description: 'é‚€è¯·ä¸­åŒ»ä¸“å®¶è®²è§£ä¸­åŒ»å…»ç”ŸçŸ¥è¯†',
                    startTime: new Date(Date.now() + 2 * 24 * 60 * 60 * 1000).toISOString(),
                    endTime: new Date(Date.now() + 2 * 24 * 60 * 60 * 1000 + 2 * 60 * 60 * 1000).toISOString(),
                    currentParticipants: 15,
                    maxParticipants: 30,
                    organizer: { id: 2, name: 'ä¸­åŒ»å­¦é™¢', creditScore: 98 },
                    distance: 0.8,
                    isEnrolled: false,
                    status: 'open'
                },
                {
                    id: "2",
                    title: 'æ‘„å½±ä½œå“å±•è§ˆ',
                    type: 'culture',
                    category: 'culture',
                    locationName: 'è‰ºæœ¯å±•å…',
                    description: 'å±•ç¤ºå­¦ç”Ÿæ‘„å½±ä½œå“',
                    startTime: new Date(Date.now() + 3 * 24 * 60 * 60 * 1000).toISOString(),
                    endTime: new Date(Date.now() + 3 * 24 * 60 * 60 * 1000 + 3 * 60 * 60 * 1000).toISOString(),
                    currentParticipants: 12,
                    maxParticipants: 25,
                    organizer: { id: 3, name: 'æ‘„å½±åä¼š', creditScore: 92 },
                    distance: 0.3,
                    isEnrolled: false,
                    status: 'open'
                }
            ];
            
            try {
                localStorage.setItem('campus_activities', JSON.stringify(defaultActivities));
                log(`âœ… æˆåŠŸåˆå§‹åŒ– ${defaultActivities.length} ä¸ªé»˜è®¤æ´»åŠ¨`);
            } catch (error) {
                log(`âŒ åˆå§‹åŒ–å¤±è´¥: ${error.message}`);
            }
            
            updateDataStatus();
            updateActivityList();
        }

        function updateDataStatus() {
            const statusDiv = document.getElementById('dataStatus');
            try {
                const activitiesData = localStorage.getItem('campus_activities');
                if (activitiesData) {
                    const activities = JSON.parse(activitiesData);
                    statusDiv.innerHTML = `
                        <p><strong>localStorageçŠ¶æ€:</strong> âœ… æœ‰æ•°æ®</p>
                        <p><strong>æ´»åŠ¨æ•°é‡:</strong> ${activities.length}</p>
                        <p><strong>æ•°æ®å¤§å°:</strong> ${activitiesData.length} å­—ç¬¦</p>
                        <p><strong>æœ€åæ›´æ–°:</strong> ${new Date().toLocaleString()}</p>
                    `;
                } else {
                    statusDiv.innerHTML = `
                        <p><strong>localStorageçŠ¶æ€:</strong> âŒ æ— æ•°æ®</p>
                        <p><strong>æ´»åŠ¨æ•°é‡:</strong> 0</p>
                        <p><strong>å»ºè®®:</strong> ç‚¹å‡»"åˆå§‹åŒ–é»˜è®¤æ•°æ®"</p>
                    `;
                }
            } catch (error) {
                statusDiv.innerHTML = `
                    <p><strong>localStorageçŠ¶æ€:</strong> âŒ æ•°æ®æŸå</p>
                    <p><strong>é”™è¯¯:</strong> ${error.message}</p>
                `;
            }
        }

        function updateActivityList() {
            const listDiv = document.getElementById('activityList');
            try {
                const activitiesData = localStorage.getItem('campus_activities');
                if (activitiesData) {
                    const activities = JSON.parse(activitiesData);
                    if (activities.length === 0) {
                        listDiv.innerHTML = '<p>æš‚æ— æ´»åŠ¨</p>';
                    } else {
                        listDiv.innerHTML = activities.map(activity => `
                            <div class="activity-item">
                                <div class="activity-title">${activity.title}</div>
                                <div class="activity-info">
                                    ID: ${activity.id} | ç±»å‹: ${activity.type} | åœ°ç‚¹: ${activity.locationName}<br>
                                    å‚ä¸è€…: ${activity.currentParticipants}/${activity.maxParticipants} | çŠ¶æ€: ${activity.status}
                                </div>
                            </div>
                        `).join('');
                    }
                } else {
                    listDiv.innerHTML = '<p>localStorageä¸­æ²¡æœ‰æ´»åŠ¨æ•°æ®</p>';
                }
            } catch (error) {
                listDiv.innerHTML = `<p>è¯»å–æ´»åŠ¨æ•°æ®å¤±è´¥: ${error.message}</p>`;
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
        window.onload = function() {
            log('ğŸš€ æ•°æ®åŒæ­¥è¯Šæ–­å·¥å…·å·²å¯åŠ¨');
            checkLocalStorage();
        };
    </script>
</body>
</html>