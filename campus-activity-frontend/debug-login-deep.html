<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç™»å½•é—®é¢˜æ·±åº¦è°ƒè¯•</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 8px; }
        .result { margin: 10px 0; padding: 10px; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        input { margin: 5px; padding: 8px; width: 200px; border: 1px solid #ccc; border-radius: 4px; }
        button { padding: 10px 15px; margin: 5px; background: #1989fa; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #1677ff; }
        pre { background: #f8f9fa; padding: 10px; overflow-x: auto; max-height: 300px; overflow-y: auto; border-radius: 4px; }
        .form-group { margin: 15px 0; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        .step { margin: 10px 0; padding: 10px; background: #e9ecef; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>ğŸ” ç™»å½•é—®é¢˜æ·±åº¦è°ƒè¯•</h1>
    
    <div class="test-section">
        <h2>ğŸ“ æµ‹è¯•è¡¨å•</h2>
        <div class="form-group">
            <label for="studentId">å­¦å·:</label>
            <input type="text" id="studentIdInput" placeholder="è¯·è¾“å…¥å­¦å·" value="20210001">
        </div>
        <div class="form-group">
            <label for="password">å¯†ç :</label>
            <input type="password" id="passwordInput" placeholder="è¯·è¾“å…¥å¯†ç " value="123456">
        </div>
        <button onclick="testStep1()">æ­¥éª¤1: æ£€æŸ¥è¡¨å•æ•°æ®</button>
        <button onclick="testStep2()">æ­¥éª¤2: æµ‹è¯•éªŒè¯å‡½æ•°</button>
        <button onclick="testStep3()">æ­¥éª¤3: æµ‹è¯•ç™»å½•API</button>
        <button onclick="testFullFlow()">å®Œæ•´æµç¨‹æµ‹è¯•</button>
        <div id="testResults"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ”§ æ‰‹åŠ¨æµ‹è¯•</h2>
        <button onclick="testEmptyStudentId()">æµ‹è¯•ç©ºå­¦å·</button>
        <button onclick="testValidStudentId()">æµ‹è¯•æœ‰æ•ˆå­¦å·</button>
        <button onclick="testSpecialCharacters()">æµ‹è¯•ç‰¹æ®Šå­—ç¬¦</button>
        <button onclick="clearResults()">æ¸…ç©ºç»“æœ</button>
    </div>

    <script type="module">
        import { validateLoginParams } from './src/utils/validation.js'
        import { validatedApi } from './src/api/index.js'
        
        // æ¨¡æ‹Ÿè¡¨å•æ•°æ®ç»“æ„
        let form = {
            studentId: '',
            password: ''
        }
        
        function addResult(message, type = 'info') {
            const resultsDiv = document.getElementById('testResults')
            const resultDiv = document.createElement('div')
            resultDiv.className = `result ${type}`
            resultDiv.innerHTML = message
            resultsDiv.appendChild(resultDiv)
        }
        
        window.testStep1 = function() {
            addResult('<h3>æ­¥éª¤1: æ£€æŸ¥è¡¨å•æ•°æ®</h3>')
            
            // è·å–è¾“å…¥æ¡†å€¼
            const studentIdInput = document.getElementById('studentIdInput')
            const passwordInput = document.getElementById('passwordInput')
            
            // æ›´æ–°è¡¨å•æ•°æ®
            form.studentId = studentIdInput.value
            form.password = passwordInput.value
            
            addResult(`<div class="step">
                <strong>è¡¨å•æ•°æ®è·å–:</strong><br>
                è¾“å…¥æ¡†å€¼: "${studentIdInput.value}"<br>
                è¡¨å•studentId: "${form.studentId}"<br>
                è¡¨å•password: "${form.password}"<br>
                studentIdç±»å‹: ${typeof form.studentId}<br>
                studentIdé•¿åº¦: ${form.studentId.length}<br>
                studentIdæ˜¯å¦ä¸ºç©º: ${!form.studentId}<br>
                studentIdæ˜¯å¦ä¸ºç©ºå­—ç¬¦ä¸²: ${form.studentId === ''}<br>
                studentIdæ˜¯å¦ä¸ºnull: ${form.studentId === null}<br>
                studentIdæ˜¯å¦ä¸ºundefined: ${form.studentId === undefined}
            </div>`, 'info')
        }
        
        window.testStep2 = function() {
            addResult('<h3>æ­¥éª¤2: æµ‹è¯•éªŒè¯å‡½æ•°</h3>')
            
            try {
                const params = {
                    studentId: form.studentId,
                    password: form.password
                }
                
                addResult(`<div class="step">
                    <strong>è°ƒç”¨éªŒè¯å‡½æ•°å‚æ•°:</strong><br>
                    <pre>${JSON.stringify(params, null, 2)}</pre>
                </div>`, 'info')
                
                const validatedParams = validateLoginParams(params)
                
                addResult(`<div class="step">
                    <strong>éªŒè¯é€šè¿‡!</strong><br>
                    <pre>${JSON.stringify(validatedParams, null, 2)}</pre>
                </div>`, 'success')
            } catch (error) {
                addResult(`<div class="step">
                    <strong>éªŒè¯å¤±è´¥!</strong><br>
                    é”™è¯¯: ${error.message}<br>
                    é”™è¯¯ç±»å‹: ${typeof error}<br>
                    <pre>${error.stack || 'æ— å †æ ˆä¿¡æ¯'}</pre>
                </div>`, 'error')
            }
        }
        
        window.testStep3 = async function() {
            addResult('<h3>æ­¥éª¤3: æµ‹è¯•ç™»å½•API</h3>')
            
            try {
                const credentials = {
                    studentId: form.studentId,
                    password: form.password,
                    rememberMe: false
                }
                
                addResult(`<div class="step">
                    <strong>è°ƒç”¨ç™»å½•APIå‚æ•°:</strong><br>
                    <pre>${JSON.stringify(credentials, null, 2)}</pre>
                </div>`, 'info')
                
                const response = await validatedApi.login(credentials)
                
                addResult(`<div class="step">
                    <strong>ç™»å½•APIè°ƒç”¨æˆåŠŸ!</strong><br>
                    <pre>${JSON.stringify(response, null, 2)}</pre>
                </div>`, 'success')
            } catch (error) {
                addResult(`<div class="step">
                    <strong>ç™»å½•APIè°ƒç”¨å¤±è´¥!</strong><br>
                    é”™è¯¯: ${error.message}<br>
                    é”™è¯¯ç±»å‹: ${typeof error}<br>
                    é”™è¯¯è¯¦æƒ…: ${JSON.stringify(error, null, 2)}<br>
                    <pre>${error.stack || 'æ— å †æ ˆä¿¡æ¯'}</pre>
                </div>`, 'error')
            }
        }
        
        window.testFullFlow = async function() {
            addResult('<h3>å®Œæ•´æµç¨‹æµ‹è¯•</h3>')
            
            // æ­¥éª¤1: è·å–è¡¨å•æ•°æ®
            const studentIdInput = document.getElementById('studentIdInput')
            const passwordInput = document.getElementById('passwordInput')
            form.studentId = studentIdInput.value
            form.password = passwordInput.value
            
            addResult(`<div class="step">
                <strong>1. è¡¨å•æ•°æ®:</strong><br>
                studentId: "${form.studentId}"<br>
                password: "${form.password}"
            </div>`, 'info')
            
            // æ­¥éª¤2: éªŒè¯
            try {
                const validatedParams = validateLoginParams({
                    studentId: form.studentId,
                    password: form.password
                })
                addResult(`<div class="step">
                    <strong>2. éªŒè¯é€šè¿‡:</strong><br>
                    ${JSON.stringify(validatedParams)}
                </div>`, 'success')
            } catch (error) {
                addResult(`<div class="step">
                    <strong>2. éªŒè¯å¤±è´¥:</strong><br>
                    ${error.message}
                </div>`, 'error')
                return
            }
            
            // æ­¥éª¤3: ç™»å½•API
            try {
                const response = await validatedApi.login({
                    studentId: form.studentId,
                    password: form.password,
                    rememberMe: false
                })
                addResult(`<div class="step">
                    <strong>3. ç™»å½•æˆåŠŸ:</strong><br>
                    <pre>${JSON.stringify(response, null, 2)}</pre>
                </div>`, 'success')
            } catch (error) {
                addResult(`<div class="step">
                    <strong>3. ç™»å½•å¤±è´¥:</strong><br>
                    ${error.message}<br>
                    <pre>${JSON.stringify(error, null, 2)}</pre>
                </div>`, 'error')
            }
        }
        
        window.testEmptyStudentId = function() {
            document.getElementById('studentIdInput').value = ''
            addResult('è®¾ç½®ä¸ºç©ºå­¦å·', 'warning')
        }
        
        window.testValidStudentId = function() {
            document.getElementById('studentIdInput').value = '20210001'
            addResult('è®¾ç½®ä¸ºæœ‰æ•ˆå­¦å·: 20210001', 'info')
        }
        
        window.testSpecialCharacters = function() {
            document.getElementById('studentIdInput').value = 'abc@#$%'
            addResult('è®¾ç½®ä¸ºç‰¹æ®Šå­—ç¬¦: abc@#$%', 'warning')
        }
        
        window.clearResults = function() {
            document.getElementById('testResults').innerHTML = ''
        }
    </script>
</body>
</html>