<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¯®çƒèµ›é—®é¢˜ä¿®å¤é¡µé¢</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
        }
        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .status.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .status.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .activity-list {
            margin: 20px 0;
        }
        .activity-item {
            padding: 15px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #f9f9f9;
        }
        .activity-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        .activity-type {
            color: #7f8c8d;
            font-size: 14px;
        }
        .btn {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: background-color 0.3s;
        }
        .btn:hover {
            background-color: #0056b3;
        }
        .btn.danger {
            background-color: #dc3545;
        }
        .btn.danger:hover {
            background-color: #c82333;
        }
        .btn.success {
            background-color: #28a745;
        }
        .btn.success:hover {
            background-color: #218838;
        }
        .log {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 15px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ€ ç¯®çƒèµ›é—®é¢˜ä¿®å¤é¡µé¢</h1>
            <p>æ£€æµ‹å’Œä¿®å¤æ´»åŠ¨åˆ—è¡¨ä¸­å…¨æ˜¯ç¯®çƒèµ›çš„é—®é¢˜</p>
        </div>

        <div id="status" class="status">
            æ­£åœ¨æ£€æŸ¥å½“å‰æ•°æ®çŠ¶æ€...
        </div>

        <div class="stats" id="stats">
            <div class="stat-card">
                <div class="stat-number" id="totalActivities">0</div>
                <div class="stat-label">æ€»æ´»åŠ¨æ•°</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="basketballCount">0</div>
                <div class="stat-label">ç¯®çƒæ´»åŠ¨æ•°</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="basketballPercent">0%</div>
                <div class="stat-label">ç¯®çƒæ´»åŠ¨å æ¯”</div>
            </div>
        </div>

        <div class="activity-list" id="currentActivities">
            <h3>å½“å‰æ´»åŠ¨åˆ—è¡¨</h3>
            <div id="activitiesList"></div>
        </div>

        <div style="text-align: center; margin: 30px 0;">
            <button class="btn success" onclick="fixActivities()">ğŸ”§ ä¿®å¤æ´»åŠ¨æ•°æ®</button>
            <button class="btn" onclick="refreshData()">ğŸ”„ åˆ·æ–°æ£€æŸ¥</button>
            <button class="btn danger" onclick="clearAllData()">ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰æ•°æ®</button>
        </div>

        <div class="log" id="log">åˆå§‹åŒ–ä¸­...</div>
    </div>

    <script>
        let logElement = document.getElementById('log');
        let statusElement = document.getElementById('status');

        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logMessage = `[${timestamp}] ${message}`;
            console.log(logMessage);
            logElement.textContent += logMessage + '\n';
            logElement.scrollTop = logElement.scrollHeight;
        }

        function updateStatus(message, type = 'success') {
            statusElement.textContent = message;
            statusElement.className = `status ${type}`;
        }

        function checkCurrentData() {
            log('ğŸ” å¼€å§‹æ£€æŸ¥å½“å‰æ´»åŠ¨æ•°æ®...');
            
            try {
                const stored = localStorage.getItem('campus_activities');
                let activities = [];
                
                if (stored) {
                    activities = JSON.parse(stored);
                    log(`ğŸ“¦ ä»localStorageåŠ è½½äº† ${activities.length} ä¸ªæ´»åŠ¨`);
                } else {
                    log('ğŸ“¦ localStorageä¸­æ²¡æœ‰æ´»åŠ¨æ•°æ®');
                }

                // æ˜¾ç¤ºæ´»åŠ¨åˆ—è¡¨
                displayActivities(activities);
                
                // ç»Ÿè®¡æ•°æ®
                const basketballCount = activities.filter(activity => 
                    activity.title && activity.title.includes('ç¯®çƒ')
                ).length;
                
                const totalActivities = activities.length;
                const basketballPercent = totalActivities > 0 ? 
                    Math.round((basketballCount / totalActivities) * 100) : 0;

                // æ›´æ–°ç»Ÿè®¡æ˜¾ç¤º
                document.getElementById('totalActivities').textContent = totalActivities;
                document.getElementById('basketballCount').textContent = basketballCount;
                document.getElementById('basketballPercent').textContent = basketballPercent + '%';

                // åˆ¤æ–­çŠ¶æ€
                if (totalActivities === 0) {
                    updateStatus('æ²¡æœ‰æ´»åŠ¨æ•°æ®ï¼Œéœ€è¦æ·»åŠ æ­£ç¡®çš„æ´»åŠ¨æ•°æ®', 'warning');
                } else if (basketballCount > totalActivities * 0.8) {
                    updateStatus(`âš ï¸ æ£€æµ‹åˆ°è¿‡å¤šçš„ç¯®çƒæ´»åŠ¨ (${basketballPercent}%)ï¼Œéœ€è¦ä¿®å¤`, 'warning');
                } else {
                    updateStatus('âœ… æ´»åŠ¨æ•°æ®æ­£å¸¸ï¼Œç¯®çƒæ´»åŠ¨å æ¯”åˆç†', 'success');
                }

                log(`ğŸ“Š ç»Ÿè®¡ç»“æœ: æ€»è®¡${totalActivities}ä¸ªæ´»åŠ¨ï¼Œç¯®çƒæ´»åŠ¨${basketballCount}ä¸ª (${basketballPercent}%)`);
                
            } catch (error) {
                log(`âŒ æ£€æŸ¥æ•°æ®å¤±è´¥: ${error.message}`);
                updateStatus('âŒ æ£€æŸ¥æ•°æ®å¤±è´¥', 'error');
            }
        }

        function displayActivities(activities) {
            const listElement = document.getElementById('activitiesList');
            listElement.innerHTML = '';
            
            if (activities.length === 0) {
                listElement.innerHTML = '<p style="color: #666; text-align: center;">æš‚æ— æ´»åŠ¨æ•°æ®</p>';
                return;
            }
            
            activities.forEach((activity, index) => {
                const item = document.createElement('div');
                item.className = 'activity-item';
                
                const title = activity.title || 'æ— æ ‡é¢˜';
                const type = activity.type || activity.category || 'æ— ç±»å‹';
                const isBasketball = title.includes('ç¯®çƒ');
                
                item.innerHTML = `
                    <div class="activity-title">${isBasketball ? 'ğŸ€' : 'ğŸ“‹'} ${index + 1}. ${title}</div>
                    <div class="activity-type">ç±»å‹: ${type}</div>
                `;
                
                if (isBasketball) {
                    item.style.backgroundColor = '#fff3cd';
                    item.style.borderColor = '#ffeaa7';
                }
                
                listElement.appendChild(item);
            });
        }

        function fixActivities() {
            log('ğŸš€ å¼€å§‹ä¿®å¤æ´»åŠ¨æ•°æ®...');
            
            try {
                const correctActivities = [
                    {
                        id: 1,
                        title: 'ä¸­åŒ»å…»ç”Ÿè®²åº§',
                        type: 'å­¦æœ¯è®²åº§',
                        category: 'study',
                        description: 'é‚€è¯·ä¸­åŒ»ä¸“å®¶è®²è§£ä¸­åŒ»å…»ç”ŸçŸ¥è¯†ï¼Œåˆ†äº«ä¼ ç»Ÿä¿å¥æ–¹æ³•ã€‚',
                        locationName: 'å­¦æœ¯æŠ¥å‘Šå…',
                        location: {
                            name: 'å­¦æœ¯æŠ¥å‘Šå…',
                            address: 'å¹¿ä¸œè¯ç§‘å¤§å­¦äº‘æµ®æ ¡åŒºå­¦æœ¯æŠ¥å‘Šå…'
                        },
                        startTime: new Date(Date.now() + 2 * 24 * 60 * 60 * 1000).toISOString(),
                        endTime: new Date(Date.now() + 2 * 24 * 60 * 60 * 1000 + 2 * 60 * 60 * 1000).toISOString(),
                        registrationDeadline: new Date(Date.now() + 2 * 24 * 60 * 60 * 1000 - 2 * 60 * 60 * 1000).toISOString(),
                        currentParticipants: 15,
                        maxParticipants: 30,
                        organizer: {
                            id: 2,
                            name: 'ä¸­åŒ»å­¦é™¢',
                            role: 'ç»„ç»‡è€…',
                            creditScore: 98
                        },
                        isEnrolled: false,
                        status: 'open',
                        distance: 0.8,
                        tags: ['ä¸­åŒ»', 'å…»ç”Ÿ', 'å¥åº·', 'è®²åº§']
                    },
                    {
                        id: 2,
                        title: 'æ‘„å½±ä½œå“å±•è§ˆ',
                        type: 'æ–‡åŒ–è‰ºæœ¯',
                        category: 'culture',
                        description: 'å±•ç¤ºå­¦ç”Ÿæ‘„å½±ä½œå“ï¼Œåˆ†äº«æ‘„å½±æŠ€å·§ï¼Œäº¤æµåˆ›ä½œå¿ƒå¾—ã€‚',
                        locationName: 'è‰ºæœ¯å±•å…',
                        location: {
                            name: 'è‰ºæœ¯å±•å…',
                            address: 'å¹¿ä¸œè¯ç§‘å¤§å­¦äº‘æµ®æ ¡åŒºè‰ºæœ¯å±•å…'
                        },
                        startTime: new Date(Date.now() + 3 * 24 * 60 * 60 * 1000).toISOString(),
                        endTime: new Date(Date.now() + 3 * 24 * 60 * 60 * 1000 + 3 * 60 * 60 * 1000).toISOString(),
                        registrationDeadline: new Date(Date.now() + 3 * 24 * 60 * 60 * 1000 - 3 * 60 * 60 * 1000).toISOString(),
                        currentParticipants: 12,
                        maxParticipants: 25,
                        organizer: {
                            id: 3,
                            name: 'æ‘„å½±åä¼š',
                            role: 'ç»„ç»‡è€…',
                            creditScore: 92
                        },
                        isEnrolled: false,
                        status: 'open',
                        distance: 0.3,
                        tags: ['æ‘„å½±', 'è‰ºæœ¯', 'å±•è§ˆ', 'åˆ›ä½œ']
                    },
                    {
                        id: 3,
                        title: 'ç¼–ç¨‹é©¬æ‹‰æ¾å¤§èµ›',
                        type: 'ç§‘æŠ€åˆ›æ–°',
                        category: 'tech',
                        description: '24å°æ—¶ç¼–ç¨‹æŒ‘æˆ˜èµ›ï¼Œä¸»é¢˜ä¸ºæ™ºæ…§æ ¡å›­ï¼Œå±•ç¤ºç¼–ç¨‹æŠ€èƒ½ã€‚',
                        locationName: 'åˆ›æ–°å®éªŒå®¤',
                        location: {
                            name: 'åˆ›æ–°å®éªŒå®¤',
                            address: 'å¹¿ä¸œè¯ç§‘å¤§å­¦äº‘æµ®æ ¡åŒºåˆ›æ–°å®éªŒå®¤'
                        },
                        startTime: new Date(Date.now() + 4 * 24 * 60 * 60 * 1000).toISOString(),
                        endTime: new Date(Date.now() + 5 * 24 * 60 * 60 * 1000).toISOString(),
                        registrationDeadline: new Date(Date.now() + 4 * 24 * 60 * 60 * 1000 - 4 * 60 * 60 * 1000).toISOString(),
                        currentParticipants: 8,
                        maxParticipants: 20,
                        organizer: {
                            id: 4,
                            name: 'è®¡ç®—æœºå­¦é™¢',
                            role: 'ç»„ç»‡è€…',
                            creditScore: 96
                        },
                        isEnrolled: false,
                        status: 'open',
                        distance: 1.2,
                        tags: ['ç¼–ç¨‹', 'åˆ›æ–°', 'æ¯”èµ›', 'æŠ€æœ¯']
                    },
                    {
                        id: 4,
                        title: 'ç¯®çƒå‹è°Šèµ›',
                        type: 'ä½“è‚²ç«æŠ€',
                        category: 'sports',
                        description: 'é™¢ç³»é—´ç¯®çƒå‹è°Šèµ›ï¼Œä¿ƒè¿›å„é™¢ç³»äº¤æµã€‚æ¯”èµ›é‡‡ç”¨å›½é™…ç¯®è”è§„åˆ™ï¼Œè®¾æœ‰MVPå¥–é¡¹ã€‚',
                        locationName: 'ä½“è‚²é¦†',
                        location: {
                            name: 'ä½“è‚²é¦†',
                            address: 'å¹¿ä¸œè¯ç§‘å¤§å­¦äº‘æµ®æ ¡åŒºä½“è‚²é¦†'
                        },
                        startTime: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString(),
                        endTime: new Date(Date.now() + 26 * 60 * 60 * 1000).toISOString(),
                        registrationDeadline: new Date(Date.now() + 12 * 60 * 60 * 1000).toISOString(),
                        currentParticipants: 16,
                        maxParticipants: 20,
                        organizer: {
                            id: 1,
                            name: 'ä½“è‚²éƒ¨',
                            role: 'ç»„ç»‡è€…',
                            creditScore: 94
                        },
                        isEnrolled: false,
                        status: 'open',
                        distance: 0.8,
                        tags: ['ç¯®çƒ', 'ä½“è‚²', 'æ¯”èµ›', 'å‹è°Šèµ›']
                    },
                    {
                        id: 5,
                        title: 'æ ¡å›­éŸ³ä¹èŠ‚',
                        type: 'æ–‡è‰ºæ¼”å‡º',
                        category: 'culture',
                        description: 'å¹´åº¦æ ¡å›­éŸ³ä¹ç››å…¸ï¼Œé‚€è¯·æ ¡å†…çŸ¥åä¹é˜Ÿå’Œæ ¡å¤–ä¸“ä¸šéŸ³ä¹äººåŒå°æ¼”å‡ºã€‚',
                        locationName: 'å¤§å­¦ç”Ÿæ´»åŠ¨ä¸­å¿ƒ',
                        location: {
                            name: 'å¤§å­¦ç”Ÿæ´»åŠ¨ä¸­å¿ƒ',
                            address: 'å¹¿ä¸œè¯ç§‘å¤§å­¦äº‘æµ®æ ¡åŒºå¤§å­¦ç”Ÿæ´»åŠ¨ä¸­å¿ƒ'
                        },
                        startTime: new Date(Date.now() + 5 * 24 * 60 * 60 * 1000).toISOString(),
                        endTime: new Date(Date.now() + 5 * 24 * 60 * 60 * 1000 + 4 * 60 * 60 * 1000).toISOString(),
                        registrationDeadline: new Date(Date.now() + 5 * 24 * 60 * 60 * 1000 - 4 * 60 * 60 * 1000).toISOString(),
                        currentParticipants: 85,
                        maxParticipants: 100,
                        organizer: {
                            id: 5,
                            name: 'å­¦ç”Ÿä¼šæ–‡è‰ºéƒ¨',
                            role: 'ç»„ç»‡è€…',
                            creditScore: 92
                        },
                        isEnrolled: false,
                        status: 'open',
                        distance: 0.6,
                        tags: ['éŸ³ä¹', 'æ¼”å‡º', 'æ–‡è‰º', 'éŸ³ä¹èŠ‚']
                    },
                    {
                        id: 6,
                        title: 'å›¾ä¹¦é¦†å­¦ä¹ å°ç»„',
                        type: 'å­¦ä¹ äº¤æµ',
                        category: 'study',
                        description: 'ä¸ºæœŸä¸€å‘¨çš„é›†ä¸­å­¦ä¹ æ´»åŠ¨ï¼Œæä¾›å®‰é™çš„å­¦ä¹ ç¯å¢ƒå’Œä¸“ä¸šçš„å­¦ä¹ æŒ‡å¯¼ã€‚',
                        locationName: 'å›¾ä¹¦é¦†ç ”è®¨å®¤',
                        location: {
                            name: 'å›¾ä¹¦é¦†ç ”è®¨å®¤',
                            address: 'å¹¿ä¸œè¯ç§‘å¤§å­¦äº‘æµ®æ ¡åŒºå›¾ä¹¦é¦†ç ”è®¨å®¤'
                        },
                        startTime: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString(),
                        endTime: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString(),
                        registrationDeadline: new Date(Date.now() + 12 * 60 * 60 * 1000).toISOString(),
                        currentParticipants: 42,
                        maxParticipants: 50,
                        organizer: {
                            id: 6,
                            name: 'å›¾ä¹¦é¦†',
                            role: 'ç»„ç»‡è€…',
                            creditScore: 99
                        },
                        isEnrolled: false,
                        status: 'open',
                        distance: 0.4,
                        tags: ['å­¦ä¹ ', 'å›¾ä¹¦é¦†', 'ç ”è®¨', 'äº¤æµ']
                    }
                ];
                
                // ä¿å­˜åˆ°localStorage
                localStorage.setItem('campus_activities', JSON.stringify(correctActivities));
                
                log('âœ… å·²ä¿®å¤localStorageä¸­çš„æ´»åŠ¨æ•°æ®');
                log(`ğŸ“‹ ä¿®å¤åçš„æ´»åŠ¨åˆ—è¡¨ (${correctActivities.length}ä¸ªæ´»åŠ¨):`);
                correctActivities.forEach((activity, index) => {
                    log(`  ${index + 1}. ${activity.title} - ${activity.type}`);
                });
                
                updateStatus('âœ… æ´»åŠ¨æ•°æ®ä¿®å¤æˆåŠŸï¼3ç§’åè‡ªåŠ¨åˆ·æ–°é¡µé¢...', 'success');
                
                // 3ç§’ååˆ·æ–°é¡µé¢æ•°æ®
                setTimeout(() => {
                    checkCurrentData();
                    updateStatus('âœ… æ´»åŠ¨æ•°æ®å·²ä¿®å¤ï¼Œç°åœ¨å¯ä»¥æ­£å¸¸è®¿é—®æ´»åŠ¨åˆ—è¡¨é¡µé¢äº†', 'success');
                }, 3000);
                
            } catch (error) {
                log(`âŒ ä¿®å¤å¤±è´¥: ${error.message}`);
                updateStatus('âŒ ä¿®å¤å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ§åˆ¶å°', 'error');
            }
        }

        function refreshData() {
            log('ğŸ”„ åˆ·æ–°æ•°æ®æ£€æŸ¥...');
            checkCurrentData();
        }

        function clearAllData() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ´»åŠ¨æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚')) {
                try {
                    localStorage.removeItem('campus_activities');
                    log('ğŸ—‘ï¸ å·²æ¸…ç©ºæ‰€æœ‰æ´»åŠ¨æ•°æ®');
                    updateStatus('ğŸ—‘ï¸ æ‰€æœ‰æ•°æ®å·²æ¸…ç©º', 'warning');
                    checkCurrentData();
                } catch (error) {
                    log(`âŒ æ¸…ç©ºæ•°æ®å¤±è´¥: ${error.message}`);
                    updateStatus('âŒ æ¸…ç©ºæ•°æ®å¤±è´¥', 'error');
                }
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
        window.onload = function() {
            log('ğŸš€ ç¯®çƒèµ›é—®é¢˜ä¿®å¤é¡µé¢å·²åŠ è½½');
            checkCurrentData();
        };
    </script>
</body>
</html>