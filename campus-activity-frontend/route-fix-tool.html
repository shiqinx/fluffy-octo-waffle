<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ´»åŠ¨è¯¦æƒ…è·¯ç”±é—®é¢˜ä¿®å¤å·¥å…·</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .header h1 {
            color: #333;
            margin: 0;
            font-size: 28px;
        }
        .header p {
            color: #666;
            margin: 10px 0 0 0;
        }
        .section {
            margin-bottom: 25px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background: #fafafa;
        }
        .section h3 {
            margin-top: 0;
            color: #444;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .activity-demo {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .activity-card {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .activity-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
        }
        .activity-title {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 8px;
            color: #333;
        }
        .activity-id {
            color: #666;
            font-size: 12px;
            margin-bottom: 5px;
        }
        .activity-meta {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #888;
        }
        .test-button {
            background: linear-gradient(45deg, #007bff, #0056b3);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
            transition: all 0.3s ease;
        }
        .test-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,123,255,0.3);
        }
        .test-button.success {
            background: linear-gradient(45deg, #28a745, #20c997);
        }
        .test-button.warning {
            background: linear-gradient(45deg, #ffc107, #fd7e14);
        }
        .test-button.danger {
            background: linear-gradient(45deg, #dc3545, #e83e8c);
        }
        .log-section {
            background: #2d3748;
            color: #e2e8f0;
            border: 1px solid #4a5568;
            border-radius: 6px;
            padding: 15px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            margin: 15px 0;
        }
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-success { background: #28a745; }
        .status-error { background: #dc3545; }
        .status-warning { background: #ffc107; }
        .status-info { background: #17a2b8; }
        .fix-result {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
        }
        .error-result {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
        }
        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”§ æ´»åŠ¨è¯¦æƒ…è·¯ç”±é—®é¢˜ä¿®å¤å·¥å…·</h1>
            <p>è¯Šæ–­å’Œä¿®å¤æ´»åŠ¨åˆ—è¡¨è·³è½¬åˆ°åŒä¸€è¯¦æƒ…é¡µçš„é—®é¢˜</p>
        </div>

        <div class="section">
            <h3><span class="status-indicator status-info"></span>é—®é¢˜è¯Šæ–­</h3>
            <div id="diagnosisResult"></div>
            <button class="test-button" onclick="runDiagnosis()">å¼€å§‹è¯Šæ–­</button>
        </div>

        <div class="section">
            <h3><span class="status-indicator status-warning"></span>æ¨¡æ‹Ÿæ´»åŠ¨åˆ—è¡¨</h3>
            <div class="activity-demo" id="activityDemo"></div>
        </div>

        <div class="section">
            <h3><span class="status-indicator status-success"></span>ä¿®å¤æ“ä½œ</h3>
            <div class="button-group">
                <button class="test-button success" onclick="fixMockData()">ä¿®å¤Mockæ•°æ®</button>
                <button class="test-button warning" onclick="clearLocalStorage()">æ¸…ç†ç¼“å­˜</button>
                <button class="test-button danger" onclick="resetAllData()">é‡ç½®æ‰€æœ‰æ•°æ®</button>
            </div>
            <div id="fixResult"></div>
        </div>

        <div class="section">
            <h3><span class="status-indicator status-info"></span>æµ‹è¯•æ—¥å¿—</h3>
            <div id="testLog" class="log-section"></div>
            <button class="test-button" onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
        </div>
    </div>

    <script>
        // æ­£ç¡®çš„æ´»åŠ¨æ•°æ®
        const correctActivities = [
            {
                id: 1,
                title: "ä¸­åŒ»å…»ç”Ÿè®²åº§",
                type: "lecture",
                category: "lecture",
                location: { name: "æ•™å­¦æ¥¼A101", address: "ä¸»æ•™å­¦æ¥¼Aæ ‹101å®¤" },
                startTime: "2024-01-15T14:00:00",
                endTime: "2024-01-15T16:00:00",
                currentParticipants: 25,
                maxParticipants: 100,
                description: "ä¼ ç»Ÿä¸­åŒ»å…»ç”ŸçŸ¥è¯†è®²åº§ï¼Œé‚€è¯·èµ„æ·±ä¸­åŒ»å¸ˆè®²è§£å…»ç”Ÿä¹‹é“"
            },
            {
                id: 2,
                title: "æ‘„å½±ä½œå“å±•è§ˆ",
                type: "exhibition",
                category: "other",
                location: { name: "è‰ºæœ¯é¦†äºŒæ¥¼", address: "å­¦æ ¡è‰ºæœ¯é¦†äºŒæ¥¼å±•å…" },
                startTime: "2024-01-16T10:00:00",
                endTime: "2024-01-16T17:00:00",
                currentParticipants: 30,
                maxParticipants: 80,
                description: "å­¦ç”Ÿä¼˜ç§€æ‘„å½±ä½œå“å±•è§ˆï¼Œå±•ç°æ ¡å›­ç”Ÿæ´»ä¹‹ç¾"
            },
            {
                id: 3,
                title: "ç¼–ç¨‹é©¬æ‹‰æ¾å¤§èµ›",
                type: "competition",
                category: "study",
                location: { name: "è®¡ç®—æœºå®éªŒå®¤", address: "è®¡ç®—æœºå­¦é™¢å®éªŒæ¥¼302" },
                startTime: "2024-01-17T09:00:00",
                endTime: "2024-01-17T21:00:00",
                currentParticipants: 15,
                maxParticipants: 50,
                description: "24å°æ—¶ç¼–ç¨‹æŒ‘æˆ˜èµ›ï¼Œå±•ç¤ºç¼–ç¨‹æŠ€èƒ½å’Œå›¢é˜Ÿåä½œ"
            },
            {
                id: 4,
                title: "ç¯®çƒå‹è°Šèµ›",
                type: "sports",
                category: "sports",
                location: { name: "ä½“è‚²é¦†", address: "å­¦æ ¡ä½“è‚²é¦†ä¸»åœºåœ°" },
                startTime: "2024-01-18T16:00:00",
                endTime: "2024-01-18T18:00:00",
                currentParticipants: 20,
                maxParticipants: 40,
                description: "é™¢ç³»ç¯®çƒå‹è°Šèµ›ï¼Œå¢è¿›å‹è°Šï¼Œé”»ç‚¼èº«ä½“"
            },
            {
                id: 5,
                title: "æ ¡å›­éŸ³ä¹èŠ‚",
                type: "entertainment",
                category: "other",
                location: { name: "å¤§ç¤¼å ‚", address: "å­¦æ ¡å¤§ç¤¼å ‚" },
                startTime: "2024-01-19T19:00:00",
                endTime: "2024-01-19T21:30:00",
                currentParticipants: 150,
                maxParticipants: 300,
                description: "å¹´åº¦æ ¡å›­éŸ³ä¹èŠ‚ï¼Œå±•ç°å­¦ç”ŸéŸ³ä¹æ‰å"
            },
            {
                id: 6,
                title: "å›¾ä¹¦é¦†å­¦ä¹ å°ç»„",
                type: "study",
                category: "study",
                location: { name: "å›¾ä¹¦é¦†ä¸‰æ¥¼", address: "å›¾ä¹¦é¦†ä¸‰æ¥¼ç ”è®¨å®¤" },
                startTime: "2024-01-20T14:00:00",
                endTime: "2024-01-20T16:00:00",
                currentParticipants: 12,
                maxParticipants: 25,
                description: "å­¦æœ¯å­¦ä¹ å°ç»„æ´»åŠ¨ï¼Œå…±åŒæ¢è®¨ä¸“ä¸šé—®é¢˜"
            }
        ];

        let testLog = [];

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const statusIcons = {
                info: 'â„¹ï¸',
                success: 'âœ…',
                error: 'âŒ',
                warning: 'âš ï¸'
            };
            testLog.push(`[${timestamp}] ${statusIcons[type]} ${message}`);
            updateLogDisplay();
        }

        function updateLogDisplay() {
            document.getElementById('testLog').textContent = testLog.join('\n');
        }

        function clearLog() {
            testLog = [];
            updateLogDisplay();
        }

        function renderActivityDemo() {
            const demoContainer = document.getElementById('activityDemo');
            demoContainer.innerHTML = '';

            correctActivities.forEach(activity => {
                const card = document.createElement('div');
                card.className = 'activity-card';
                card.innerHTML = `
                    <div class="activity-title">${activity.title}</div>
                    <div class="activity-id">ID: ${activity.id}</div>
                    <div class="activity-meta">
                        <span>ğŸ“ ${activity.location.name}</span>
                        <span>ğŸ‘¥ ${activity.currentParticipants}/${activity.maxParticipants}</span>
                    </div>
                `;
                card.onclick = () => testActivityNavigation(activity);
                demoContainer.appendChild(card);
            });
        }

        function testActivityNavigation(activity) {
            log(`ğŸ‘† æµ‹è¯•ç‚¹å‡»æ´»åŠ¨: ${activity.title} (ID: ${activity.id})`);
            
            // æ¨¡æ‹Ÿè·¯ç”±ç”Ÿæˆ
            const routePath = `/activities/${activity.id}`;
            log(`ğŸ›£ï¸ ç”Ÿæˆè·¯ç”±: ${routePath}`);
            
            // æ¨¡æ‹Ÿè·¯ç”±å‚æ•°è§£æ
            const params = extractRouteParams(routePath);
            log(`ğŸ“‹ è§£æå‚æ•°: ${JSON.stringify(params)}`);
            
            // æ¨¡æ‹ŸAPIè°ƒç”¨
            const result = simulateGetActivityDetail(params.id);
            if (result.success) {
                log(`âœ… APIè¿”å›æ­£ç¡®: ${result.data.title}`);
            } else {
                log(`âŒ APIè¿”å›é”™è¯¯: ${result.error}`);
            }
        }

        function extractRouteParams(routePath) {
            const match = routePath.match(/\/activities\/(\d+)/);
            return match ? { id: match[1] } : null;
        }

        function simulateGetActivityDetail(activityId) {
            const activity = correctActivities.find(a => a.id == activityId);
            if (activity) {
                return { success: true, data: activity };
            } else {
                return { success: false, error: `æœªæ‰¾åˆ°IDä¸º ${activityId} çš„æ´»åŠ¨` };
            }
        }

        function runDiagnosis() {
            const diagnosisResult = document.getElementById('diagnosisResult');
            let issues = [];
            let suggestions = [];

            log('ğŸ” å¼€å§‹è¯Šæ–­æ´»åŠ¨è¯¦æƒ…è·¯ç”±é—®é¢˜...');

            // æ£€æŸ¥localStorage
            const cachedActivities = localStorage.getItem('campus_activities');
            if (cachedActivities) {
                try {
                    const parsed = JSON.parse(cachedActivities);
                    if (Array.isArray(parsed)) {
                        log(`ğŸ“¦ å‘ç°ç¼“å­˜æ•°æ®: ${parsed.length} ä¸ªæ´»åŠ¨`);
                        
                        // æ£€æŸ¥æ•°æ®æ˜¯å¦é‡å¤
                        const titles = parsed.map(a => a.title);
                        const uniqueTitles = [...new Set(titles)];
                        if (titles.length !== uniqueTitles.length) {
                            issues.push('ç¼“å­˜ä¸­å­˜åœ¨é‡å¤çš„æ´»åŠ¨æ ‡é¢˜');
                            suggestions.push('æ¸…ç†localStorageç¼“å­˜');
                        }
                    }
                } catch (e) {
                    issues.push('localStorageæ•°æ®è§£æå¤±è´¥');
                    suggestions.push('æ¸…ç†æŸåçš„ç¼“å­˜æ•°æ®');
                }
            }

            // æ£€æŸ¥è·¯ç”±å‚æ•°è§£æ
            const testRoutes = ['/activities/1', '/activities/2', '/activities/3'];
            let routeIssues = 0;
            testRoutes.forEach(route => {
                const params = extractRouteParams(route);
                if (!params || !params.id) {
                    routeIssues++;
                }
            });

            if (routeIssues > 0) {
                issues.push('è·¯ç”±å‚æ•°è§£æå­˜åœ¨é—®é¢˜');
                suggestions.push('æ£€æŸ¥è·¯ç”±é…ç½®');
            }

            // æ˜¾ç¤ºè¯Šæ–­ç»“æœ
            let html = '';
            if (issues.length === 0) {
                html = '<div class="fix-result">âœ… æœªå‘ç°æ˜æ˜¾é—®é¢˜ï¼Œç³»ç»Ÿè¿è¡Œæ­£å¸¸</div>';
            } else {
                html = '<div class="error-result">';
                html += '<h4>ğŸ” å‘ç°çš„é—®é¢˜ï¼š</h4><ul>';
                issues.forEach(issue => html += `<li>${issue}</li>`);
                html += '</ul>';
                html += '<h4>ğŸ’¡ å»ºè®®çš„è§£å†³æ–¹æ¡ˆï¼š</h4><ul>';
                suggestions.forEach(suggestion => html += `<li>${suggestion}</li>`);
                html += '</ul></div>';
            }

            diagnosisResult.innerHTML = html;
            log(`ğŸ¯ è¯Šæ–­å®Œæˆ: å‘ç° ${issues.length} ä¸ªé—®é¢˜`);
        }

        function fixMockData() {
            log('ğŸ”§ å¼€å§‹ä¿®å¤Mockæ•°æ®...');
            
            try {
                // æ›´æ–°localStorageä¸­çš„æ´»åŠ¨æ•°æ®
                localStorage.setItem('campus_activities', JSON.stringify(correctActivities));
                localStorage.setItem('activity_detail_cache', JSON.stringify({}));
                
                log('âœ… Mockæ•°æ®ä¿®å¤å®Œæˆ');
                document.getElementById('fixResult').innerHTML = 
                    '<div class="fix-result">âœ… Mockæ•°æ®ä¿®å¤æˆåŠŸï¼æ´»åŠ¨æ•°æ®å·²æ›´æ–°ä¸ºæ­£ç¡®çš„6ä¸ªä¸åŒæ´»åŠ¨</div>';
            } catch (error) {
                log(`âŒ ä¿®å¤å¤±è´¥: ${error.message}`);
                document.getElementById('fixResult').innerHTML = 
                    `<div class="error-result">âŒ ä¿®å¤å¤±è´¥: ${error.message}</div>`;
            }
        }

        function clearLocalStorage() {
            log('ğŸ—‘ï¸ æ¸…ç†localStorageç¼“å­˜...');
            
            const keysToRemove = ['campus_activities', 'activity_detail_cache', 'user_activities'];
            keysToRemove.forEach(key => {
                localStorage.removeItem(key);
                log(`ğŸ—‘ï¸ å·²æ¸…ç†: ${key}`);
            });
            
            document.getElementById('fixResult').innerHTML = 
                '<div class="fix-result">âœ… ç¼“å­˜æ¸…ç†å®Œæˆï¼localStorageå·²æ¸…ç©º</div>';
        }

        function resetAllData() {
            log('ğŸ”„ é‡ç½®æ‰€æœ‰æ•°æ®...');
            
            // æ¸…ç†æ‰€æœ‰ç›¸å…³æ•°æ®
            clearLocalStorage();
            
            // é‡æ–°è®¾ç½®æ­£ç¡®çš„æ•°æ®
            setTimeout(() => {
                fixMockData();
                log('ğŸ”„ æ•°æ®é‡ç½®å®Œæˆ');
            }, 100);
        }

        // åˆå§‹åŒ–é¡µé¢
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸš€ æ´»åŠ¨è¯¦æƒ…è·¯ç”±é—®é¢˜ä¿®å¤å·¥å…·åˆå§‹åŒ–å®Œæˆ');
            renderActivityDemo();
            log('ğŸ“‹ æ´»åŠ¨åˆ—è¡¨å·²æ¸²æŸ“ï¼Œå¯ä»¥ç‚¹å‡»æµ‹è¯•');
        });
    </script>
</body>
</html>