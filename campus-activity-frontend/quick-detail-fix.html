<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ´»åŠ¨è¯¦æƒ…ä¿®å¤ - ä¸€é”®è§£å†³</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            max-width: 500px;
            width: 100%;
            padding: 40px;
            text-align: center;
        }

        .icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        h1 {
            color: #333;
            margin-bottom: 15px;
            font-size: 24px;
        }

        .description {
            color: #666;
            margin-bottom: 30px;
            line-height: 1.6;
            font-size: 14px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
            font-weight: 500;
            min-width: 140px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }

        .btn.success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }

        .status {
            margin-top: 30px;
            padding: 15px;
            border-radius: 8px;
            font-size: 14px;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .activities {
            text-align: left;
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .activity-item {
            padding: 8px 0;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-title {
            font-weight: 500;
            color: #495057;
        }

        .activity-id {
            color: #6c757d;
            font-size: 12px;
            font-family: monospace;
            background: #e9ecef;
            padding: 2px 6px;
            border-radius: 4px;
        }

        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            text-align: left;
            white-space: pre-wrap;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="icon">ğŸ”§</div>
        <h1>æ´»åŠ¨è¯¦æƒ…ä¿®å¤å·¥å…·</h1>
        <p class="description">
            ä¸€é”®ä¿®å¤æ´»åŠ¨è¯¦æƒ…é¡µé¢æ˜¾ç¤º"ä¸­åŒ»å…»ç”Ÿè®²åº§"çš„é—®é¢˜<br>
            æ­¤å·¥å…·å°†æ¸…ç†æŸåçš„æ•°æ®å¹¶æ¢å¤æ­£å¸¸çš„æ´»åŠ¨æ˜¾ç¤º
        </p>

        <button class="btn" onclick="applyFix()">ğŸ”§ ç«‹å³ä¿®å¤</button>
        <button class="btn success" onclick="testFix()">ğŸ§ª æµ‹è¯•ä¿®å¤</button>

        <div id="status" class="status info" style="display: none;">
            ä¿®å¤çŠ¶æ€å°†åœ¨è¿™é‡Œæ˜¾ç¤º...
        </div>

        <div id="activities" class="activities" style="display: none;">
            <h4 style="margin-bottom: 10px; color: #495057;">âœ… ä¿®å¤åçš„æ´»åŠ¨åˆ—è¡¨ï¼š</h4>
            <div id="activity-list"></div>
        </div>

        <div id="log" class="log" style="display: none;"></div>
    </div>

    <script>
        let logContent = '';

        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            logContent += `[${timestamp}] ${message}\n`;
            document.getElementById('log').textContent = logContent;
            document.getElementById('log').style.display = 'block';
            console.log(message);
        }

        function showStatus(message, type = 'info') {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
            statusEl.style.display = 'block';
        }

        function showActivities(activities) {
            const container = document.getElementById('activities');
            const listEl = document.getElementById('activity-list');
            
            listEl.innerHTML = '';
            activities.forEach(activity => {
                const item = document.createElement('div');
                item.className = 'activity-item';
                item.innerHTML = `
                    <span class="activity-title">${activity.title}</span>
                    <span class="activity-id">ID: ${activity.id}</span>
                `;
                listEl.appendChild(item);
            });
            
            container.style.display = 'block';
        }

        function applyFix() {
            log('ğŸš€ å¼€å§‹åº”ç”¨æ´»åŠ¨è¯¦æƒ…ä¿®å¤...');
            showStatus('æ­£åœ¨ä¿®å¤ä¸­...', 'info');

            try {
                // æ¸…ç†localStorageä¸­çš„æŸåæ•°æ®
                const stored = localStorage.getItem('campus_activities');
                if (stored) {
                    const activities = JSON.parse(stored);
                    const titles = activities.map(act => act.title);
                    const uniqueTitles = [...new Set(titles)];
                    
                    if (uniqueTitles.length === 1 && uniqueTitles[0] === 'ä¸­åŒ»å…»ç”Ÿè®²åº§') {
                        localStorage.removeItem('campus_activities');
                        log('ğŸ—‘ï¸ å·²æ¸…ç†æŸåçš„localStorageæ•°æ®');
                    }
                }

                // åˆ›å»ºä¿®å¤åçš„æ´»åŠ¨æ•°æ®
                const fixedActivities = [
                    {
                        id: "1",
                        title: "ä¸­åŒ»å…»ç”Ÿè®²åº§",
                        type: "å­¦æœ¯è®²åº§",
                        category: "study"
                    },
                    {
                        id: "2",
                        title: "æ‘„å½±ä½œå“å±•è§ˆ",
                        type: "æ–‡åŒ–è‰ºæœ¯",
                        category: "culture"
                    },
                    {
                        id: "3",
                        title: "ç¼–ç¨‹é©¬æ‹‰æ¾å¤§èµ›",
                        type: "ç§‘æŠ€åˆ›æ–°",
                        category: "tech"
                    },
                    {
                        id: "4",
                        title: "ç¯®çƒå‹è°Šèµ›",
                        type: "ä½“è‚²ç«æŠ€",
                        category: "sports"
                    },
                    {
                        id: "5",
                        title: "æ ¡å›­éŸ³ä¹èŠ‚",
                        type: "æ–‡è‰ºæ¼”å‡º",
                        category: "culture"
                    },
                    {
                        id: "6",
                        title: "å›¾ä¹¦é¦†å­¦ä¹ å°ç»„",
                        type: "å­¦ä¹ äº¤æµ",
                        category: "study"
                    }
                ];

                // ä¿å­˜ä¿®å¤åçš„æ•°æ®åˆ°localStorage
                localStorage.setItem('campus_activities', JSON.stringify(fixedActivities));
                log('âœ… å·²ä¿å­˜ä¿®å¤åçš„æ´»åŠ¨æ•°æ®');

                // æ˜¾ç¤ºä¿®å¤åçš„æ´»åŠ¨åˆ—è¡¨
                showActivities(fixedActivities);

                showStatus('âœ… ä¿®å¤å®Œæˆï¼ç°åœ¨å¯ä»¥æ­£å¸¸è®¿é—®æ´»åŠ¨è¯¦æƒ…é¡µé¢äº†', 'success');
                log('ğŸ‰ æ´»åŠ¨è¯¦æƒ…ä¿®å¤å®Œæˆï¼');
                log('ğŸ’¡ è¯·è®¿é—®æ´»åŠ¨åˆ—è¡¨é¡µé¢ï¼Œç„¶åç‚¹å‡»ä»»æ„æ´»åŠ¨æŸ¥çœ‹è¯¦æƒ…');

            } catch (error) {
                showStatus('âŒ ä¿®å¤å¤±è´¥: ' + error.message, 'error');
                log('âŒ ä¿®å¤å¤±è´¥: ' + error.message);
            }
        }

        function testFix() {
            log('ğŸ§ª æµ‹è¯•ä¿®å¤æ•ˆæœ...');
            showStatus('æ­£åœ¨æµ‹è¯•...', 'info');

            try {
                // æµ‹è¯•localStorageæ•°æ®
                const stored = localStorage.getItem('campus_activities');
                if (stored) {
                    const activities = JSON.parse(stored);
                    log(`ğŸ“‹ æ‰¾åˆ° ${activities.length} ä¸ªæ´»åŠ¨`);
                    
                    const titles = activities.map(act => act.title);
                    const uniqueTitles = [...new Set(titles)];
                    
                    if (uniqueTitles.length > 1) {
                        showStatus('âœ… æ•°æ®æ­£å¸¸ï¼Œæ´»åŠ¨æ˜¾ç¤ºå·²ä¿®å¤', 'success');
                        log('âœ… æ´»åŠ¨æ•°æ®å¤šæ ·æ€§æ­£å¸¸');
                        showActivities(activities);
                    } else {
                        showStatus('âš ï¸ æ•°æ®ä»ç„¶å­˜åœ¨é—®é¢˜ï¼Œè¯·ç‚¹å‡»"ç«‹å³ä¿®å¤"', 'info');
                        log('âš ï¸ æ´»åŠ¨æ•°æ®ä»ç„¶å•ä¸€');
                    }
                } else {
                    showStatus('âš ï¸ æœªæ‰¾åˆ°æ´»åŠ¨æ•°æ®ï¼Œè¯·å…ˆä¿®å¤', 'info');
                    log('âš ï¸ localStorageä¸­æ²¡æœ‰æ´»åŠ¨æ•°æ®');
                }
            } catch (error) {
                showStatus('âŒ æµ‹è¯•å¤±è´¥: ' + error.message, 'error');
                log('âŒ æµ‹è¯•å¤±è´¥: ' + error.message);
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•
        window.onload = function() {
            log('ğŸ”§ æ´»åŠ¨è¯¦æƒ…ä¿®å¤å·¥å…·å·²åŠ è½½');
            setTimeout(testFix, 500);
        };
    </script>
</body>
</html>