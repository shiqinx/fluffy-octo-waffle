<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ´»åŠ¨æ•°æ®å¿«é€Ÿä¿®å¤</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        button {
            background: #1989fa;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        button:hover { background: #1677ff; }
        button.danger { background: #ff4757; }
        button.danger:hover { background: #ff3838; }
        button.success { background: #2ed573; }
        button.success:hover { background: #26d063; }
        .activity-list {
            margin-top: 20px;
        }
        .activity-item {
            border: 1px solid #e8e8e8;
            border-radius: 4px;
            padding: 10px;
            margin: 5px 0;
            background: #fafafa;
        }
        .activity-title {
            font-weight: bold;
            color: #333;
        }
        .activity-type {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            color: white;
            margin-left: 10px;
        }
        .type-study { background: #5352ed; }
        .type-culture { background: #ff6b81; }
        .type-tech { background: #00b894; }
        .type-sports { background: #fdcb6e; color: #333; }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ æ´»åŠ¨æ•°æ®å¿«é€Ÿä¿®å¤å·¥å…·</h1>
        
        <div class="status info">
            <strong>é—®é¢˜è¯Šæ–­ï¼š</strong>å¦‚æœæ‰€æœ‰æ´»åŠ¨éƒ½æ˜¾ç¤ºä¸º"ä¸­åŒ»å…»ç”Ÿè®²åº§"ï¼Œè¯´æ˜localStorageä¸­çš„æ•°æ®è¢«æ±¡æŸ“æˆ–é‡å¤äº†ã€‚
        </div>

        <div class="button-group">
            <button onclick="checkCurrentData()">ğŸ“Š æ£€æŸ¥å½“å‰æ•°æ®</button>
            <button onclick="fixActivityData()" class="success">âœ… ä¿®å¤æ´»åŠ¨æ•°æ®</button>
            <button onclick="clearAllData()" class="danger">ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰æ•°æ®</button>
            <button onclick="reloadPage()">ğŸ”„ åˆ·æ–°é¡µé¢</button>
        </div>

        <div id="status"></div>
        <div id="activityList" class="activity-list"></div>
        <div id="log" class="log"></div>
    </div>

    <script>
        function log(message) {
            const logDiv = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${time}] ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        function checkCurrentData() {
            log('å¼€å§‹æ£€æŸ¥å½“å‰æ•°æ®...');
            
            try {
                const storedActivities = localStorage.getItem('campus_activities');
                if (!storedActivities) {
                    showStatus('localStorageä¸­æ²¡æœ‰æ´»åŠ¨æ•°æ®', 'warning');
                    log('localStorageä¸­æ²¡æœ‰campus_activitiesæ•°æ®');
                    return;
                }

                const activities = JSON.parse(storedActivities);
                log(`ä»localStorageè¯»å–åˆ° ${activities.length} ä¸ªæ´»åŠ¨`);
                
                // åˆ†ææ•°æ®é—®é¢˜
                const titleCount = {};
                activities.forEach(activity => {
                    const title = activity.title || 'æœªçŸ¥æ ‡é¢˜';
                    titleCount[title] = (titleCount[title] || 0) + 1;
                });

                log('æ ‡é¢˜ç»Ÿè®¡ï¼š');
                Object.entries(titleCount).forEach(([title, count]) => {
                    log(`  "${title}": ${count}ä¸ª`);
                });

                // æ£€æŸ¥æ˜¯å¦æœ‰é‡å¤æ ‡é¢˜
                const duplicateTitles = Object.entries(titleCount).filter(([title, count]) => count > 1);
                if (duplicateTitles.length > 0) {
                    showStatus(`å‘ç°é‡å¤æ ‡é¢˜ï¼š${duplicateTitles.map(([title]) => title).join(', ')}`, 'error');
                    log('âš ï¸ å‘ç°æ•°æ®é‡å¤é—®é¢˜');
                } else {
                    showStatus('æ•°æ®æ­£å¸¸ï¼Œæ²¡æœ‰é‡å¤æ ‡é¢˜', 'success');
                    log('âœ… æ•°æ®æ£€æŸ¥é€šè¿‡');
                }

                displayActivities(activities);
                
            } catch (error) {
                showStatus(`æ•°æ®æ£€æŸ¥å¤±è´¥ï¼š${error.message}`, 'error');
                log(`âŒ é”™è¯¯ï¼š${error.message}`);
            }
        }

        function displayActivities(activities) {
            const listDiv = document.getElementById('activityList');
            
            if (activities.length === 0) {
                listDiv.innerHTML = '<p>æ²¡æœ‰æ´»åŠ¨æ•°æ®</p>';
                return;
            }

            const typeColors = {
                'study': 'type-study',
                'culture': 'type-culture', 
                'tech': 'type-tech',
                'sports': 'type-sports'
            };

            const typeNames = {
                'study': 'å­¦ä¹ ',
                'culture': 'æ–‡åŒ–',
                'tech': 'æŠ€æœ¯', 
                'sports': 'è¿åŠ¨'
            };

            listDiv.innerHTML = '<h3>å½“å‰æ´»åŠ¨åˆ—è¡¨ï¼š</h3>' + 
                activities.map(activity => `
                    <div class="activity-item">
                        <span class="activity-title">${activity.title}</span>
                        <span class="activity-type ${typeColors[activity.type] || ''}">${typeNames[activity.type] || activity.type}</span>
                        <div>ID: ${activity.id} | åœ°ç‚¹: ${activity.locationName} | å‚ä¸è€…: ${activity.currentParticipants}/${activity.maxParticipants}</div>
                    </div>
                `).join('');
        }

        function fixActivityData() {
            log('å¼€å§‹ä¿®å¤æ´»åŠ¨æ•°æ®...');
            
            try {
                // åˆ›å»ºæ­£ç¡®çš„é»˜è®¤æ´»åŠ¨æ•°æ®
                const defaultActivities = [
                    {
                        id: 1,
                        title: 'ä¸­åŒ»å…»ç”Ÿè®²åº§',
                        type: 'study',
                        category: 'study',
                        locationName: 'å­¦æœ¯æŠ¥å‘Šå…',
                        description: 'é‚€è¯·ä¸­åŒ»ä¸“å®¶è®²è§£ä¸­åŒ»å…»ç”ŸçŸ¥è¯†ï¼Œåˆ†äº«ä¼ ç»Ÿä¿å¥æ–¹æ³•ã€‚',
                        startTime: new Date(Date.now() + 2 * 24 * 60 * 60 * 1000).toISOString(),
                        endTime: new Date(Date.now() + 2 * 24 * 60 * 60 * 1000 + 2 * 60 * 60 * 1000).toISOString(),
                        enrollStartTime: new Date().toISOString(),
                        enrollEndTime: new Date(Date.now() + 2 * 24 * 60 * 60 * 1000 - 2 * 60 * 60 * 1000).toISOString(),
                        currentParticipants: 15,
                        maxParticipants: 30,
                        organizer: { id: 2, name: 'ä¸­åŒ»å­¦é™¢' },
                        distance: 0.8,
                        isEnrolled: false,
                        status: 'open'
                    },
                    {
                        id: 2,
                        title: 'æ‘„å½±ä½œå“å±•è§ˆ',
                        type: 'culture',
                        category: 'culture',
                        locationName: 'è‰ºæœ¯å±•å…',
                        description: 'å±•ç¤ºå­¦ç”Ÿæ‘„å½±ä½œå“ï¼Œåˆ†äº«æ‘„å½±æŠ€å·§ï¼Œäº¤æµåˆ›ä½œå¿ƒå¾—ã€‚',
                        startTime: new Date(Date.now() + 3 * 24 * 60 * 60 * 1000).toISOString(),
                        endTime: new Date(Date.now() + 3 * 24 * 60 * 60 * 1000 + 3 * 60 * 60 * 1000).toISOString(),
                        enrollStartTime: new Date().toISOString(),
                        enrollEndTime: new Date(Date.now() + 3 * 24 * 60 * 60 * 1000 - 3 * 60 * 60 * 1000).toISOString(),
                        currentParticipants: 12,
                        maxParticipants: 25,
                        organizer: { id: 3, name: 'æ‘„å½±åä¼š' },
                        distance: 0.3,
                        isEnrolled: false,
                        status: 'open'
                    },
                    {
                        id: 3,
                        title: 'ç¼–ç¨‹é©¬æ‹‰æ¾å¤§èµ›',
                        type: 'tech',
                        category: 'tech',
                        locationName: 'åˆ›æ–°å®éªŒå®¤',
                        description: '24å°æ—¶ç¼–ç¨‹æŒ‘æˆ˜èµ›ï¼Œä¸»é¢˜ä¸ºæ™ºæ…§æ ¡å›­ï¼Œå±•ç¤ºç¼–ç¨‹æŠ€èƒ½ã€‚',
                        startTime: new Date(Date.now() + 4 * 24 * 60 * 60 * 1000).toISOString(),
                        endTime: new Date(Date.now() + 5 * 24 * 60 * 60 * 1000).toISOString(),
                        enrollStartTime: new Date().toISOString(),
                        enrollEndTime: new Date(Date.now() + 4 * 24 * 60 * 60 * 1000 - 4 * 60 * 60 * 1000).toISOString(),
                        currentParticipants: 8,
                        maxParticipants: 20,
                        organizer: { id: 4, name: 'è®¡ç®—æœºå­¦é™¢' },
                        distance: 1.2,
                        isEnrolled: false,
                        status: 'open'
                    },
                    {
                        id: 4,
                        title: 'ç¯®çƒå‹è°Šèµ›',
                        type: 'sports',
                        category: 'sports',
                        locationName: 'ç¯®çƒåœº1',
                        description: 'å‘¨æœ«ç¯®çƒæ¯”èµ›ï¼Œæ¬¢è¿æ‰€æœ‰ç¯®çƒçˆ±å¥½è€…å‚åŠ ã€‚',
                        startTime: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString(),
                        endTime: new Date(Date.now() + 26 * 60 * 60 * 1000).toISOString(),
                        enrollStartTime: new Date().toISOString(),
                        enrollEndTime: new Date(Date.now() + 12 * 60 * 60 * 1000).toISOString(),
                        currentParticipants: 4,
                        maxParticipants: 8,
                        organizer: { id: 1, name: 'ç¯®çƒç¤¾' },
                        distance: 0.5,
                        isEnrolled: false,
                        status: 'open'
                    },
                    {
                        id: 5,
                        title: 'æ ¡å›­éŸ³ä¹èŠ‚',
                        type: 'culture',
                        category: 'culture',
                        locationName: 'éœ²å¤©å‰§åœº',
                        description: 'å¹´åº¦æ ¡å›­éŸ³ä¹èŠ‚ï¼Œé‚€è¯·æ ¡å†…å¤–ä¹é˜Ÿæ¼”å‡ºï¼Œäº«å—éŸ³ä¹ç››å®´ã€‚',
                        startTime: new Date(Date.now() + 5 * 24 * 60 * 60 * 1000).toISOString(),
                        endTime: new Date(Date.now() + 5 * 24 * 60 * 60 * 1000 + 4 * 60 * 60 * 1000).toISOString(),
                        enrollStartTime: new Date().toISOString(),
                        enrollEndTime: new Date(Date.now() + 5 * 24 * 60 * 60 * 1000 - 4 * 60 * 60 * 1000).toISOString(),
                        currentParticipants: 25,
                        maxParticipants: 40,
                        organizer: { id: 5, name: 'å­¦ç”Ÿä¼š' },
                        distance: 0.6,
                        isEnrolled: false,
                        status: 'open'
                    }
                ];

                // ä¿å­˜åˆ°localStorage
                localStorage.setItem('campus_activities', JSON.stringify(defaultActivities));
                
                log(`âœ… å·²ä¿å­˜ ${defaultActivities.length} ä¸ªæ­£ç¡®çš„æ´»åŠ¨æ•°æ®åˆ°localStorage`);
                showStatus('æ´»åŠ¨æ•°æ®ä¿®å¤æˆåŠŸï¼ç°åœ¨åº”è¯¥èƒ½çœ‹åˆ°5ä¸ªä¸åŒçš„æ´»åŠ¨äº†', 'success');
                
                displayActivities(defaultActivities);
                
            } catch (error) {
                showStatus(`ä¿®å¤å¤±è´¥ï¼š${error.message}`, 'error');
                log(`âŒ ä¿®å¤é”™è¯¯ï¼š${error.message}`);
            }
        }

        function clearAllData() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ´»åŠ¨æ•°æ®å—ï¼Ÿè¿™å°†åˆ é™¤localStorageä¸­çš„æ‰€æœ‰campus_activitiesæ•°æ®ã€‚')) {
                localStorage.removeItem('campus_activities');
                localStorage.removeItem('campus_activity_participants');
                localStorage.removeItem('campus_activity_chats');
                
                log('ğŸ—‘ï¸ å·²æ¸…ç©ºæ‰€æœ‰æ´»åŠ¨ç›¸å…³æ•°æ®');
                showStatus('æ‰€æœ‰æ•°æ®å·²æ¸…ç©ºï¼Œåˆ·æ–°é¡µé¢åå°†ä½¿ç”¨é»˜è®¤æ•°æ®', 'warning');
                
                document.getElementById('activityList').innerHTML = '';
            }
        }

        function reloadPage() {
            log('æ­£åœ¨åˆ·æ–°ä¸»é¡µé¢...');
            // å°è¯•åˆ·æ–°ä¸»åº”ç”¨é¡µé¢
            setTimeout(() => {
                window.open('http://localhost:3000/activities', '_blank');
            }, 500);
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥æ•°æ®
        window.onload = function() {
            log('æ´»åŠ¨æ•°æ®ä¿®å¤å·¥å…·å·²åŠ è½½');
            checkCurrentData();
        };
    </script>
</body>
</html>