<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç™»å½•APIè¯¦ç»†è°ƒè¯•</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .debug-log {
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            word-break: break-all;
        }
        .success { color: #10b981; }
        .error { color: #ef4444; }
        .warning { color: #f59e0b; }
        .info { color: #3b82f6; }
    </style>
</head>
<body class="bg-gray-50 p-8">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-3xl font-bold mb-6 text-gray-800">ğŸ” ç™»å½•APIè¯¦ç»†è°ƒè¯•å·¥å…·</h1>
        
        <!-- æµ‹è¯•ç”¨æˆ·ä¿¡æ¯ -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4 text-gray-700">ğŸ“‹ æµ‹è¯•ç”¨æˆ·ä¿¡æ¯</h2>
            <div id="userInfo" class="space-y-2"></div>
        </div>

        <!-- ç™»å½•æµ‹è¯•è¡¨å• -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4 text-gray-700">ğŸ§ª ç™»å½•æµ‹è¯•</h2>
            <div class="grid grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">å­¦å·</label>
                    <input type="text" id="studentId" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" value="2330502143">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">å¯†ç </label>
                    <input type="password" id="password" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" value="abc123456">
                </div>
            </div>
            <div class="flex gap-2">
                <button onclick="testLogin()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition">æµ‹è¯•ç™»å½•</button>
                <button onclick="testUser1()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 transition">æµ‹è¯•ç”¨æˆ·1</button>
                <button onclick="testUser2()" class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600 transition">æµ‹è¯•ç”¨æˆ·2</button>
                <button onclick="clearLogs()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600 transition">æ¸…ç©ºæ—¥å¿—</button>
            </div>
        </div>

        <!-- è°ƒè¯•æ—¥å¿— -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-xl font-semibold mb-4 text-gray-700">ğŸ“ è°ƒè¯•æ—¥å¿—</h2>
            <div id="debugLog" class="debug-log bg-gray-900 text-green-400 p-4 rounded h-96 overflow-y-auto"></div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        window.debugLog = document.getElementById('debugLog');
        window.userInfo = document.getElementById('userInfo');

        // æ—¥å¿—å‡½æ•°
        window.log = function(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = type;
            logEntry.textContent = `[${timestamp}] ${message}`;
            window.debugLog.appendChild(logEntry);
            window.debugLog.scrollTop = window.debugLog.scrollHeight;
            console.log(`[${type.toUpperCase()}] ${message}`);
        };

        // æ¸…ç©ºæ—¥å¿—
        window.clearLogs = function() {
            window.debugLog.innerHTML = '';
            window.log('æ—¥å¿—å·²æ¸…ç©º', 'info');
        };

        // æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯
        window.displayUserInfo = function() {
            // æ¨¡æ‹Ÿç”¨æˆ·æ•°æ®
            const users = [
                {
                    id: 1,
                    studentId: '2330502143',
                    realName: 'å­™é‡‘ç‘¶',
                    password: 'abc123456',
                    department: 'è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯',
                    avatar: '/default-avatar.png',
                    creditScore: 95,
                    bio: 'çƒ­çˆ±ç¼–ç¨‹çš„å­¦ç”Ÿ',
                    interests: ['ç¼–ç¨‹', 'éŸ³ä¹', 'ç”µå½±'],
                    tags: ['ç§¯æ', 'é è°±'],
                    contact: { email: '', phone: '' }
                },
                {
                    id: 2,
                    studentId: '2330502134',
                    realName: 'å¢æ•å©·',
                    password: 'test123456',
                    department: 'è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯',
                    avatar: '/default-avatar.png',
                    creditScore: 92,
                    bio: 'å–œæ¬¢å‚åŠ å„ç§æ´»åŠ¨',
                    interests: ['æ‘„å½±', 'æ—…è¡Œ', 'é˜…è¯»'],
                    tags: ['ç»†å¿ƒ', 'åˆ›æ„'],
                    contact: { email: '', phone: '' }
                }
            ];
            
            window.userInfo.innerHTML = '';
            
            users.forEach((user, index) => {
                const userDiv = document.createElement('div');
                userDiv.className = 'bg-gray-50 p-3 rounded border border-gray-200';
                userDiv.innerHTML = `
                    <div class="font-semibold">ç”¨æˆ· ${index + 1}: ${user.realName}</div>
                    <div class="text-sm text-gray-600">
                        å­¦å·: ${user.studentId} (ç±»å‹: ${typeof user.studentId})<br>
                        å¯†ç : ${user.password} (ç±»å‹: ${typeof user.password}, é•¿åº¦: ${user.password.length})<br>
                        ID: ${user.id} (ç±»å‹: ${typeof user.id})
                    </div>
                `;
                window.userInfo.appendChild(userDiv);
            });
        };

        // æ¨¡æ‹Ÿç™»å½•å‡½æ•°
        window.mockLogin = async function(data) {
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            const studentId = data.studentId || data.username;
            const password = data.password;
            
            window.log(`ğŸ” mockLogin å°è¯•ç™»å½•: studentId="${studentId}", password="${password}"`, 'info');
            
            // æ¨¡æ‹Ÿç”¨æˆ·æ•°æ®
            const users = [
                { id: 1, studentId: '2330502143', realName: 'å­™é‡‘ç‘¶', password: 'abc123456' },
                { id: 2, studentId: '2330502134', realName: 'å¢æ•å©·', password: 'test123456' }
            ];
            
            window.log(`ğŸ“‹ ç”¨æˆ·åˆ—è¡¨: ${JSON.stringify(users.map(u => ({ studentId: u.studentId, password: u.password })))}`, 'info');
            
            // å¢å¼ºç”¨æˆ·åŒ¹é…é€»è¾‘
            let user = null;
            for (const u of users) {
                window.log(`ğŸ” æ¯”è¾ƒç”¨æˆ·: inputStudentId="${studentId}" vs storedStudentId="${u.studentId}" (==: ${u.studentId == studentId}, ===: ${u.studentId === studentId})`, 'info');
                window.log(`ğŸ” æ¯”è¾ƒå¯†ç : inputPassword="${password}" vs storedPassword="${u.password}" (==: ${u.password == password}, ===: ${u.password === password})`, 'info');
                
                if ((u.studentId == studentId) && (u.password == password)) {
                    user = u;
                    break;
                }
            }
            
            if (user) {
                const token = 'mock_jwt_token_' + Date.now();
                const response = {
                    success: true,
                    data: {
                        token: token,
                        user: {
                            id: user.id,
                            realName: user.realName,
                            studentId: user.studentId
                        }
                    },
                    message: 'ç™»å½•æˆåŠŸ'
                };
                
                window.log(`âœ… ç™»å½•æˆåŠŸ: ${JSON.stringify(response)}`, 'success');
                return response;
            } else {
                const error = {
                    success: false,
                    message: 'å­¦å·æˆ–å¯†ç é”™è¯¯'
                };
                window.log(`âŒ ç™»å½•å¤±è´¥: ${JSON.stringify(error)}`, 'error');
                throw error;
            }
        };

        // æµ‹è¯•ç™»å½•
        window.testLogin = async function() {
            const studentId = document.getElementById('studentId').value;
            const password = document.getElementById('password').value;
            
            window.log(`ğŸ§ª å¼€å§‹ç™»å½•æµ‹è¯•`, 'info');
            window.log(`è¾“å…¥å‚æ•°: studentId="${studentId}" (${typeof studentId}), password="${password}" (${typeof password}, é•¿åº¦: ${password.length})`, 'info');
            
            try {
                // æ­¥éª¤1: æµ‹è¯•mockLoginç›´æ¥è°ƒç”¨
                window.log(`ğŸ” æ­¥éª¤1: æµ‹è¯•mockLoginç›´æ¥è°ƒç”¨`, 'info');
                const mockResult = await window.mockLogin({ studentId, password });
                window.log(`âœ… mockLoginæˆåŠŸ: ${JSON.stringify(mockResult)}`, 'success');
                
            } catch (error) {
                window.log(`âŒ ç™»å½•å¤±è´¥: ${JSON.stringify(error)}`, 'error');
                window.log(`é”™è¯¯ç±»å‹: ${typeof error}`, 'error');
                window.log(`é”™è¯¯æ¶ˆæ¯: ${error.message}`, 'error');
                if (error.success !== undefined) {
                    window.log(`é”™è¯¯successå­—æ®µ: ${error.success}`, 'error');
                }
            }
        };

        // æµ‹è¯•ç”¨æˆ·1
        window.testUser1 = async function() {
            document.getElementById('studentId').value = '2330502143';
            document.getElementById('password').value = 'abc123456';
            await window.testLogin();
        };

        // æµ‹è¯•ç”¨æˆ·2
        window.testUser2 = async function() {
            document.getElementById('studentId').value = '2330502134';
            document.getElementById('password').value = 'test123456';
            await window.testLogin();
        };

        // åˆå§‹åŒ–
        window.log('ğŸš€ ç™»å½•APIè°ƒè¯•å·¥å…·åˆå§‹åŒ–', 'info');
        window.displayUserInfo();
        window.log('ğŸ“‹ ç”¨æˆ·ä¿¡æ¯å·²åŠ è½½', 'info');
        window.log('ğŸ’¡ è¯·ç‚¹å‡»æµ‹è¯•æŒ‰é’®å¼€å§‹è°ƒè¯•', 'info');
    </script>
</body>
</html>