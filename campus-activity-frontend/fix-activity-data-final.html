<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸…ç†æ´»åŠ¨æ•°æ®æ±¡æŸ“</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success { background-color: #d4edda; color: #155724; }
        .warning { background-color: #fff3cd; color: #856404; }
        .error { background-color: #f8d7da; color: #721c24; }
        .info { background-color: #d1ecf1; color: #0c5460; }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background-color: #0056b3; }
        button.danger { background-color: #dc3545; }
        button.danger:hover { background-color: #c82333; }
        pre {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ æ¸…ç†æ´»åŠ¨æ•°æ®æ±¡æŸ“å·¥å…·</h1>
        
        <div id="status" class="status info">
            æ­£åœ¨æ£€æŸ¥å½“å‰æ•°æ®çŠ¶æ€...
        </div>

        <div class="actions">
            <button onclick="checkCurrentData()">ğŸ“Š æ£€æŸ¥å½“å‰æ•°æ®</button>
            <button onclick="fixActivityData()" class="danger">ğŸ”§ ä¿®å¤æ´»åŠ¨æ•°æ®</button>
            <button onclick="clearAllData()" class="danger">ğŸ—‘ï¸ æ¸…ç†æ‰€æœ‰æ•°æ®</button>
            <button onclick="reloadPage()">ğŸ”„ é‡æ–°åŠ è½½é¡µé¢</button>
        </div>

        <div id="dataDisplay"></div>
    </div>

    <script>
        function updateStatus(message, type = 'info') {
            const statusEl = document.getElementById('status');
            statusEl.className = `status ${type}`;
            statusEl.textContent = message;
        }

        function displayData(title, data) {
            const displayEl = document.getElementById('dataDisplay');
            const section = document.createElement('div');
            section.innerHTML = `
                <h3>${title}</h3>
                <pre>${JSON.stringify(data, null, 2)}</pre>
            `;
            displayEl.appendChild(section);
        }

        function checkCurrentData() {
            updateStatus('æ­£åœ¨æ£€æŸ¥å½“å‰æ•°æ®...', 'info');
            document.getElementById('dataDisplay').innerHTML = '';

            try {
                // æ£€æŸ¥localStorageä¸­çš„æ´»åŠ¨æ•°æ®
                const storedActivities = localStorage.getItem('campus_activities');
                if (storedActivities) {
                    const activities = JSON.parse(storedActivities);
                    displayData(`localStorageä¸­çš„æ´»åŠ¨æ•°æ® (${activities.length}ä¸ª)`, activities);
                    
                    // æ£€æŸ¥æ•°æ®æ±¡æŸ“æƒ…å†µ
                    const titles = activities.map(a => a.title);
                    const uniqueTitles = [...new Set(titles)];
                    const duplicates = titles.filter((title, index) => titles.indexOf(title) !== index);
                    
                    if (duplicates.length > 0) {
                        updateStatus(`å‘ç°æ•°æ®æ±¡æŸ“ï¼æœ‰${duplicates.length}ä¸ªé‡å¤çš„æ´»åŠ¨æ ‡é¢˜`, 'error');
                        displayData('é‡å¤çš„æ´»åŠ¨æ ‡é¢˜', duplicates);
                    } else if (uniqueTitles.length === 1 && uniqueTitles[0] === 'ä¸­åŒ»å…»ç”Ÿè®²åº§') {
                        updateStatus('å‘ç°ä¸¥é‡æ•°æ®æ±¡æŸ“ï¼æ‰€æœ‰æ´»åŠ¨éƒ½æ˜¾ç¤ºä¸º"ä¸­åŒ»å…»ç”Ÿè®²åº§"', 'error');
                    } else {
                        updateStatus(`æ•°æ®æ£€æŸ¥å®Œæˆï¼Œå…±${activities.length}ä¸ªæ´»åŠ¨ï¼Œæœªå‘ç°æ˜æ˜¾æ±¡æŸ“`, 'success');
                    }
                } else {
                    updateStatus('localStorageä¸­æ²¡æœ‰æ´»åŠ¨æ•°æ®', 'warning');
                }

                // æ£€æŸ¥å…¶ä»–å¯èƒ½çš„æ•°æ®æº
                const keys = Object.keys(localStorage);
                const activityKeys = keys.filter(key => key.includes('activity') || key.includes('æ´»åŠ¨'));
                if (activityKeys.length > 0) {
                    displayData('æ‰€æœ‰æ´»åŠ¨ç›¸å…³çš„localStorageé”®', activityKeys);
                    activityKeys.forEach(key => {
                        try {
                            const data = JSON.parse(localStorage.getItem(key));
                            displayData(`${key} æ•°æ®`, data);
                        } catch (e) {
                            displayData(`${key} æ•°æ® (è§£æå¤±è´¥)`, localStorage.getItem(key));
                        }
                    });
                }

            } catch (error) {
                updateStatus(`æ£€æŸ¥æ•°æ®æ—¶å‡ºé”™: ${error.message}`, 'error');
                displayData('é”™è¯¯è¯¦æƒ…', error);
            }
        }

        function fixActivityData() {
            updateStatus('æ­£åœ¨ä¿®å¤æ´»åŠ¨æ•°æ®...', 'info');
            
            try {
                // æ¸…ç†è¢«æ±¡æŸ“çš„æ•°æ®
                localStorage.removeItem('campus_activities');
                
                // è®¾ç½®æ­£ç¡®çš„é»˜è®¤æ´»åŠ¨æ•°æ®
                const defaultActivities = [
                    {
                        id: 1,
                        title: 'ä¸­åŒ»å…»ç”Ÿè®²åº§',
                        type: 'study',
                        category: 'study',
                        locationName: 'å­¦æœ¯æŠ¥å‘Šå…',
                        description: 'é‚€è¯·ä¸­åŒ»ä¸“å®¶è®²è§£ä¸­åŒ»å…»ç”ŸçŸ¥è¯†ï¼Œåˆ†äº«ä¼ ç»Ÿä¿å¥æ–¹æ³•ã€‚',
                        startTime: new Date(Date.now() + 2 * 24 * 60 * 60 * 1000).toISOString(),
                        endTime: new Date(Date.now() + 2 * 24 * 60 * 60 * 1000 + 2 * 60 * 60 * 1000).toISOString(),
                        currentParticipants: 15,
                        maxParticipants: 30,
                        organizer: { id: 2, name: 'ä¸­åŒ»å­¦é™¢', avatar: '', role: 'ç»„ç»‡è€…', creditScore: 98 },
                        distance: 0.8,
                        isEnrolled: false,
                        isApproved: false,
                        status: 'open'
                    },
                    {
                        id: 2,
                        title: 'æ‘„å½±ä½œå“å±•è§ˆ',
                        type: 'culture',
                        category: 'culture',
                        locationName: 'è‰ºæœ¯å±•å…',
                        description: 'å±•ç¤ºå­¦ç”Ÿæ‘„å½±ä½œå“ï¼Œåˆ†äº«æ‘„å½±æŠ€å·§ï¼Œäº¤æµåˆ›ä½œå¿ƒå¾—ã€‚',
                        startTime: new Date(Date.now() + 3 * 24 * 60 * 60 * 1000).toISOString(),
                        endTime: new Date(Date.now() + 3 * 24 * 60 * 60 * 1000 + 3 * 60 * 60 * 1000).toISOString(),
                        currentParticipants: 12,
                        maxParticipants: 25,
                        organizer: { id: 3, name: 'æ‘„å½±åä¼š', avatar: '', role: 'ç»„ç»‡è€…', creditScore: 92 },
                        distance: 0.3,
                        isEnrolled: false,
                        isApproved: false,
                        status: 'open'
                    },
                    {
                        id: 3,
                        title: 'ç¼–ç¨‹é©¬æ‹‰æ¾å¤§èµ›',
                        type: 'tech',
                        category: 'tech',
                        locationName: 'åˆ›æ–°å®éªŒå®¤',
                        description: '24å°æ—¶ç¼–ç¨‹æŒ‘æˆ˜èµ›ï¼Œä¸»é¢˜ä¸ºæ™ºæ…§æ ¡å›­ï¼Œå±•ç¤ºç¼–ç¨‹æŠ€èƒ½ã€‚',
                        startTime: new Date(Date.now() + 4 * 24 * 60 * 60 * 1000).toISOString(),
                        endTime: new Date(Date.now() + 5 * 24 * 60 * 60 * 1000).toISOString(),
                        currentParticipants: 8,
                        maxParticipants: 20,
                        organizer: { id: 4, name: 'è®¡ç®—æœºå­¦é™¢', avatar: '', role: 'ç»„ç»‡è€…', creditScore: 96 },
                        distance: 1.2,
                        isEnrolled: false,
                        isApproved: false,
                        status: 'open'
                    },
                    {
                        id: 4,
                        title: 'éŸ³ä¹èŠ‚',
                        type: 'culture',
                        category: 'culture',
                        locationName: 'éœ²å¤©å‰§åœº',
                        description: 'å¹´åº¦æ ¡å›­éŸ³ä¹èŠ‚ï¼Œé‚€è¯·æ ¡å†…å¤–ä¹é˜Ÿæ¼”å‡ºï¼Œäº«å—éŸ³ä¹ç››å®´ã€‚',
                        startTime: new Date(Date.now() + 5 * 24 * 60 * 60 * 1000).toISOString(),
                        endTime: new Date(Date.now() + 5 * 24 * 60 * 60 * 1000 + 4 * 60 * 60 * 1000).toISOString(),
                        currentParticipants: 25,
                        maxParticipants: 40,
                        organizer: { id: 5, name: 'å­¦ç”Ÿä¼š', avatar: '', role: 'ç»„ç»‡è€…', creditScore: 94 },
                        distance: 0.6,
                        isEnrolled: false,
                        isApproved: false,
                        status: 'open'
                    },
                    {
                        id: 5,
                        title: 'ç¯®çƒå‹è°Šèµ›',
                        type: 'sports',
                        category: 'sports',
                        locationName: 'ç¯®çƒåœº1',
                        description: 'å‘¨æœ«ç¯®çƒæ¯”èµ›ï¼Œæ¬¢è¿æ‰€æœ‰ç¯®çƒçˆ±å¥½è€…å‚åŠ ã€‚',
                        startTime: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString(),
                        endTime: new Date(Date.now() + 26 * 60 * 60 * 1000).toISOString(),
                        currentParticipants: 4,
                        maxParticipants: 8,
                        organizer: { id: 1, name: 'ç¯®çƒç¤¾', avatar: '', role: 'ç»„ç»‡è€…', creditScore: 95 },
                        distance: 0.5,
                        isEnrolled: false,
                        isApproved: false,
                        status: 'open'
                    }
                ];

                localStorage.setItem('campus_activities', JSON.stringify(defaultActivities));
                updateStatus('âœ… æ´»åŠ¨æ•°æ®ä¿®å¤æˆåŠŸï¼å·²æ¢å¤5ä¸ªä¸åŒçš„æ´»åŠ¨', 'success');
                displayData('ä¿®å¤åçš„æ´»åŠ¨æ•°æ®', defaultActivities);

            } catch (error) {
                updateStatus(`ä¿®å¤æ•°æ®æ—¶å‡ºé”™: ${error.message}`, 'error');
                displayData('é”™è¯¯è¯¦æƒ…', error);
            }
        }

        function clearAllData() {
            if (confirm('ç¡®å®šè¦æ¸…ç†æ‰€æœ‰localStorageæ•°æ®å—ï¼Ÿè¿™å°†åˆ é™¤æ‰€æœ‰æœ¬åœ°å­˜å‚¨çš„æ•°æ®ã€‚')) {
                try {
                    const keys = Object.keys(localStorage);
                    keys.forEach(key => localStorage.removeItem(key));
                    updateStatus('âœ… æ‰€æœ‰localStorageæ•°æ®å·²æ¸…ç†', 'success');
                } catch (error) {
                    updateStatus(`æ¸…ç†æ•°æ®æ—¶å‡ºé”™: ${error.message}`, 'error');
                }
            }
        }

        function reloadPage() {
            if (confirm('ç¡®å®šè¦é‡æ–°åŠ è½½é¡µé¢å—ï¼Ÿ')) {
                window.location.reload();
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥æ•°æ®
        window.onload = function() {
            checkCurrentData();
        };
    </script>
</body>
</html>