# 🧪 前端单元测试配置指南

## 📋 当前测试状况

### ❌ 缺少的测试组件
- **测试框架**: 无 Jest 或 Vitest
- **测试脚本**: package.json 中无 test 命令
- **测试配置**: 无配置文件
- **自动化测试**: 无法 CI/CD 集成

### ✅ 现有的测试资源
- `src/test/location-test.js` - 手动测试函数
- `src/utils/apiTests.js` - API 测试套件
- `public/test-*.html` - 集成测试页面

## 🎯 推荐测试方案

### 方案一：Vitest (推荐)
```bash
# 安装依赖
npm install -D vitest @vue/test-utils jsdom

# 添加测试脚本
npm run test:unit
```

**优势**:
- 与 Vite 完美集成
- 启动速度快
- 支持 Vue 3 Composition API
- ESM 原生支持

### 方案二：Jest
```bash
# 安装依赖
npm install -D jest @vue/test-utils vue-jest babel-jest

# 添加测试脚本
npm run test
```

**优势**:
- 成熟稳定
- 生态丰富
- 文档完善

## 📁 建议的测试目录结构

```
src/
├── __tests__/              # 单元测试文件
│   ├── components/         # 组件测试
│   ├── stores/            # 状态管理测试
│   ├── utils/             # 工具函数测试
│   └── api/               # API 函数测试
├── test/                  # 现有手动测试 (保持)
└── utils/
    └── apiTests.js        # 现有 API 测试 (保持)
```

## 🎯 测试覆盖范围

### 1. 组件测试
```javascript
// 示例：测试组件渲染
import { mount } from '@vue/test-utils'
import MyComponent from '@/components/MyComponent.vue'

describe('MyComponent', () => {
  it('should render correctly', () => {
    const wrapper = mount(MyComponent)
    expect(wrapper.exists()).toBe(true)
  })
})
```

### 2. 工具函数测试
```javascript
// 示例：测试工具函数
import { formatDate } from '@/utils/date'

describe('formatDate', () => {
  it('should format date correctly', () => {
    const date = new Date('2024-01-01')
    expect(formatDate(date)).toBe('2024-01-01')
  })
})
```

### 3. API 测试
```javascript
// 示例：测试 API 函数
import { createTeam } from '@/api/team'
import axios from 'axios'

jest.mock('axios')

describe('createTeam', () => {
  it('should create team successfully', async () => {
    const mockData = { teamName: 'Test Team' }
    axios.post.mockResolvedValue({ data: { success: true } })
    
    const result = await createTeam(mockData)
    expect(result.success).toBe(true)
  })
})
```

### 4. Store 测试
```javascript
// 示例：测试 Pinia Store
import { setActivePinia, createPinia } from 'pinia'
import { useAuthStore } from '@/stores/auth'

describe('Auth Store', () => {
  beforeEach(() => {
    setActivePinia(createPinia())
  })

  it('should login successfully', () => {
    const authStore = useAuthStore()
    authStore.login({ token: 'test-token' })
    expect(authStore.isAuthenticated).toBe(true)
  })
})
```

## 📊 测试配置文件

### Vitest 配置 (vitest.config.js)
```javascript
import { defineConfig } from 'vitest/config'
import vue from '@vitejs/plugin-vue'

export default defineConfig({
  plugins: [vue()],
  test: {
    environment: 'jsdom',
    globals: true,
    setupFiles: ['./src/test/setup.js']
  }
})
```

### Jest 配置 (jest.config.js)
```javascript
export default {
  testEnvironment: 'jsdom',
  transform: {
    '^.+\\.vue$': '@vue/vue3-jest',
    '^.+\\js$': 'babel-jest'
  },
  moduleFileExtensions: ['vue', 'js', 'json'],
  testMatch: ['**/__tests__/**/*.test.js']
}
```

## 🚀 快速开始

### 1. 选择测试框架并安装
```bash
# Vitest (推荐)
npm install -D vitest @vue/test-utils jsdom

# 或 Jest
npm install -D jest @vue/test-utils vue-jest babel-jest
```

### 2. 添加测试脚本到 package.json
```json
{
  "scripts": {
    "test": "vitest",  // 或 "jest"
    "test:watch": "vitest --watch",  // 或 "jest --watch"
    "test:coverage": "vitest --coverage"  // 或 "jest --coverage"
  }
}
```

### 3. 创建第一个测试文件
```bash
# 创建组件测试
touch src/__tests__/components/HelloWorld.test.js

# 创建工具函数测试
touch src/__tests__/utils/date.test.js
```

### 4. 运行测试
```bash
# 运行所有测试
npm run test

# 监听模式
npm run test:watch

# 生成覆盖率报告
npm run test:coverage
```

## 📈 测试最佳实践

### 1. 测试命名规范
- 文件名：`*.test.js` 或 `*.spec.js`
- 测试描述：使用 `should...` 格式
- 测试分组：使用 `describe` 组织相关测试

### 2. 测试结构 (AAA 模式)
```javascript
it('should calculate total price correctly', () => {
  // Arrange - 准备测试数据
  const items = [{ price: 10 }, { price: 20 }]
  const expected = 30
  
  // Act - 执行被测试的操作
  const result = calculateTotal(items)
  
  // Assert - 验证结果
  expect(result).toBe(expected)
})
```

### 3. 测试覆盖率目标
- **语句覆盖率**: > 80%
- **分支覆盖率**: > 75%
- **函数覆盖率**: > 85%
- **行覆盖率**: > 80%

### 4. Mock 和 Stub
```javascript
// Mock API 调用
jest.mock('@/api/team', () => ({
  createTeam: jest.fn().mockResolvedValue({ success: true })
}))

// Stub 工具函数
const mockDate = new Date('2024-01-01')
jest.spyOn(global, 'Date').mockImplementation(() => mockDate)
```

## 🔧 集成到 CI/CD

### GitHub Actions 示例
```yaml
name: Tests
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v2
        with:
          node-version: '18'
      - run: npm install
      - run: npm run test
      - run: npm run test:coverage
```

## 📝 测试检查清单

### ✅ 基础配置
- [ ] 安装测试框架依赖
- [ ] 配置测试文件
- [ ] 添加测试脚本
- [ ] 设置测试环境

### ✅ 测试文件
- [ ] 组件测试文件
- [ ] 工具函数测试
- [ ] API 函数测试
- [ ] Store 状态测试

### ✅ 测试质量
- [ ] 测试覆盖率 > 80%
- [ ] 测试描述清晰
- [ ] 测试数据独立
- [ ] Mock 使用合理

### ✅ 持续集成
- [ ] CI/CD 配置
- [ ] 自动化测试运行
- [ ] 覆盖率报告
- [ ] 测试结果通知

## 🎯 下一步行动

1. **选择测试框架** (推荐 Vitest)
2. **安装依赖并配置**
3. **编写核心组件测试**
4. **设置 CI/CD 集成**
5. **监控测试覆盖率**

---

**准备好配置单元测试了吗？我可以帮您：**
- 安装和配置测试框架
- 编写第一个测试文件
- 设置测试覆盖率报告
- 集成到开发工作流