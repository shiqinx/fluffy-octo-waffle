<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç™»å½•é—®é¢˜è°ƒè¯•</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .result { margin: 10px 0; padding: 10px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        input { margin: 5px; padding: 5px; }
        button { padding: 10px 15px; margin: 5px; }
        pre { background: #f8f9fa; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>ğŸ” ç™»å½•é—®é¢˜è°ƒè¯•</h1>
    
    <div class="test-section">
        <h2>æ¨¡æ‹Ÿç™»å½•é¡µé¢è°ƒç”¨</h2>
        <input type="text" id="studentId" value="" placeholder="å­¦å·">
        <input type="password" id="password" value="123456" placeholder="å¯†ç ">
        <button onclick="simulateLogin()">æ¨¡æ‹Ÿç™»å½•æµç¨‹</button>
        <div id="loginResult"></div>
    </div>

    <div class="test-section">
        <h2>æµ‹è¯•ä¸åŒå­¦å·å€¼</h2>
        <button onclick="testStudentIdValues()">æµ‹è¯•å­¦å·å€¼</button>
        <div id="studentIdResult"></div>
    </div>

    <script type="module">
        import { validateLoginParams } from './src/utils/validation.js'
        import { login } from './src/api/auth.js'
        
        window.simulateLogin = async function() {
            const studentId = document.getElementById('studentId').value
            const password = document.getElementById('password').value
            const resultDiv = document.getElementById('loginResult')
            
            resultDiv.innerHTML = '<div class="result">æ¨¡æ‹Ÿç™»å½•ä¸­...</div>'
            
            try {
                console.log('ğŸ” æ­¥éª¤1: è¡¨å•æ•°æ®', { studentId, password })
                
                // æ¨¡æ‹Ÿ authStore.loginUser çš„é€»è¾‘
                console.log('ğŸ” æ­¥éª¤2: æ„é€ ç™»å½•å‡­æ®å¯¹è±¡')
                const credentials = { studentId, password, rememberMe: false }
                console.log('ğŸ“ ç™»å½•å‡­æ®:', credentials)
                
                // æ­¥éª¤3: éªŒè¯å‚æ•°
                console.log('ğŸ” æ­¥éª¤3: éªŒè¯ç™»å½•å‚æ•°')
                const validatedCredentials = await validateLoginParams(credentials)
                console.log('âœ… éªŒè¯åçš„å‡­æ®:', validatedCredentials)
                
                // æ­¥éª¤4: è°ƒç”¨ç™»å½•API
                console.log('ğŸ” æ­¥éª¤4: è°ƒç”¨ç™»å½•API')
                const loginResult = await login(validatedCredentials)
                console.log('âœ… ç™»å½•ç»“æœ:', loginResult)
                
                resultDiv.innerHTML = `<div class="result success">
                    <strong>ç™»å½•æµç¨‹æµ‹è¯•æˆåŠŸ!</strong><br>
                    <pre>åŸå§‹è¡¨å•: ${JSON.stringify({ studentId, password }, null, 2)}
ç™»å½•å‡­æ®: ${JSON.stringify(credentials, null, 2)}
éªŒè¯åå‡­æ®: ${JSON.stringify(validatedCredentials, null, 2)}
ç™»å½•ç»“æœ: ${JSON.stringify(loginResult, null, 2)}</pre>
                </div>`
            } catch (error) {
                console.error('âŒ ç™»å½•æµç¨‹æµ‹è¯•å¤±è´¥:', error)
                
                resultDiv.innerHTML = `<div class="result error">
                    <strong>ç™»å½•æµç¨‹æµ‹è¯•å¤±è´¥!</strong><br>
                    <pre>é”™è¯¯: ${error.message || error}
é”™è¯¯è¯¦æƒ…: ${error.stack || 'æ— å †æ ˆä¿¡æ¯'}</pre>
                </div>`
            }
        }
        
        window.testStudentIdValues = async function() {
            const resultDiv = document.getElementById('studentIdResult')
            const password = '123456'
            
            resultDiv.innerHTML = '<div class="result">æµ‹è¯•ä¸­...</div>'
            
            const testCases = [
                { studentId: '', description: 'ç©ºå­—ç¬¦ä¸²' },
                { studentId: null, description: 'nullå€¼' },
                { studentId: undefined, description: 'undefinedå€¼' },
                { studentId: '20210001', description: 'æœ‰æ•ˆå­¦å·' },
                { studentId: 'abc', description: 'æ— æ•ˆå­¦å·æ ¼å¼' },
                { studentId: '123', description: 'å¤ªçŸ­çš„å­¦å·' }
            ]
            
            let results = []
            
            for (const testCase of testCases) {
                try {
                    console.log(`ğŸ” æµ‹è¯•å­¦å·: ${testCase.description} (${testCase.studentId})`)
                    
                    const credentials = { studentId: testCase.studentId, password, rememberMe: false }
                    const validatedCredentials = await validateLoginParams(credentials)
                    
                    results.push({
                        case: testCase.description,
                        input: testCase.studentId,
                        result: 'âœ… æˆåŠŸ',
                        data: validatedCredentials
                    })
                } catch (error) {
                    results.push({
                        case: testCase.description,
                        input: testCase.studentId,
                        result: 'âŒ å¤±è´¥',
                        error: error.message
                    })
                }
            }
            
            resultDiv.innerHTML = `<div class="result">
                <strong>å­¦å·å€¼æµ‹è¯•å®Œæˆ!</strong><br>
                <pre>${JSON.stringify(results, null, 2)}</pre>
            </div>`
        }
    </script>
</body>
</html>