<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ´»åŠ¨è¯¦æƒ…ä¿®å¤éªŒè¯</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .activity-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        .activity-card {
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .activity-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            border-color: #667eea;
        }
        .activity-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 8px;
        }
        .activity-info {
            font-size: 14px;
            opacity: 0.9;
        }
        .test-result {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .success {
            border-left: 4px solid #4CAF50;
            background-color: #f1f8e9;
        }
        .error {
            border-left: 4px solid #f44336;
            background-color: #ffebee;
        }
        .warning {
            border-left: 4px solid #ff9800;
            background-color: #fff3e0;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            margin: 10px 0;
            max-height: 200px;
            overflow-y: auto;
        }
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        .btn:hover {
            background: #0056b3;
        }
        .btn.success {
            background: #28a745;
        }
        .btn.error {
            background: #dc3545;
        }
        .current-detail {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .test-status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        .status-pass {
            background: #d4edda;
            color: #155724;
        }
        .status-fail {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ æ´»åŠ¨è¯¦æƒ…ä¿®å¤éªŒè¯å·¥å…·</h1>
        <p>æ­¤å·¥å…·ç”¨äºéªŒè¯æ´»åŠ¨åˆ—è¡¨è·³è½¬åˆ°ä¸åŒè¯¦æƒ…é¡µçš„ä¿®å¤æ•ˆæœ</p>
    </div>

    <div class="container">
        <h2>ğŸ“‹ æµ‹è¯•æ´»åŠ¨åˆ—è¡¨</h2>
        <p>ç‚¹å‡»ä¸‹é¢çš„æ´»åŠ¨å¡ç‰‡æ¥æµ‹è¯•è·¯ç”±è·³è½¬å’Œè¯¦æƒ…è·å–</p>
        <div class="activity-list" id="activityList"></div>
    </div>

    <div class="current-detail" id="currentDetail" style="display: none;">
        <h3>ğŸ“ å½“å‰æ˜¾ç¤ºçš„æ´»åŠ¨è¯¦æƒ…</h3>
        <div id="currentDetailContent"></div>
    </div>

    <div class="container">
        <h2>ğŸ§ª è‡ªåŠ¨åŒ–æµ‹è¯•</h2>
        <button class="btn" onclick="runAutoTest()">è¿è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•</button>
        <button class="btn success" onclick="clearResults()">æ¸…é™¤ç»“æœ</button>
        <div id="testResults"></div>
    </div>

    <div class="container">
        <h2>ğŸ“ æµ‹è¯•æ—¥å¿—</h2>
        <div class="log" id="testLog"></div>
        <button class="btn" onclick="clearLog()">æ¸…é™¤æ—¥å¿—</button>
    </div>

    <script>
        // æ¨¡æ‹Ÿ correctActivities æ•°æ®ï¼ˆä¸ mock.js ä¸­å®Œå…¨ä¸€è‡´ï¼‰
        const correctActivities = [
            {
                id: "1",
                title: "ä¸­åŒ»å…»ç”Ÿè®²åº§",
                type: "å­¦æœ¯è®²åº§",
                location: "æ•™å­¦æ¥¼A101",
                description: "æ¢è®¨ä¸­åŒ»å…»ç”Ÿç†å¿µå’Œæ–¹æ³•",
                startTime: "2024-01-15 14:00",
                endTime: "2024-01-15 16:00",
                organizer: "å¥åº·åä¼š",
                capacity: 100,
                enrolled: 45
            },
            {
                id: "2",
                title: "æ‘„å½±ä½œå“å±•è§ˆ",
                type: "æ–‡åŒ–è‰ºæœ¯",
                location: "è‰ºæœ¯ä¸­å¿ƒå±•å…",
                description: "å±•ç¤ºå­¦ç”Ÿä¼˜ç§€æ‘„å½±ä½œå“",
                startTime: "2024-01-16 10:00",
                endTime: "2024-01-20 18:00",
                organizer: "æ‘„å½±åä¼š",
                capacity: 200,
                enrolled: 120
            },
            {
                id: "3",
                title: "ç¼–ç¨‹é©¬æ‹‰æ¾å¤§èµ›",
                type: "ç§‘æŠ€åˆ›æ–°",
                location: "è®¡ç®—æœºå®éªŒå®¤",
                description: "48å°æ—¶ç¼–ç¨‹æŒ‘æˆ˜èµ›",
                startTime: "2024-01-17 09:00",
                endTime: "2024-01-19 09:00",
                organizer: "è®¡ç®—æœºåä¼š",
                capacity: 50,
                enrolled: 35
            },
            {
                id: "4",
                title: "ç¯®çƒå‹è°Šèµ›",
                type: "ä½“è‚²ç«æŠ€",
                location: "ä½“è‚²é¦†",
                description: "é™¢ç³»ç¯®çƒå‹è°Šæ¯”èµ›",
                startTime: "2024-01-18 15:00",
                endTime: "2024-01-18 17:00",
                organizer: "ä½“è‚²éƒ¨",
                capacity: 300,
                enrolled: 200
            },
            {
                id: "5",
                title: "æ ¡å›­éŸ³ä¹èŠ‚",
                type: "æ–‡è‰ºæ¼”å‡º",
                location: "å¤§ç¤¼å ‚",
                description: "å¹´åº¦æ ¡å›­éŸ³ä¹ç››å…¸",
                startTime: "2024-01-19 19:00",
                endTime: "2024-01-19 21:30",
                organizer: "å­¦ç”Ÿä¼š",
                capacity: 500,
                enrolled: 450
            },
            {
                id: "6",
                title: "å›¾ä¹¦é¦†å­¦ä¹ å°ç»„",
                type: "å­¦ä¹ äº¤æµ",
                location: "å›¾ä¹¦é¦†ä¸‰æ¥¼ç ”è®¨å®¤",
                description: "æœŸæœ«å¤ä¹ å­¦ä¹ å°ç»„",
                startTime: "2024-01-20 14:00",
                endTime: "2024-01-20 16:00",
                organizer: "å­¦ä¹ éƒ¨",
                capacity: 30,
                enrolled: 25
            }
        ];

        // ä¿®å¤åçš„ mockGetActivityDetail å‡½æ•°
        function mockGetActivityDetail(activityId) {
            log(`ğŸ” mockGetActivityDetail è¢«è°ƒç”¨ï¼ŒactivityId: ${activityId} (ç±»å‹: ${typeof activityId})`);
            
            // ä¿®å¤åçš„é€»è¾‘ï¼šä½¿ç”¨ä¸¥æ ¼ç›¸ç­‰å’Œå­—ç¬¦ä¸²è½¬æ¢
            let activity = correctActivities.find(act => String(act.id) === String(activityId));
            
            if (activity) {
                log(`âœ… æ‰¾åˆ°æ´»åŠ¨: ${activity.title} (ID: ${activity.id})`);
                return {
                    success: true,
                    data: activity
                };
            } else {
                log(`âŒ æ´»åŠ¨ä¸å­˜åœ¨ï¼ŒactivityId: ${activityId}`);
                return {
                    success: false,
                    message: 'æ´»åŠ¨ä¸å­˜åœ¨'
                };
            }
        }

        // æ—¥å¿—å‡½æ•°
        function log(message) {
            const logDiv = document.getElementById('testLog');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${timestamp}] ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        // æ¸²æŸ“æ´»åŠ¨åˆ—è¡¨
        function renderActivityList() {
            const listContainer = document.getElementById('activityList');
            listContainer.innerHTML = '';
            
            correctActivities.forEach(activity => {
                const card = document.createElement('div');
                card.className = 'activity-card';
                card.innerHTML = `
                    <div class="activity-title">${activity.title}</div>
                    <div class="activity-info">
                        <div>ğŸ†” ID: ${activity.id}</div>
                        <div>ğŸ“‚ ç±»å‹: ${activity.type}</div>
                        <div>ğŸ“ åœ°ç‚¹: ${activity.location}</div>
                        <div>ğŸ‘¥ å·²æŠ¥å: ${activity.enrolled}/${activity.capacity}</div>
                    </div>
                `;
                card.onclick = () => testActivityClick(activity.id);
                listContainer.appendChild(card);
            });
        }

        // æµ‹è¯•æ´»åŠ¨ç‚¹å‡»
        function testActivityClick(activityId) {
            log(`\nğŸ–±ï¸  æµ‹è¯•ç‚¹å‡»æ´»åŠ¨ ID: ${activityId}`);
            
            // æ¨¡æ‹Ÿè·¯ç”±è·³è½¬
            const routeUrl = `/activities/${activityId}`;
            log(`ğŸ“ æ¨¡æ‹Ÿè·¯ç”±URL: ${routeUrl}`);
            
            // ä»URLä¸­æå–IDï¼ˆæ¨¡æ‹Ÿè·¯ç”±å‚æ•°ï¼‰
            const extractedId = routeUrl.split('/').pop();
            log(`ğŸ” ä»è·¯ç”±æå–çš„ID: ${extractedId} (ç±»å‹: ${typeof extractedId})`);
            
            // è°ƒç”¨ä¿®å¤åçš„å‡½æ•°
            const result = mockGetActivityDetail(extractedId);
            
            // æ˜¾ç¤ºå½“å‰æ´»åŠ¨è¯¦æƒ…
            showCurrentDetail(result, extractedId);
            
            return result;
        }

        // æ˜¾ç¤ºå½“å‰æ´»åŠ¨è¯¦æƒ…
        function showCurrentDetail(result, activityId) {
            const detailDiv = document.getElementById('currentDetail');
            const contentDiv = document.getElementById('currentDetailContent');
            
            if (result.success) {
                const activity = result.data;
                contentDiv.innerHTML = `
                    <div><strong>ğŸ†” æ´»åŠ¨ID:</strong> ${activityId}</div>
                    <div><strong>ğŸ“ æ´»åŠ¨æ ‡é¢˜:</strong> ${activity.title}</div>
                    <div><strong>ğŸ“‚ æ´»åŠ¨ç±»å‹:</strong> ${activity.type}</div>
                    <div><strong>ğŸ“ æ´»åŠ¨åœ°ç‚¹:</strong> ${activity.location}</div>
                    <div><strong>ğŸ“– æ´»åŠ¨æè¿°:</strong> ${activity.description}</div>
                    <div><strong>â° å¼€å§‹æ—¶é—´:</strong> ${activity.startTime}</div>
                    <div><strong>â° ç»“æŸæ—¶é—´:</strong> ${activity.endTime}</div>
                    <div><strong>ğŸ‘¤ ç»„ç»‡è€…:</strong> ${activity.organizer}</div>
                    <div><strong>ğŸ‘¥ æŠ¥åæƒ…å†µ:</strong> ${activity.enrolled}/${activity.capacity}</div>
                `;
            } else {
                contentDiv.innerHTML = `
                    <div><strong>âŒ è·å–å¤±è´¥:</strong> ${result.message}</div>
                    <div><strong>ğŸ†” è¯·æ±‚çš„ID:</strong> ${activityId}</div>
                `;
            }
            
            detailDiv.style.display = 'block';
        }

        // è‡ªåŠ¨åŒ–æµ‹è¯•
        function runAutoTest() {
            log('\nğŸš€ å¼€å§‹è‡ªåŠ¨åŒ–æµ‹è¯•...');
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = '';
            
            let successCount = 0;
            let failCount = 0;
            
            // æµ‹è¯•æ‰€æœ‰æ´»åŠ¨
            correctActivities.forEach(activity => {
                const result = testActivityClick(activity.id);
                
                const resultDiv = document.createElement('div');
                resultDiv.className = 'test-result';
                
                if (result.success && result.data.title === activity.title) {
                    resultDiv.className += ' success';
                    resultDiv.innerHTML = `
                        <strong>âœ… æµ‹è¯•é€šè¿‡</strong>
                        <span class="test-status status-pass">PASS</span>
                        <br>è¯·æ±‚ID: ${activity.id} â†’ è¿”å›: ${result.data.title}
                    `;
                    successCount++;
                } else {
                    resultDiv.className += ' error';
                    resultDiv.innerHTML = `
                        <strong>âŒ æµ‹è¯•å¤±è´¥</strong>
                        <span class="test-status status-fail">FAIL</span>
                        <br>è¯·æ±‚ID: ${activity.id} â†’ æœŸæœ›: ${activity.title} â†’ å®é™…: ${result.success ? result.data.title : 'è·å–å¤±è´¥'}
                    `;
                    failCount++;
                }
                
                resultsDiv.appendChild(resultDiv);
            });
            
            // æµ‹è¯•è¾¹ç•Œæƒ…å†µ
            const edgeCases = ["0", "7", null, undefined, ""];
            edgeCases.forEach(testId => {
                const result = mockGetActivityDetail(testId);
                
                const resultDiv = document.createElement('div');
                resultDiv.className = 'test-result';
                
                if (!result.success) {
                    resultDiv.className += ' success';
                    resultDiv.innerHTML = `
                        <strong>âœ… è¾¹ç•Œæµ‹è¯•é€šè¿‡</strong>
                        <span class="test-status status-pass">PASS</span>
                        <br>è¯·æ±‚ID: ${testId} â†’ æ­£ç¡®è¿”å›å¤±è´¥
                    `;
                    successCount++;
                } else {
                    resultDiv.className += ' warning';
                    resultDiv.innerHTML = `
                        <strong>âš ï¸ è¾¹ç•Œæµ‹è¯•å¼‚å¸¸</strong>
                        <span class="test-status status-fail">WARN</span>
                        <br>è¯·æ±‚ID: ${testId} â†’ åº”è¯¥å¤±è´¥ä½†è¿”å›äº†: ${result.data.title}
                    `;
                    failCount++;
                }
                
                resultsDiv.appendChild(resultDiv);
            });
            
            // æ˜¾ç¤ºæ€»ç»“
            const summaryDiv = document.createElement('div');
            summaryDiv.className = 'test-result';
            const totalTests = correctActivities.length + edgeCases.length;
            const successRate = ((successCount / totalTests) * 100).toFixed(1);
            
            if (failCount === 0) {
                summaryDiv.className += ' success';
                summaryDiv.innerHTML = `
                    <h3>ğŸ‰ æµ‹è¯•å®Œæˆ - å…¨éƒ¨é€šè¿‡ï¼</h3>
                    <p><strong>æ€»æµ‹è¯•æ•°:</strong> ${totalTests}</p>
                    <p><strong>âœ… é€šè¿‡:</strong> ${successCount}</p>
                    <p><strong>âŒ å¤±è´¥:</strong> ${failCount}</p>
                    <p><strong>ğŸ“ˆ æˆåŠŸç‡:</strong> ${successRate}%</p>
                    <p><strong>ğŸ”§ ä¿®å¤çŠ¶æ€:</strong> <span class="test-status status-pass">å·²ç”Ÿæ•ˆ</span></p>
                `;
            } else {
                summaryDiv.className += ' error';
                summaryDiv.innerHTML = `
                    <h3>âš ï¸ æµ‹è¯•å®Œæˆ - ä»æœ‰é—®é¢˜</h3>
                    <p><strong>æ€»æµ‹è¯•æ•°:</strong> ${totalTests}</p>
                    <p><strong>âœ… é€šè¿‡:</strong> ${successCount}</p>
                    <p><strong>âŒ å¤±è´¥:</strong> ${failCount}</p>
                    <p><strong>ğŸ“ˆ æˆåŠŸç‡:</strong> ${successRate}%</p>
                    <p><strong>ğŸ”§ ä¿®å¤çŠ¶æ€:</strong> <span class="test-status status-fail">éœ€è¦æ£€æŸ¥</span></p>
                `;
            }
            
            resultsDiv.appendChild(summaryDiv);
            log(`\nğŸ“Š æµ‹è¯•å®Œæˆ: ${successCount}/${totalTests} é€šè¿‡ (${successRate}%)`);
        }

        // æ¸…é™¤ç»“æœ
        function clearResults() {
            document.getElementById('testResults').innerHTML = '';
        }

        // æ¸…é™¤æ—¥å¿—
        function clearLog() {
            document.getElementById('testLog').innerHTML = '';
        }

        // åˆå§‹åŒ–
        window.onload = function() {
            renderActivityList();
            log('ğŸ”§ æ´»åŠ¨è¯¦æƒ…ä¿®å¤éªŒè¯å·¥å…·å·²åŠ è½½');
            log('ğŸ“‹ å¯ç”¨æ´»åŠ¨æ•°é‡: ' + correctActivities.length);
            log('ğŸ–±ï¸  ç‚¹å‡»æ´»åŠ¨å¡ç‰‡å¼€å§‹æµ‹è¯•ï¼Œæˆ–è¿è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•');
        };
    </script>
</body>
</html>