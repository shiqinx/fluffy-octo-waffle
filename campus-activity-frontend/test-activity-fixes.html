<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ´»åŠ¨åˆ›å»ºå’Œæ˜¾ç¤ºä¿®å¤æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }
        .test-result {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success {
            background-color: #f6ffed;
            border: 1px solid #b7eb8f;
            color: #52c41a;
        }
        .error {
            background-color: #fff2f0;
            border: 1px solid #ffccc7;
            color: #ff4d4f;
        }
        .info {
            background-color: #e6f7ff;
            border: 1px solid #91d5ff;
            color: #1890ff;
        }
        button {
            background-color: #1890ff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #40a9ff;
        }
        .activity-data {
            background-color: #f9f9f9;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>æ´»åŠ¨åˆ›å»ºå’Œæ˜¾ç¤ºä¿®å¤æµ‹è¯•</h1>
    
    <div class="test-section">
        <div class="test-title">1. æµ‹è¯•æ´»åŠ¨åˆ›å»ºåŠŸèƒ½</div>
        <button onclick="testCreateActivity()">åˆ›å»ºæµ‹è¯•æ´»åŠ¨</button>
        <div id="createResult" class="test-result info">ç‚¹å‡»æŒ‰é’®æµ‹è¯•æ´»åŠ¨åˆ›å»ºåŠŸèƒ½</div>
    </div>
    
    <div class="test-section">
        <div class="test-title">2. æµ‹è¯•æ´»åŠ¨çŠ¶æ€è®¡ç®—</div>
        <button onclick="testActivityStatus()">æµ‹è¯•çŠ¶æ€è®¡ç®—</button>
        <div id="statusResult" class="test-result info">ç‚¹å‡»æŒ‰é’®æµ‹è¯•æ´»åŠ¨çŠ¶æ€åŠ¨æ€è®¡ç®—</div>
    </div>
    
    <div class="test-section">
        <div class="test-title">3. æµ‹è¯•åœ°å›¾ä½ç½®ä¿¡æ¯</div>
        <button onclick="testLocationInfo()">æµ‹è¯•ä½ç½®ä¿¡æ¯</button>
        <div id="locationResult" class="test-result info">ç‚¹å‡»æŒ‰é’®æµ‹è¯•åœ°å›¾ä½ç½®ä¿¡æ¯ä¿å­˜</div>
    </div>
    
    <div class="test-section">
        <div class="test-title">4. æµ‹è¯•æ´»åŠ¨åˆ—è¡¨è·å–</div>
        <button onclick="testActivityList()">è·å–æ´»åŠ¨åˆ—è¡¨</button>
        <div id="listResult" class="test-result info">ç‚¹å‡»æŒ‰é’®æµ‹è¯•æ´»åŠ¨åˆ—è¡¨å’ŒçŠ¶æ€æ˜¾ç¤º</div>
    </div>

    <script type="module">
        // å¯¼å…¥å¿…è¦çš„æ¨¡å—
        import { globalDataManager } from './src/api/global-data.js';
        import { mockCreateActivity, mockGetActivityList, mockGetActivityDetail } from './src/api/mock.js';
        import { campusBuildings } from './src/config/map.js';

        // æµ‹è¯•æ•°æ®
        const testActivityData = {
            title: 'æµ‹è¯•æ´»åŠ¨-' + Date.now(),
            category: 'sports',
            description: 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æ´»åŠ¨ï¼Œç”¨äºéªŒè¯ä¿®å¤åçš„åŠŸèƒ½',
            startTime: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString(),
            endTime: new Date(Date.now() + 24 * 60 * 60 * 1000 + 2 * 60 * 60 * 1000).toISOString(),
            location: {
                name: 'ç¯®çƒåœº1',
                address: 'å¹¿ä¸œè¯ç§‘å¤§å­¦äº‘æµ®æ ¡åŒºç¯®çƒåœº1'
            },
            coords: campusBuildings.basketballCourt1.coords,
            maxParticipants: 20,
            tags: ['æµ‹è¯•', 'ä½“è‚²'],
            coverImage: ''
        };

        // ç­‰å¾…å‡½æ•°
        const delay = (ms) => new Promise(resolve => setTimeout(resolve, ms));

        // æµ‹è¯•æ´»åŠ¨åˆ›å»º
        window.testCreateActivity = async function() {
            const resultDiv = document.getElementById('createResult');
            try {
                resultDiv.innerHTML = 'æ­£åœ¨åˆ›å»ºæ´»åŠ¨...';
                resultDiv.className = 'test-result info';
                
                const response = await mockCreateActivity(testActivityData);
                
                if (response.success) {
                    resultDiv.innerHTML = `âœ… æ´»åŠ¨åˆ›å»ºæˆåŠŸï¼<br>æ´»åŠ¨ID: ${response.data.id}<br>æ´»åŠ¨æ ‡é¢˜: ${response.data.title}<div class="activity-data">${JSON.stringify(response.data, null, 2)}</div>`;
                    resultDiv.className = 'test-result success';
                    
                    // ä¿å­˜æ´»åŠ¨IDç”¨äºåç»­æµ‹è¯•
                    window.testActivityId = response.data.id;
                } else {
                    resultDiv.innerHTML = `âŒ æ´»åŠ¨åˆ›å»ºå¤±è´¥: ${response.message}`;
                    resultDiv.className = 'test-result error';
                }
            } catch (error) {
                resultDiv.innerHTML = `âŒ åˆ›å»ºæ´»åŠ¨æ—¶å‘ç”Ÿé”™è¯¯: ${error.message}`;
                resultDiv.className = 'test-result error';
            }
        };

        // æµ‹è¯•æ´»åŠ¨çŠ¶æ€è®¡ç®—
        window.testActivityStatus = async function() {
            const resultDiv = document.getElementById('statusResult');
            try {
                resultDiv.innerHTML = 'æ­£åœ¨æµ‹è¯•æ´»åŠ¨çŠ¶æ€è®¡ç®—...';
                resultDiv.className = 'test-result info';
                
                if (!window.testActivityId) {
                    resultDiv.innerHTML = 'âš ï¸ è¯·å…ˆåˆ›å»ºä¸€ä¸ªæµ‹è¯•æ´»åŠ¨';
                    resultDiv.className = 'test-result error';
                    return;
                }
                
                const response = await mockGetActivityDetail(window.testActivityId);
                
                if (response.success) {
                    const activity = response.data;
                    const statusInfo = `
                        ğŸ“Š æ´»åŠ¨çŠ¶æ€ä¿¡æ¯:<br>
                        â€¢ æ´»åŠ¨æ ‡é¢˜: ${activity.title}<br>
                        â€¢ è®¡ç®—çŠ¶æ€: ${activity.status}<br>
                        â€¢ å¼€å§‹æ—¶é—´: ${new Date(activity.startTime).toLocaleString()}<br>
                        â€¢ ç»“æŸæ—¶é—´: ${new Date(activity.endTime).toLocaleString()}<br>
                        â€¢ æŠ¥åå¼€å§‹: ${activity.enrollStartTime ? new Date(activity.enrollStartTime).toLocaleString() : 'æœªè®¾ç½®'}<br>
                        â€¢ æŠ¥åç»“æŸ: ${activity.enrollEndTime ? new Date(activity.enrollEndTime).toLocaleString() : 'æœªè®¾ç½®'}<br>
                        â€¢ å½“å‰æ—¶é—´: ${new Date().toLocaleString()}
                    `;
                    resultDiv.innerHTML = statusInfo;
                    resultDiv.className = 'test-result success';
                } else {
                    resultDiv.innerHTML = `âŒ è·å–æ´»åŠ¨è¯¦æƒ…å¤±è´¥: ${response.message}`;
                    resultDiv.className = 'test-result error';
                }
            } catch (error) {
                resultDiv.innerHTML = `âŒ æµ‹è¯•çŠ¶æ€è®¡ç®—æ—¶å‘ç”Ÿé”™è¯¯: ${error.message}`;
                resultDiv.className = 'test-result error';
            }
        };

        // æµ‹è¯•ä½ç½®ä¿¡æ¯
        window.testLocationInfo = async function() {
            const resultDiv = document.getElementById('locationResult');
            try {
                resultDiv.innerHTML = 'æ­£åœ¨æµ‹è¯•ä½ç½®ä¿¡æ¯...';
                resultDiv.className = 'test-result info';
                
                if (!window.testActivityId) {
                    resultDiv.innerHTML = 'âš ï¸ è¯·å…ˆåˆ›å»ºä¸€ä¸ªæµ‹è¯•æ´»åŠ¨';
                    resultDiv.className = 'test-result error';
                    return;
                }
                
                const response = await mockGetActivityDetail(window.testActivityId);
                
                if (response.success) {
                    const activity = response.data;
                    const hasCoords = activity.coords && Array.isArray(activity.coords) && activity.coords.length === 2;
                    const hasLocation = activity.location && activity.location.name;
                    
                    const locationInfo = `
                        ğŸ“ ä½ç½®ä¿¡æ¯æ£€æŸ¥:<br>
                        â€¢ æœ‰åæ ‡æ•°æ®: ${hasCoords ? 'âœ… æ˜¯' : 'âŒ å¦'}<br>
                        â€¢ åæ ‡å€¼: ${hasCoords ? `[${activity.coords[0]}, ${activity.coords[1]}]` : 'æ— '}<br>
                        â€¢ æœ‰ä½ç½®ä¿¡æ¯: ${hasLocation ? 'âœ… æ˜¯' : 'âŒ å¦'}<br>
                        â€¢ ä½ç½®åç§°: ${activity.location?.name || 'æ— '}<br>
                        â€¢ ä½ç½®åœ°å€: ${activity.location?.address || 'æ— '}<br>
                        â€¢ åœ°å›¾æ˜¾ç¤ºæ¡ä»¶: ${hasCoords ? 'âœ… æ»¡è¶³' : 'âŒ ä¸æ»¡è¶³'}
                    `;
                    resultDiv.innerHTML = locationInfo;
                    resultDiv.className = hasCoords && hasLocation ? 'test-result success' : 'test-result error';
                } else {
                    resultDiv.innerHTML = `âŒ è·å–æ´»åŠ¨è¯¦æƒ…å¤±è´¥: ${response.message}`;
                    resultDiv.className = 'test-result error';
                }
            } catch (error) {
                resultDiv.innerHTML = `âŒ æµ‹è¯•ä½ç½®ä¿¡æ¯æ—¶å‘ç”Ÿé”™è¯¯: ${error.message}`;
                resultDiv.className = 'test-result error';
            }
        };

        // æµ‹è¯•æ´»åŠ¨åˆ—è¡¨
        window.testActivityList = async function() {
            const resultDiv = document.getElementById('listResult');
            try {
                resultDiv.innerHTML = 'æ­£åœ¨è·å–æ´»åŠ¨åˆ—è¡¨...';
                resultDiv.className = 'test-result info';
                
                const response = await mockGetActivityList();
                
                if (response.success) {
                    const activities = response.data.list;
                    const listInfo = `
                        ğŸ“‹ æ´»åŠ¨åˆ—è¡¨ä¿¡æ¯:<br>
                        â€¢ æ€»æ´»åŠ¨æ•°: ${response.data.total}<br>
                        â€¢ å½“å‰é¡µæ´»åŠ¨æ•°: ${activities.length}<br>
                        â€¢ æ´»åŠ¨çŠ¶æ€åˆ†å¸ƒ:<br>
                        ${activities.map(act => `  - ${act.title}: ${act.status}`).join('<br>')}
                        <div class="activity-data">${JSON.stringify(activities.slice(0, 3), null, 2)}</div>
                    `;
                    resultDiv.innerHTML = listInfo;
                    resultDiv.className = 'test-result success';
                } else {
                    resultDiv.innerHTML = `âŒ è·å–æ´»åŠ¨åˆ—è¡¨å¤±è´¥: ${response.message}`;
                    resultDiv.className = 'test-result error';
                }
            } catch (error) {
                resultDiv.innerHTML = `âŒ æµ‹è¯•æ´»åŠ¨åˆ—è¡¨æ—¶å‘ç”Ÿé”™è¯¯: ${error.message}`;
                resultDiv.className = 'test-result error';
            }
        };

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        console.log('æ´»åŠ¨åˆ›å»ºå’Œæ˜¾ç¤ºä¿®å¤æµ‹è¯•é¡µé¢å·²åŠ è½½');
        console.log('æµ‹è¯•æ•°æ®:', testActivityData);
    </script>
</body>
</html>