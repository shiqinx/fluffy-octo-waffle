<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ´»åŠ¨APIè”è°ƒæµ‹è¯•</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .content {
            padding: 30px;
        }
        
        .test-section {
            margin-bottom: 30px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .test-section-header {
            background: #f8f9fa;
            padding: 15px 20px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .test-section-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
        }
        
        .test-section-body {
            padding: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }
        
        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .form-group textarea {
            height: 80px;
            resize: vertical;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: #007bff;
            color: white;
        }
        
        .btn-primary:hover {
            background: #0056b3;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background: #1e7e34;
        }
        
        .btn-warning {
            background: #ffc107;
            color: #212529;
        }
        
        .btn-warning:hover {
            background: #e0a800;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c82333;
        }
        
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .result.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .result.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        .result.info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-success {
            background: #28a745;
        }
        
        .status-error {
            background: #dc3545;
        }
        
        .status-warning {
            background: #ffc107;
        }
        
        .two-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        @media (max-width: 768px) {
            .two-column {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¯ æ´»åŠ¨APIè”è°ƒæµ‹è¯•</h1>
            <p>æµ‹è¯•å‰ç«¯ä¸åç«¯Activityæ¨¡å—æ¥å£å¯¹æ¥</p>
        </div>
        
        <div class="content">
            <!-- ç¯å¢ƒæ£€æŸ¥ -->
            <div class="test-section">
                <div class="test-section-header">
                    <div class="test-section-title">
                        <span class="status-indicator" id="env-status"></span>
                        ç¯å¢ƒæ£€æŸ¥
                    </div>
                    <button class="btn btn-primary" onclick="checkEnvironment()">æ£€æŸ¥ç¯å¢ƒ</button>
                </div>
                <div class="test-section-body">
                    <div id="environment-result"></div>
                </div>
            </div>
            
            <!-- åˆ›å»ºæ´»åŠ¨æµ‹è¯• -->
            <div class="test-section">
                <div class="test-section-header">
                    <div class="test-section-title">
                        <span class="status-indicator" id="create-status"></span>
                        åˆ›å»ºæ´»åŠ¨æµ‹è¯•
                    </div>
                    <button class="btn btn-success" onclick="testCreateActivity()">åˆ›å»ºæ´»åŠ¨</button>
                </div>
                <div class="test-section-body">
                    <div class="two-column">
                        <div class="form-group">
                            <label>æ´»åŠ¨æ ‡é¢˜</label>
                            <input type="text" id="activity-title" value="APIæµ‹è¯•æ´»åŠ¨" placeholder="è¾“å…¥æ´»åŠ¨æ ‡é¢˜">
                        </div>
                        <div class="form-group">
                            <label>æ´»åŠ¨åœ°ç‚¹</label>
                            <input type="text" id="activity-location" value="æµ‹è¯•åœ°ç‚¹" placeholder="è¾“å…¥æ´»åŠ¨åœ°ç‚¹">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>æ´»åŠ¨æè¿°</label>
                        <textarea id="activity-description" placeholder="è¾“å…¥æ´»åŠ¨æè¿°">è¿™æ˜¯ä¸€ä¸ªç”¨äºAPIè”è°ƒæµ‹è¯•çš„æ´»åŠ¨</textarea>
                    </div>
                    <div class="two-column">
                        <div class="form-group">
                            <label>å¼€å§‹æ—¶é—´</label>
                            <input type="datetime-local" id="activity-start-time" value="2024-12-20T10:00">
                        </div>
                        <div class="form-group">
                            <label>ç»“æŸæ—¶é—´</label>
                            <input type="datetime-local" id="activity-end-time" value="2024-12-20T12:00">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>æœ€å¤§å‚ä¸äººæ•°</label>
                        <input type="number" id="activity-max-participants" value="50" min="1" placeholder="è¾“å…¥æœ€å¤§å‚ä¸äººæ•°">
                    </div>
                    <div id="create-result"></div>
                </div>
            </div>
            
            <!-- è·å–æ´»åŠ¨åˆ—è¡¨æµ‹è¯• -->
            <div class="test-section">
                <div class="test-section-header">
                    <div class="test-section-title">
                        <span class="status-indicator" id="list-status"></span>
                        è·å–æ´»åŠ¨åˆ—è¡¨æµ‹è¯•
                    </div>
                    <button class="btn btn-primary" onclick="testGetActivityList()">è·å–åˆ—è¡¨</button>
                </div>
                <div class="test-section-body">
                    <div class="form-group">
                        <label>æœç´¢å…³é”®è¯</label>
                        <input type="text" id="search-keyword" placeholder="è¾“å…¥æœç´¢å…³é”®è¯ï¼ˆå¯é€‰ï¼‰">
                    </div>
                    <div id="list-result"></div>
                </div>
            </div>
            
            <!-- è·å–æ´»åŠ¨è¯¦æƒ…æµ‹è¯• -->
            <div class="test-section">
                <div class="test-section-header">
                    <div class="test-section-title">
                        <span class="status-indicator" id="detail-status"></span>
                        è·å–æ´»åŠ¨è¯¦æƒ…æµ‹è¯•
                    </div>
                    <button class="btn btn-primary" onclick="testGetActivityDetail()">è·å–è¯¦æƒ…</button>
                </div>
                <div class="test-section-body">
                    <div class="form-group">
                        <label>æ´»åŠ¨ID</label>
                        <input type="number" id="detail-activity-id" value="1" min="1" placeholder="è¾“å…¥æ´»åŠ¨ID">
                    </div>
                    <div id="detail-result"></div>
                </div>
            </div>
            
            <!-- åŠ å…¥æ´»åŠ¨æµ‹è¯• -->
            <div class="test-section">
                <div class="test-section-header">
                    <div class="test-section-title">
                        <span class="status-indicator" id="join-status"></span>
                        åŠ å…¥æ´»åŠ¨æµ‹è¯•
                    </div>
                    <button class="btn btn-warning" onclick="testJoinActivity()">åŠ å…¥æ´»åŠ¨</button>
                </div>
                <div class="test-section-body">
                    <div class="form-group">
                        <label>æ´»åŠ¨ID</label>
                        <input type="number" id="join-activity-id" value="1" min="1" placeholder="è¾“å…¥æ´»åŠ¨ID">
                    </div>
                    <div class="form-group">
                        <label>ç”³è¯·æ¶ˆæ¯</label>
                        <textarea id="join-message" placeholder="è¾“å…¥ç”³è¯·æ¶ˆæ¯">æˆ‘æƒ³å‚åŠ è¿™ä¸ªæ´»åŠ¨</textarea>
                    </div>
                    <div id="join-result"></div>
                </div>
            </div>
            
            <!-- åŒæ„åŠ å…¥æµ‹è¯• -->
            <div class="test-section">
                <div class="test-section-header">
                    <div class="test-section-title">
                        <span class="status-indicator" id="agree-status"></span>
                        åŒæ„åŠ å…¥æµ‹è¯•
                    </div>
                    <button class="btn btn-success" onclick="testAgreeJoinActivity()">åŒæ„åŠ å…¥</button>
                </div>
                <div class="test-section-body">
                    <div class="two-column">
                        <div class="form-group">
                            <label>æ´»åŠ¨ID</label>
                            <input type="number" id="agree-activity-id" value="1" min="1" placeholder="è¾“å…¥æ´»åŠ¨ID">
                        </div>
                        <div class="form-group">
                            <label>ç”¨æˆ·ID</label>
                            <input type="number" id="agree-user-id" value="2" min="1" placeholder="è¾“å…¥ç”¨æˆ·ID">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>çŠ¶æ€</label>
                        <select id="agree-status-select">
                            <option value="approved">é€šè¿‡</option>
                            <option value="rejected">æ‹’ç»</option>
                        </select>
                    </div>
                    <div id="agree-result"></div>
                </div>
            </div>
            
            <!-- æ´»åŠ¨ç­¾åˆ°æµ‹è¯• -->
            <div class="test-section">
                <div class="test-section-header">
                    <div class="test-section-title">
                        <span class="status-indicator" id="checkin-status"></span>
                        æ´»åŠ¨ç­¾åˆ°æµ‹è¯•
                    </div>
                    <button class="btn btn-primary" onclick="testCheckInActivity()">æ´»åŠ¨ç­¾åˆ°</button>
                </div>
                <div class="test-section-body">
                    <div class="form-group">
                        <label>æ´»åŠ¨ID</label>
                        <input type="number" id="checkin-activity-id" value="1" min="1" placeholder="è¾“å…¥æ´»åŠ¨ID">
                    </div>
                    <div id="checkin-result"></div>
                </div>
            </div>
            
            <!-- èŠå¤©åŠŸèƒ½æµ‹è¯• -->
            <div class="test-section">
                <div class="test-section-header">
                    <div class="test-section-title">
                        <span class="status-indicator" id="chat-status"></span>
                        èŠå¤©åŠŸèƒ½æµ‹è¯•
                    </div>
                    <div>
                        <button class="btn btn-primary" onclick="testSendChatMessage()">å‘é€æ¶ˆæ¯</button>
                        <button class="btn btn-warning" onclick="testGetChatHistory()">è·å–å†å²</button>
                    </div>
                </div>
                <div class="test-section-body">
                    <div class="form-group">
                        <label>æ´»åŠ¨ID</label>
                        <input type="number" id="chat-activity-id" value="1" min="1" placeholder="è¾“å…¥æ´»åŠ¨ID">
                    </div>
                    <div class="form-group">
                        <label>æ¶ˆæ¯å†…å®¹</label>
                        <textarea id="chat-content" placeholder="è¾“å…¥æ¶ˆæ¯å†…å®¹">Hello, è¿™æ˜¯æµ‹è¯•æ¶ˆæ¯!</textarea>
                    </div>
                    <div id="chat-result"></div>
                </div>
            </div>
            
            <!-- å…¨å±€æ“ä½œ -->
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-danger" onclick="clearAllResults()">æ¸…ç©ºæ‰€æœ‰ç»“æœ</button>
            </div>
        </div>
    </div>

    <script type="module">
        // è·å–å½“å‰ç¯å¢ƒé…ç½®
        function getEnvironmentConfig() {
            // åœ¨æµè§ˆå™¨ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬æ— æ³•ç›´æ¥è®¿é—®Viteç¯å¢ƒå˜é‡
            // é€šè¿‡æ£€æŸ¥å½“å‰URLå’ŒlocalStorageæ¥æ¨æ–­é…ç½®
            const isDev = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
            const useMock = localStorage.getItem('VITE_USE_MOCK') === 'true';
            const apiBaseUrl = localStorage.getItem('VITE_API_BASE_URL') || 'http://localhost:8080/api';
            
            return {
                isDev,
                useMock,
                apiBaseUrl,
                frontendUrl: window.location.origin
            };
        }

        // æ˜¾ç¤ºç»“æœ
        function showResult(elementId, data, isSuccess = true) {
            const element = document.getElementById(elementId);
            const statusIndicator = document.getElementById(elementId.replace('-result', '-status'));
            
            let resultClass = isSuccess ? 'success' : 'error';
            let statusClass = isSuccess ? 'status-success' : 'status-error';
            
            element.innerHTML = `<div class="result ${resultClass}">${JSON.stringify(data, null, 2)}</div>`;
            statusIndicator.className = `status-indicator ${statusClass}`;
        }

        // æ˜¾ç¤ºä¿¡æ¯
        function showInfo(elementId, message) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="result info">${message}</div>`;
        }

        // æ¸…ç©ºç»“æœ
        function clearAllResults() {
            const resultElements = document.querySelectorAll('[id$="-result"]');
            resultElements.forEach(element => {
                element.innerHTML = '';
            });
            
            const statusIndicators = document.querySelectorAll('.status-indicator');
            statusIndicators.forEach(indicator => {
                indicator.className = 'status-indicator';
            });
        }

        // æ£€æŸ¥ç¯å¢ƒ
        async function checkEnvironment() {
            try {
                const config = getEnvironmentConfig();
                const envInfo = `
å½“å‰ç¯å¢ƒé…ç½®ï¼š
- å¼€å‘æ¨¡å¼: ${config.isDev}
- ä½¿ç”¨Mock: ${config.useMock}
- APIåœ°å€: ${config.apiBaseUrl}
- å‰ç«¯åœ°å€: ${config.frontendUrl}

âš ï¸  è”è°ƒè¦æ±‚ï¼š
- VITE_USE_MOCK åº”è¯¥ä¸º false
- VITE_API_BASE_URL åº”è¯¥æŒ‡å‘åç«¯æœåŠ¡
                `.trim();
                
                showInfo('environment-result', envInfo);
                document.getElementById('env-status').className = `status-indicator ${config.useMock ? 'status-warning' : 'status-success'}`;
            } catch (error) {
                showResult('environment-result', { error: error.message }, false);
            }
        }

        // æµ‹è¯•åˆ›å»ºæ´»åŠ¨
        async function testCreateActivity() {
            try {
                const activityData = {
                    title: document.getElementById('activity-title').value,
                    description: document.getElementById('activity-description').value,
                    location: document.getElementById('activity-location').value,
                    startTime: document.getElementById('activity-start-time').value,
                    endTime: document.getElementById('activity-end-time').value,
                    maxParticipants: parseInt(document.getElementById('activity-max-participants').value)
                };

                const response = await fetch('/api/activity/create', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(activityData)
                });

                const result = await response.json();
                showResult('create-result', result, response.ok);
            } catch (error) {
                showResult('create-result', { error: error.message }, false);
            }
        }

        // æµ‹è¯•è·å–æ´»åŠ¨åˆ—è¡¨
        async function testGetActivityList() {
            try {
                const keyword = document.getElementById('search-keyword').value;
                const params = new URLSearchParams();
                if (keyword) {
                    params.append('keyword', keyword);
                }

                const response = await fetch(`/api/activity/list?${params}`);
                const result = await response.json();
                showResult('list-result', result, response.ok);
            } catch (error) {
                showResult('list-result', { error: error.message }, false);
            }
        }

        // æµ‹è¯•è·å–æ´»åŠ¨è¯¦æƒ…
        async function testGetActivityDetail() {
            try {
                const activityId = document.getElementById('detail-activity-id').value;
                const response = await fetch(`/api/activity/detail/${activityId}`);
                const result = await response.json();
                showResult('detail-result', result, response.ok);
            } catch (error) {
                showResult('detail-result', { error: error.message }, false);
            }
        }

        // æµ‹è¯•åŠ å…¥æ´»åŠ¨
        async function testJoinActivity() {
            try {
                const activityId = document.getElementById('join-activity-id').value;
                const message = document.getElementById('join-message').value;

                const response = await fetch('/api/activity/join', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        activityId: parseInt(activityId),
                        message: message
                    })
                });

                const result = await response.json();
                showResult('join-result', result, response.ok);
            } catch (error) {
                showResult('join-result', { error: error.message }, false);
            }
        }

        // æµ‹è¯•åŒæ„åŠ å…¥
        async function testAgreeJoinActivity() {
            try {
                const activityId = document.getElementById('agree-activity-id').value;
                const userId = document.getElementById('agree-user-id').value;
                const status = document.getElementById('agree-status-select').value;

                const response = await fetch('/api/activity/agree-join', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        activityId: parseInt(activityId),
                        userId: parseInt(userId),
                        status: status,
                        message: status === 'approved' ? 'ç”³è¯·å·²é€šè¿‡' : 'ç”³è¯·å·²æ‹’ç»'
                    })
                });

                const result = await response.json();
                showResult('agree-result', result, response.ok);
            } catch (error) {
                showResult('agree-result', { error: error.message }, false);
            }
        }

        // æµ‹è¯•æ´»åŠ¨ç­¾åˆ°
        async function testCheckInActivity() {
            try {
                const activityId = document.getElementById('checkin-activity-id').value;

                const response = await fetch('/api/activity/check-in', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        activityId: parseInt(activityId)
                    })
                });

                const result = await response.json();
                showResult('checkin-result', result, response.ok);
            } catch (error) {
                showResult('checkin-result', { error: error.message }, false);
            }
        }

        // æµ‹è¯•å‘é€èŠå¤©æ¶ˆæ¯
        async function testSendChatMessage() {
            try {
                const activityId = document.getElementById('chat-activity-id').value;
                const content = document.getElementById('chat-content').value;

                // ä½¿ç”¨FormDataå‘é€ï¼Œå› ä¸ºåç«¯æ··åˆä½¿ç”¨@RequestParamå’Œ@RequestBody
                const formData = new FormData();
                formData.append('activityId', activityId);
                formData.append('content', content);

                const response = await fetch('/api/activity/chat/send', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.text();
                showResult('chat-result', { result }, response.ok);
            } catch (error) {
                showResult('chat-result', { error: error.message }, false);
            }
        }

        // æµ‹è¯•è·å–èŠå¤©å†å²
        async function testGetChatHistory() {
            try {
                const activityId = document.getElementById('chat-activity-id').value;
                const response = await fetch(`/api/activity/chat/history/${activityId}`);
                const result = await response.json();
                showResult('chat-result', result, response.ok);
            } catch (error) {
                showResult('chat-result', { error: error.message }, false);
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥ç¯å¢ƒ
        document.addEventListener('DOMContentLoaded', function() {
            checkEnvironment();
        });
    </script>
</body>
</html>