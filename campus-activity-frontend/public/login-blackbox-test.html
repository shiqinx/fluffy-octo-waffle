<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç™»å½•é¡µé¢é»‘ç›’æµ‹è¯•</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .content {
            padding: 30px;
        }

        .test-section {
            margin-bottom: 40px;
            padding: 25px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            background: #f9fafb;
        }

        .test-section h2 {
            color: #1f2937;
            margin-bottom: 20px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .test-section h2::before {
            content: '';
            width: 4px;
            height: 24px;
            background: #4f46e5;
            border-radius: 2px;
        }

        .test-case {
            margin-bottom: 25px;
            padding: 20px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background: white;
        }

        .test-case h3 {
            color: #374151;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #374151;
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e5e7eb;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.2s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: #4f46e5;
            color: white;
        }

        .btn-primary:hover {
            background: #4338ca;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }

        .result.success {
            background: #d1fae5;
            border: 1px solid #10b981;
            color: #065f46;
        }

        .result.error {
            background: #fee2e2;
            border: 1px solid #ef4444;
            color: #991b1b;
        }

        .result.info {
            background: #dbeafe;
            border: 1px solid #3b82f6;
            color: #1e40af;
        }

        .test-status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            margin-left: 10px;
        }

        .test-status.pass {
            background: #d1fae5;
            color: #065f46;
        }

        .test-status.fail {
            background: #fee2e2;
            color: #991b1b;
        }

        .test-status.pending {
            background: #fef3c7;
            color: #92400e;
        }

        .iframe-container {
            margin-top: 15px;
            border: 2px solid #e5e7eb;
            border-radius: 6px;
            overflow: hidden;
        }

        .iframe-container iframe {
            width: 100%;
            height: 600px;
            border: none;
        }

        .expected-result {
            background: #f0f9ff;
            border: 1px solid #0ea5e9;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 10px;
            font-size: 13px;
        }

        .expected-result strong {
            color: #0c4a6e;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ§ª ç™»å½•é¡µé¢é»‘ç›’æµ‹è¯•</h1>
            <p>æ¨¡æ‹Ÿç”¨æˆ·æ“ä½œï¼ŒéªŒè¯ç™»å½•åŠŸèƒ½çš„æ­£ç¡®æ€§</p>
        </div>

        <div class="content">
            <!-- æµ‹è¯•ç”¨ä¾‹1: ä¸å­˜åœ¨çš„ç”¨æˆ·å -->
            <div class="test-section">
                <h2>æµ‹è¯•ç”¨ä¾‹ 1: LOGIN-003 ä¸å­˜åœ¨çš„ç”¨æˆ·å</h2>
                <div class="test-case">
                    <h3>æµ‹è¯•æè¿° <span class="test-status pending" id="status1">å¾…æµ‹è¯•</span></h3>
                    <div class="expected-result">
                        <strong>é¢„æœŸç»“æœ:</strong> ç™»å½•å¤±è´¥ï¼Œæç¤º"ç”¨æˆ·ä¸å­˜åœ¨"
                    </div>
                    
                    <div class="form-group">
                        <label>å­¦å·:</label>
                        <input type="text" id="username1" placeholder="è¾“å…¥ä¸å­˜åœ¨çš„å­¦å·" value="999999999">
                    </div>
                    <div class="form-group">
                        <label>å¯†ç :</label>
                        <input type="password" id="password1" placeholder="è¾“å…¥ä»»æ„å¯†ç " value="test123456">
                    </div>
                    
                    <div class="button-group">
                        <button class="btn btn-primary" onclick="testLogin1()">
                            ğŸ” æ‰§è¡Œæµ‹è¯•
                        </button>
                        <button class="btn btn-secondary" onclick="openLoginPage1()">
                            ğŸŒ æ‰“å¼€ç™»å½•é¡µé¢
                        </button>
                        <button class="btn btn-danger" onclick="clearResult1()">
                            ğŸ—‘ï¸ æ¸…é™¤ç»“æœ
                        </button>
                    </div>
                    
                    <div class="iframe-container" id="iframe1" style="display: none;">
                        <iframe src="http://localhost:5173/login" id="loginFrame1"></iframe>
                    </div>
                    
                    <div class="result" id="result1" style="display: none;"></div>
                </div>
            </div>

            <!-- æµ‹è¯•ç”¨ä¾‹2: æ­£ç¡®çš„ç”¨æˆ·åé”™è¯¯çš„å¯†ç  -->
            <div class="test-section">
                <h2>æµ‹è¯•ç”¨ä¾‹ 2: LOGIN-002 æ­£ç¡®ç”¨æˆ·åé”™è¯¯å¯†ç </h2>
                <div class="test-case">
                    <h3>æµ‹è¯•æè¿° <span class="test-status pending" id="status2">å¾…æµ‹è¯•</span></h3>
                    <div class="expected-result">
                        <strong>é¢„æœŸç»“æœ:</strong> ç™»å½•å¤±è´¥ï¼Œæç¤º"å¯†ç é”™è¯¯"
                    </div>
                    
                    <div class="form-group">
                        <label>å­¦å·:</label>
                        <input type="text" id="username2" placeholder="è¾“å…¥å­˜åœ¨çš„å­¦å·" value="2021001">
                    </div>
                    <div class="form-group">
                        <label>å¯†ç :</label>
                        <input type="password" id="password2" placeholder="è¾“å…¥é”™è¯¯å¯†ç " value="wrongpassword">
                    </div>
                    
                    <div class="button-group">
                        <button class="btn btn-primary" onclick="testLogin2()">
                            ğŸ” æ‰§è¡Œæµ‹è¯•
                        </button>
                        <button class="btn btn-secondary" onclick="openLoginPage2()">
                            ğŸŒ æ‰“å¼€ç™»å½•é¡µé¢
                        </button>
                        <button class="btn btn-danger" onclick="clearResult2()">
                            ğŸ—‘ï¸ æ¸…é™¤ç»“æœ
                        </button>
                    </div>
                    
                    <div class="iframe-container" id="iframe2" style="display: none;">
                        <iframe src="http://localhost:5173/login" id="loginFrame2"></iframe>
                    </div>
                    
                    <div class="result" id="result2" style="display: none;"></div>
                </div>
            </div>

            <!-- æµ‹è¯•ç”¨ä¾‹3: ç©ºç”¨æˆ·åå’Œå¯†ç  -->
            <div class="test-section">
                <h2>æµ‹è¯•ç”¨ä¾‹ 3: LOGIN-001 ç©ºç”¨æˆ·åå’Œå¯†ç </h2>
                <div class="test-case">
                    <h3>æµ‹è¯•æè¿° <span class="test-status pending" id="status3">å¾…æµ‹è¯•</span></h3>
                    <div class="expected-result">
                        <strong>é¢„æœŸç»“æœ:</strong> ç™»å½•å¤±è´¥ï¼Œæç¤º"è¯·è¾“å…¥å­¦å·å’Œå¯†ç "
                    </div>
                    
                    <div class="form-group">
                        <label>å­¦å·:</label>
                        <input type="text" id="username3" placeholder="ç•™ç©ºæµ‹è¯•" value="">
                    </div>
                    <div class="form-group">
                        <label>å¯†ç :</label>
                        <input type="password" id="password3" placeholder="ç•™ç©ºæµ‹è¯•" value="">
                    </div>
                    
                    <div class="button-group">
                        <button class="btn btn-primary" onclick="testLogin3()">
                            ğŸ” æ‰§è¡Œæµ‹è¯•
                        </button>
                        <button class="btn btn-secondary" onclick="openLoginPage3()">
                            ğŸŒ æ‰“å¼€ç™»å½•é¡µé¢
                        </button>
                        <button class="btn btn-danger" onclick="clearResult3()">
                            ğŸ—‘ï¸ æ¸…é™¤ç»“æœ
                        </button>
                    </div>
                    
                    <div class="iframe-container" id="iframe3" style="display: none;">
                        <iframe src="http://localhost:5173/login" id="loginFrame3"></iframe>
                    </div>
                    
                    <div class="result" id="result3" style="display: none;"></div>
                </div>
            </div>

            <!-- æµ‹è¯•ç”¨ä¾‹4: æ­£ç¡®ç™»å½• -->
            <div class="test-section">
                <h2>æµ‹è¯•ç”¨ä¾‹ 4: LOGIN-004 æ­£ç¡®ç™»å½•</h2>
                <div class="test-case">
                    <h3>æµ‹è¯•æè¿° <span class="test-status pending" id="status4">å¾…æµ‹è¯•</span></h3>
                    <div class="expected-result">
                        <strong>é¢„æœŸç»“æœ:</strong> ç™»å½•æˆåŠŸï¼Œè·³è½¬åˆ°é¦–é¡µ
                    </div>
                    
                    <div class="form-group">
                        <label>å­¦å·:</label>
                        <input type="text" id="username4" placeholder="è¾“å…¥æ­£ç¡®å­¦å·" value="2021001">
                    </div>
                    <div class="form-group">
                        <label>å¯†ç :</label>
                        <input type="password" id="password4" placeholder="è¾“å…¥æ­£ç¡®å¯†ç " value="password123">
                    </div>
                    
                    <div class="button-group">
                        <button class="btn btn-primary" onclick="testLogin4()">
                            ğŸ” æ‰§è¡Œæµ‹è¯•
                        </button>
                        <button class="btn btn-secondary" onclick="openLoginPage4()">
                            ğŸŒ æ‰“å¼€ç™»å½•é¡µé¢
                        </button>
                        <button class="btn btn-danger" onclick="clearResult4()">
                            ğŸ—‘ï¸ æ¸…é™¤ç»“æœ
                        </button>
                    </div>
                    
                    <div class="iframe-container" id="iframe4" style="display: none;">
                        <iframe src="http://localhost:5173/login" id="loginFrame4"></iframe>
                    </div>
                    
                    <div class="result" id="result4" style="display: none;"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // APIåŸºç¡€URL
        const API_BASE = 'http://localhost:3000/api';
        
        // æ˜¾ç¤ºç»“æœ
        function showResult(resultId, message, type = 'info') {
            const resultDiv = document.getElementById(resultId);
            resultDiv.style.display = 'block';
            resultDiv.className = `result ${type}`;
            resultDiv.textContent = message;
        }
        
        // æ›´æ–°æµ‹è¯•çŠ¶æ€
        function updateStatus(statusId, status) {
            const statusDiv = document.getElementById(statusId);
            statusDiv.className = `test-status ${status}`;
            statusDiv.textContent = status === 'pass' ? 'é€šè¿‡' : status === 'fail' ? 'å¤±è´¥' : 'å¾…æµ‹è¯•';
        }
        
        // æ‰“å¼€ç™»å½•é¡µé¢
        function openLoginPage(frameId) {
            const iframeContainer = document.getElementById(frameId);
            iframeContainer.style.display = 'block';
        }
        
        function openLoginPage1() { openLoginPage('iframe1'); }
        function openLoginPage2() { openLoginPage('iframe2'); }
        function openLoginPage3() { openLoginPage('iframe3'); }
        function openLoginPage4() { openLoginPage('iframe4'); }
        
        // æ¸…é™¤ç»“æœ
        function clearResult(resultId, statusId) {
            document.getElementById(resultId).style.display = 'none';
            updateStatus(statusId, 'pending');
        }
        
        function clearResult1() { clearResult('result1', 'status1'); }
        function clearResult2() { clearResult('result2', 'status2'); }
        function clearResult3() { clearResult('result3', 'status3'); }
        function clearResult4() { clearResult('result4', 'status4'); }
        
        // æµ‹è¯•ç™»å½•APIè°ƒç”¨
        async function testLoginAPI(studentId, password, resultId, statusId, expectedResult) {
            try {
                showResult(resultId, 'ğŸ”„ æ­£åœ¨æµ‹è¯•ç™»å½•API...', 'info');
                
                const response = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ studentId, password })
                });
                
                const data = await response.json();
                
                let resultMessage = `ğŸ“Š APIæµ‹è¯•ç»“æœ:\n`;
                resultMessage += `çŠ¶æ€ç : ${response.status}\n`;
                resultMessage += `å“åº”æ•°æ®: ${JSON.stringify(data, null, 2)}\n\n`;
                
                // åˆ¤æ–­æµ‹è¯•ç»“æœ
                let testPassed = false;
                let testAnalysis = '';
                
                if (response.status === 200 && data.success) {
                    if (expectedResult === 'success') {
                        testPassed = true;
                        testAnalysis = 'âœ… æµ‹è¯•é€šè¿‡: ç™»å½•æˆåŠŸï¼Œç¬¦åˆé¢„æœŸ';
                    } else {
                        testAnalysis = 'âŒ æµ‹è¯•å¤±è´¥: é¢„æœŸç™»å½•å¤±è´¥ï¼Œä½†å®é™…ç™»å½•æˆåŠŸ';
                    }
                } else {
                    if (expectedResult === 'fail_user_not_exist' && data.message && data.message.includes('ç”¨æˆ·ä¸å­˜åœ¨')) {
                        testPassed = true;
                        testAnalysis = 'âœ… æµ‹è¯•é€šè¿‡: æ­£ç¡®æç¤ºç”¨æˆ·ä¸å­˜åœ¨';
                    } else if (expectedResult === 'fail_wrong_password' && data.message && data.message.includes('å¯†ç é”™è¯¯')) {
                        testPassed = true;
                        testAnalysis = 'âœ… æµ‹è¯•é€šè¿‡: æ­£ç¡®æç¤ºå¯†ç é”™è¯¯';
                    } else if (expectedResult === 'fail_empty_fields' && data.message && data.message.includes('è¯·è¾“å…¥')) {
                        testPassed = true;
                        testAnalysis = 'âœ… æµ‹è¯•é€šè¿‡: æ­£ç¡®æç¤ºè¾“å…¥å­—æ®µ';
                    } else {
                        testAnalysis = `âŒ æµ‹è¯•å¤±è´¥: é”™è¯¯ä¿¡æ¯ä¸ç¬¦åˆé¢„æœŸ\nå®é™…é”™è¯¯: ${data.message || 'æœªçŸ¥é”™è¯¯'}`;
                    }
                }
                
                resultMessage += testAnalysis;
                
                showResult(resultId, resultMessage, testPassed ? 'success' : 'error');
                updateStatus(statusId, testPassed ? 'pass' : 'fail');
                
                return testPassed;
                
            } catch (error) {
                const errorMessage = `âŒ APIè°ƒç”¨å¤±è´¥:\n${error.message}\n\nè¯·ç¡®ä¿:\n1. åç«¯æœåŠ¡å™¨æ­£åœ¨è¿è¡Œ (localhost:3000)\n2. CORSé…ç½®æ­£ç¡®\n3. ç½‘ç»œè¿æ¥æ­£å¸¸`;
                showResult(resultId, errorMessage, 'error');
                updateStatus(statusId, 'fail');
                return false;
            }
        }
        
        // æµ‹è¯•ç”¨ä¾‹1: ä¸å­˜åœ¨çš„ç”¨æˆ·å
        async function testLogin1() {
            const username = document.getElementById('username1').value;
            const password = document.getElementById('password1').value;
            
            if (!username || !password) {
                showResult('result1', 'âŒ è¯·è¾“å…¥æµ‹è¯•ç”¨çš„å­¦å·å’Œå¯†ç ', 'error');
                return;
            }
            
            await testLoginAPI(username, password, 'result1', 'status1', 'fail_user_not_exist');
        }
        
        // æµ‹è¯•ç”¨ä¾‹2: æ­£ç¡®ç”¨æˆ·åé”™è¯¯å¯†ç 
        async function testLogin2() {
            const username = document.getElementById('username2').value;
            const password = document.getElementById('password2').value;
            
            if (!username || !password) {
                showResult('result2', 'âŒ è¯·è¾“å…¥æµ‹è¯•ç”¨çš„å­¦å·å’Œå¯†ç ', 'error');
                return;
            }
            
            await testLoginAPI(username, password, 'result2', 'status2', 'fail_wrong_password');
        }
        
        // æµ‹è¯•ç”¨ä¾‹3: ç©ºç”¨æˆ·åå’Œå¯†ç 
        async function testLogin3() {
            const username = document.getElementById('username3').value;
            const password = document.getElementById('password3').value;
            
            await testLoginAPI(username, password, 'result3', 'status3', 'fail_empty_fields');
        }
        
        // æµ‹è¯•ç”¨ä¾‹4: æ­£ç¡®ç™»å½•
        async function testLogin4() {
            const username = document.getElementById('username4').value;
            const password = document.getElementById('password4').value;
            
            if (!username || !password) {
                showResult('result4', 'âŒ è¯·è¾“å…¥æµ‹è¯•ç”¨çš„å­¦å·å’Œå¯†ç ', 'error');
                return;
            }
            
            await testLoginAPI(username, password, 'result4', 'status4', 'success');
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ§ª ç™»å½•é¡µé¢é»‘ç›’æµ‹è¯•å·¥å…·å·²åŠ è½½');
            console.log('ğŸ“ ä½¿ç”¨è¯´æ˜:');
            console.log('1. ç¡®ä¿åç«¯æœåŠ¡å™¨è¿è¡Œåœ¨ localhost:3000');
            console.log('2. ç¡®ä¿å‰ç«¯å¼€å‘æœåŠ¡å™¨è¿è¡Œåœ¨ localhost:5173');
            console.log('3. å¡«å†™æµ‹è¯•æ•°æ®åç‚¹å‡»"æ‰§è¡Œæµ‹è¯•"æŒ‰é’®');
            console.log('4. å¯ä»¥ç‚¹å‡»"æ‰“å¼€ç™»å½•é¡µé¢"è¿›è¡Œæ‰‹åŠ¨æµ‹è¯•');
        });
    </script>
</body>
</html>