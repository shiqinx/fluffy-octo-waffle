<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®šä½é”™è¯¯ä¿®å¤æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .warning { background-color: #fff3cd; color: #856404; }
        .info { background-color: #d1ecf1; color: #0c5460; }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background-color: #0056b3; }
        button:disabled { background-color: #6c757d; cursor: not-allowed; }
        .location-info {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .error-details {
            background-color: #f8d7da;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§­ å®šä½é”™è¯¯ä¿®å¤æµ‹è¯•</h1>
        <p>è¿™ä¸ªé¡µé¢ç”¨äºæµ‹è¯•å®šä½æœåŠ¡é”™è¯¯å¤„ç†çš„ä¿®å¤æ•ˆæœã€‚</p>
        
        <div class="status info">
            <strong>æµ‹è¯•ç›®æ ‡ï¼š</strong>éªŒè¯å®šä½å¤±è´¥æ—¶æ˜¯å¦æ˜¾ç¤ºå…·ä½“çš„é”™è¯¯ä¿¡æ¯ï¼Œè€Œä¸æ˜¯"UNKNOWN_ERROR"
        </div>
        
        <button onclick="testLocation()" id="testBtn">ğŸ“ æµ‹è¯•å®šä½åŠŸèƒ½</button>
        <button onclick="testPermissionError()" id="permissionBtn">ğŸš« æ¨¡æ‹Ÿæƒé™é”™è¯¯</button>
        <button onclick="testTimeoutError()" id="timeoutBtn">â±ï¸ æ¨¡æ‹Ÿè¶…æ—¶é”™è¯¯</button>
        <button onclick="clearResults()" id="clearBtn">ğŸ—‘ï¸ æ¸…é™¤ç»“æœ</button>
    </div>

    <div class="container">
        <h2>ğŸ“Š æµ‹è¯•ç»“æœ</h2>
        <div id="results"></div>
    </div>

    <div class="container">
        <h2>ğŸ” é”™è¯¯ä¿¡æ¯åˆ†æ</h2>
        <div id="errorAnalysis"></div>
    </div>

    <script type="module">
        // æ¨¡æ‹ŸVueç¯å¢ƒä¸­çš„é”™è¯¯å¤„ç†
        const results = document.getElementById('results');
        const errorAnalysis = document.getElementById('errorAnalysis');
        
        function addResult(type, title, content) {
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = `<strong>${title}</strong><br>${content}`;
            results.appendChild(div);
            results.scrollTop = results.scrollHeight;
        }

        function addErrorAnalysis(error) {
            const div = document.createElement('div');
            div.className = 'error-details';
            
            let analysis = `ğŸ” é”™è¯¯åˆ†æï¼š
ç±»å‹: ${error?.code || 'æœªçŸ¥'}
æ¶ˆæ¯: ${error?.message || 'æ— æ¶ˆæ¯'}
ç”¨æˆ·å‹å¥½: ${error?.isUserFriendly ? 'æ˜¯' : 'å¦'}
å»ºè®®: ${error?.suggestion || 'æ— å»ºè®®'}
åŸå§‹é”™è¯¯: ${error?.originalError ? JSON.stringify(error.originalError) : 'æ— åŸå§‹é”™è¯¯'}

ğŸ“‹ å®Œæ•´é”™è¯¯å¯¹è±¡ï¼š
${JSON.stringify(error, null, 2)}`;
            
            div.textContent = analysis;
            errorAnalysis.appendChild(div);
            errorAnalysis.scrollTop = errorAnalysis.scrollHeight;
        }

        // æ¨¡æ‹Ÿå®šä½å‡½æ•°ï¼ˆç®€åŒ–ç‰ˆæœ¬ï¼‰
        async function getCurrentLocation(options = {}) {
            return new Promise((resolve, reject) => {
                if (!navigator.geolocation) {
                    reject({
                        code: 'GEOLOCATION_NOT_SUPPORTED',
                        message: 'æµè§ˆå™¨ä¸æ”¯æŒåœ°ç†ä½ç½®åŠŸèƒ½',
                        isUserFriendly: true,
                        suggestion: 'è¯·æ›´æ–°æµè§ˆå™¨æˆ–ä½¿ç”¨æ”¯æŒå®šä½çš„æµè§ˆå™¨'
                    });
                    return;
                }

                const defaultOptions = {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 30000
                };

                const finalOptions = { ...defaultOptions, ...options };

                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        resolve({
                            latitude: position.coords.latitude,
                            longitude: position.coords.longitude,
                            accuracy: position.coords.accuracy,
                            timestamp: position.timestamp
                        });
                    },
                    (error) => {
                        let userFriendlyError;
                        switch (error.code) {
                            case error.PERMISSION_DENIED:
                                userFriendlyError = {
                                    code: 'PERMISSION_DENIED',
                                    message: 'ä½ç½®æƒé™è¢«æ‹’ç»ï¼Œè¯·åœ¨è®¾å¤‡è®¾ç½®ä¸­å…è®¸åº”ç”¨è®¿é—®æ‚¨çš„ä½ç½®',
                                    isUserFriendly: true,
                                    suggestion: 'è¯·åœ¨æµè§ˆå™¨è®¾ç½®ä¸­å…è®¸ä½ç½®è®¿é—®',
                                    originalError: error
                                };
                                break;
                            case error.POSITION_UNAVAILABLE:
                                userFriendlyError = {
                                    code: 'POSITION_UNAVAILABLE',
                                    message: 'æ— æ³•è·å–æ‚¨çš„ä½ç½®ï¼Œè¯·å°è¯•å¼€å¯GPSæˆ–ç§»åŠ¨åˆ°ä¿¡å·æ›´å¥½çš„åŒºåŸŸ',
                                    isUserFriendly: true,
                                    suggestion: 'è¯·æ£€æŸ¥è®¾å¤‡å®šä½æœåŠ¡æ˜¯å¦å¼€å¯',
                                    originalError: error
                                };
                                break;
                            case error.TIMEOUT:
                                userFriendlyError = {
                                    code: 'TIMEOUT',
                                    message: 'è·å–ä½ç½®è¶…æ—¶ï¼Œè¯·ç¨åå†è¯•',
                                    isUserFriendly: true,
                                    suggestion: 'è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œå®šä½æƒé™',
                                    originalError: error
                                };
                                break;
                            default:
                                userFriendlyError = {
                                    code: 'UNKNOWN_ERROR',
                                    message: 'è·å–ä½ç½®æ—¶å‘ç”ŸæœªçŸ¥é”™è¯¯ï¼Œè¯·ç¨åå†è¯•',
                                    isUserFriendly: true,
                                    suggestion: 'è¯·ç¨åé‡è¯•',
                                    originalError: error
                                };
                        }
                        reject(userFriendlyError);
                    },
                    finalOptions
                );
            });
        }

        // æ¨¡æ‹Ÿstoresä¸­çš„é”™è¯¯å¤„ç†é€»è¾‘
        async function testLocationWithErrorHandling(options = {}) {
            try {
                const position = await getCurrentLocation(options);
                
                addResult('success', 'âœ… å®šä½æˆåŠŸ', 
                    `çº¬åº¦: ${position.latitude}<br>
                     ç»åº¦: ${position.longitude}<br>
                     ç²¾åº¦: ${position.accuracy}ç±³<br>
                     æ—¶é—´æˆ³: ${new Date(position.timestamp).toLocaleString()}`);
                
                return { success: true, position };
            } catch (error) {
                // æ¨¡æ‹Ÿä¿®å¤åçš„é”™è¯¯å¤„ç†é€»è¾‘
                let locationError;
                if (error && error.code && error.isUserFriendly) {
                    // å¦‚æœæ˜¯ç”¨æˆ·å‹å¥½çš„é”™è¯¯å¯¹è±¡ï¼Œç›´æ¥ä½¿ç”¨
                    locationError = error;
                } else {
                    // å¦åˆ™åˆ›å»ºæ ‡å‡†åŒ–çš„é”™è¯¯å¯¹è±¡
                    locationError = {
                        code: 'POSITION_ERROR',
                        message: error?.message || String(error),
                        isUserFriendly: true,
                        suggestion: 'è¯·ç¨åé‡è¯•'
                    };
                }
                
                addResult('error', 'âŒ å®šä½å¤±è´¥', 
                    `é”™è¯¯ä»£ç : ${locationError.code}<br>
                     é”™è¯¯æ¶ˆæ¯: ${locationError.message}<br>
                     ç”¨æˆ·å‹å¥½: ${locationError.isUserFriendly ? 'æ˜¯' : 'å¦'}<br>
                     å»ºè®®: ${locationError.suggestion}`);
                
                addErrorAnalysis(locationError);
                
                return { success: false, error: locationError };
            }
        }

        // æµ‹è¯•å‡½æ•°
        window.testLocation = async function() {
            addResult('info', 'ğŸ”„ å¼€å§‹æµ‹è¯•', 'æ­£åœ¨æµ‹è¯•æ­£å¸¸çš„å®šä½åŠŸèƒ½...');
            await testLocationWithErrorHandling();
        };

        window.testPermissionError = async function() {
            addResult('info', 'ğŸ”„ å¼€å§‹æµ‹è¯•', 'æ­£åœ¨æ¨¡æ‹Ÿæƒé™é”™è¯¯ï¼ˆè¶…çŸ­è¶…æ—¶æ—¶é—´ï¼‰...');
            await testLocationWithErrorHandling({ timeout: 1 }); // 1msè¶…æ—¶ï¼Œå¾ˆå¯èƒ½è§¦å‘æƒé™æˆ–è¶…æ—¶é”™è¯¯
        };

        window.testTimeoutError = async function() {
            addResult('info', 'ğŸ”„ å¼€å§‹æµ‹è¯•', 'æ­£åœ¨æ¨¡æ‹Ÿè¶…æ—¶é”™è¯¯ï¼ˆ1msè¶…æ—¶ï¼‰...');
            await testLocationWithErrorHandling({ timeout: 1 });
        };

        window.clearResults = function() {
            results.innerHTML = '';
            errorAnalysis.innerHTML = '';
            addResult('info', 'ğŸ§¹ å·²æ¸…é™¤', 'æ‰€æœ‰æµ‹è¯•ç»“æœå·²æ¸…é™¤');
        };

        // åˆå§‹åŒ–
        addResult('info', 'ğŸš€ å‡†å¤‡å°±ç»ª', 'å®šä½é”™è¯¯ä¿®å¤æµ‹è¯•é¡µé¢å·²åŠ è½½ï¼Œè¯·ç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•');
    </script>
</body>
</html>