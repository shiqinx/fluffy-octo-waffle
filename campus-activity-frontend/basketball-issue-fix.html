<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¯®çƒèµ›é—®é¢˜ä¿®å¤å·¥å…·</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .header {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }
        .problem {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .solution {
            background: #d1f2eb;
            border: 1px solid #55efc4;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .data-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .stat-card {
            background: #f8f9fa;
            border-radius: 6px;
            padding: 15px;
            text-align: center;
        }
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #007bff;
        }
        .stat-label {
            color: #666;
            margin-top: 5px;
        }
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        .btn:hover {
            background: #0056b3;
        }
        .btn.danger {
            background: #dc3545;
        }
        .btn.danger:hover {
            background: #c82333;
        }
        .btn.success {
            background: #28a745;
        }
        .btn.success:hover {
            background: #218838;
        }
        .activity-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 10px;
        }
        .activity-item {
            background: #f8f9fa;
            border-radius: 4px;
            padding: 10px;
            margin-bottom: 10px;
            border-left: 4px solid #007bff;
        }
        .activity-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .activity-info {
            font-size: 0.9em;
            color: #666;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ€ ç¯®çƒèµ›é—®é¢˜ä¿®å¤å·¥å…·</h1>
            <p>æ£€æµ‹å’Œä¿®å¤æ´»åŠ¨åˆ—è¡¨ä¸­æ‰€æœ‰æ´»åŠ¨éƒ½æ˜¾ç¤ºä¸ºç¯®çƒå‹è°Šèµ›çš„é—®é¢˜</p>
        </div>

        <div class="problem">
            <h3>âš ï¸ é—®é¢˜è¯Šæ–­</h3>
            <p><strong>ç°è±¡ï¼š</strong>æ´»åŠ¨åˆ—è¡¨ä¸­æ‰€æœ‰æ´»åŠ¨éƒ½æ˜¾ç¤ºä¸º"ç¯®çƒå‹è°Šèµ›"</p>
            <p><strong>åŸå› ï¼š</strong>localStorageä¸­çš„æ´»åŠ¨æ•°æ®å¯èƒ½è¢«é”™è¯¯è¦†ç›–ï¼Œå¯¼è‡´æ•°æ®å•ä¸€åŒ–</p>
            <p><strong>å½±å“ï¼š</strong>ç”¨æˆ·æ— æ³•çœ‹åˆ°å¤šæ ·åŒ–çš„æ´»åŠ¨å†…å®¹ï¼Œå½±å“ç”¨æˆ·ä½“éªŒ</p>
        </div>

        <div class="solution">
            <h3>âœ… è§£å†³æ–¹æ¡ˆ</h3>
            <p>1. æ£€æŸ¥å½“å‰localStorageä¸­çš„æ´»åŠ¨æ•°æ®</p>
            <p>2. è¯†åˆ«æ•°æ®å¼‚å¸¸ï¼ˆå¦‚æ‰€æœ‰æ´»åŠ¨éƒ½æ˜¯ç¯®çƒèµ›ï¼‰</p>
            <p>3. ä½¿ç”¨æ­£ç¡®çš„å¤šæ ·åŒ–æ´»åŠ¨æ•°æ®æ›¿æ¢å¼‚å¸¸æ•°æ®</p>
            <p>4. éªŒè¯ä¿®å¤ç»“æœ</p>
        </div>

        <div class="data-stats">
            <div class="stat-card">
                <div class="stat-number" id="totalActivities">0</div>
                <div class="stat-label">æ€»æ´»åŠ¨æ•°</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="basketballCount">0</div>
                <div class="stat-label">ç¯®çƒæ´»åŠ¨æ•°</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="basketballPercentage">0%</div>
                <div class="stat-label">ç¯®çƒæ´»åŠ¨å æ¯”</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="dataStatus">âŒ</div>
                <div class="stat-label">æ•°æ®çŠ¶æ€</div>
            </div>
        </div>

        <div class="container">
            <h3>ğŸ”§ æ“ä½œå·¥å…·</h3>
            <button class="btn" onclick="checkData()">æ£€æŸ¥æ•°æ®</button>
            <button class="btn success" onclick="fixData()">ä¿®å¤æ•°æ®</button>
            <button class="btn danger" onclick="clearData()">æ¸…ç©ºæ•°æ®</button>
            <button class="btn" onclick="exportData()">å¯¼å‡ºæ•°æ®</button>
            <button class="btn" onclick="refreshPage()">åˆ·æ–°é¡µé¢</button>
        </div>

        <div class="container">
            <h3>ğŸ“‹ å½“å‰æ´»åŠ¨åˆ—è¡¨</h3>
            <div class="activity-list" id="activityList">
                <p>ç‚¹å‡»"æ£€æŸ¥æ•°æ®"æŒ‰é’®æŸ¥çœ‹å½“å‰æ´»åŠ¨åˆ—è¡¨</p>
            </div>
        </div>

        <div class="container">
            <h3>ğŸ“ æ“ä½œæ—¥å¿—</h3>
            <div class="log" id="log">ç­‰å¾…æ“ä½œ...</div>
        </div>
    </div>

    <script>
        // æ­£ç¡®çš„å¤šæ ·åŒ–æ´»åŠ¨æ•°æ®
        const correctActivities = [
            {
                id: 1,
                title: 'ä¸­åŒ»å…»ç”Ÿè®²åº§',
                type: 'å­¦æœ¯è®²åº§',
                category: 'study',
                description: 'é‚€è¯·è‘—åä¸­åŒ»ä¸“å®¶è®²è§£ä¼ ç»Ÿå…»ç”ŸçŸ¥è¯†ï¼ŒåŒ…æ‹¬å››å­£å…»ç”Ÿã€é£Ÿç–—å…»ç”Ÿã€è¿åŠ¨å…»ç”Ÿç­‰å†…å®¹ã€‚ç°åœºè¿˜æœ‰å…è´¹ä¸­åŒ»ä½“è´¨æ£€æµ‹æœåŠ¡ã€‚',
                locationName: 'å­¦æœ¯æŠ¥å‘Šå…',
                location: {
                    name: 'å­¦æœ¯æŠ¥å‘Šå…',
                    address: 'å¹¿ä¸œè¯ç§‘å¤§å­¦äº‘æµ®æ ¡åŒºå­¦æœ¯æŠ¥å‘Šå…'
                },
                startTime: '2024-12-20T14:00:00',
                endTime: '2024-12-20T16:30:00',
                registrationDeadline: '2024-12-19T23:59:59',
                currentParticipants: 156,
                maxParticipants: 200,
                organizer: {
                    id: 1,
                    name: 'ä¸­åŒ»å­¦é™¢',
                    avatar: '',
                    role: 'ç»„ç»‡è€…',
                    creditScore: 98
                },
                status: 'open',
                isEnrolled: false,
                distance: 0.3,
                tags: ['å¥åº·', 'å…»ç”Ÿ', 'ä¸­åŒ»', 'è®²åº§']
            },
            {
                id: 2,
                title: 'æ‘„å½±ä½œå“å±•è§ˆ',
                type: 'æ–‡åŒ–è‰ºæœ¯',
                category: 'culture',
                description: 'å±•ç¤ºæˆ‘æ ¡æ‘„å½±çˆ±å¥½è€…çš„ä¼˜ç§€ä½œå“ï¼ŒåŒ…æ‹¬æ ¡å›­é£å…‰ã€äººç‰©è‚–åƒã€çºªå®æ‘„å½±ç­‰å¤šç±»åˆ«ã€‚å¼€å¹•å¼å°†æœ‰ä¸“ä¸šæ‘„å½±å¸ˆç°åœºåˆ†äº«æ‹æ‘„æŠ€å·§ã€‚',
                locationName: 'è‰ºæœ¯å±•è§ˆä¸­å¿ƒ',
                location: {
                    name: 'è‰ºæœ¯å±•è§ˆä¸­å¿ƒ',
                    address: 'å¹¿ä¸œè¯ç§‘å¤§å­¦äº‘æµ®æ ¡åŒºè‰ºæœ¯å±•è§ˆä¸­å¿ƒ'
                },
                startTime: '2024-12-21T10:00:00',
                endTime: '2024-12-25T18:00:00',
                registrationDeadline: '2024-12-20T23:59:59',
                currentParticipants: 234,
                maxParticipants: 500,
                organizer: {
                    id: 2,
                    name: 'æ‘„å½±åä¼š',
                    avatar: '',
                    role: 'ç»„ç»‡è€…',
                    creditScore: 95
                },
                status: 'open',
                isEnrolled: false,
                distance: 0.5,
                tags: ['æ‘„å½±', 'è‰ºæœ¯', 'å±•è§ˆ', 'æ–‡åŒ–']
            },
            {
                id: 3,
                title: 'ç¼–ç¨‹é©¬æ‹‰æ¾å¤§èµ›',
                type: 'ç§‘æŠ€åˆ›æ–°',
                category: 'tech',
                description: '48å°æ—¶ç¼–ç¨‹æŒ‘æˆ˜èµ›ï¼Œä¸»é¢˜ä¸º"æ™ºæ…§æ ¡å›­"ã€‚å‚èµ›è€…éœ€è¦åœ¨è§„å®šæ—¶é—´å†…å®Œæˆåˆ›æ–°é¡¹ç›®å¼€å‘ï¼Œä¼˜èƒœå›¢é˜Ÿå°†è·å¾—ä¸°åšå¥–å“å’Œå®ä¹ æœºä¼šã€‚',
                locationName: 'åˆ›æ–°å®éªŒå®¤',
                location: {
                    name: 'åˆ›æ–°å®éªŒå®¤',
                    address: 'å¹¿ä¸œè¯ç§‘å¤§å­¦äº‘æµ®æ ¡åŒºåˆ›æ–°å®éªŒå®¤'
                },
                startTime: '2024-12-22T09:00:00',
                endTime: '2024-12-24T09:00:00',
                registrationDeadline: '2024-12-21T23:59:59',
                currentParticipants: 87,
                maxParticipants: 100,
                organizer: {
                    id: 3,
                    name: 'è®¡ç®—æœºå­¦é™¢',
                    avatar: '',
                    role: 'ç»„ç»‡è€…',
                    creditScore: 96
                },
                status: 'open',
                isEnrolled: false,
                distance: 1.2,
                tags: ['ç¼–ç¨‹', 'åˆ›æ–°', 'æ¯”èµ›', 'æŠ€æœ¯']
            },
            {
                id: 4,
                title: 'ç¯®çƒå‹è°Šèµ›',
                type: 'ä½“è‚²ç«æŠ€',
                category: 'sports',
                description: 'é™¢ç³»é—´ç¯®çƒå‹è°Šèµ›ï¼Œä¿ƒè¿›å„é™¢ç³»äº¤æµã€‚æ¯”èµ›é‡‡ç”¨å›½é™…ç¯®è”è§„åˆ™ï¼Œè®¾æœ‰MVPå¥–é¡¹å’Œæœ€ä½³å›¢é˜Ÿå¥–ã€‚',
                locationName: 'ä½“è‚²é¦†',
                location: {
                    name: 'ä½“è‚²é¦†',
                    address: 'å¹¿ä¸œè¯ç§‘å¤§å­¦äº‘æµ®æ ¡åŒºä½“è‚²é¦†'
                },
                startTime: '2024-12-23T16:00:00',
                endTime: '2024-12-23T18:00:00',
                registrationDeadline: '2024-12-22T23:59:59',
                currentParticipants: 178,
                maxParticipants: 200,
                organizer: {
                    id: 4,
                    name: 'ä½“è‚²éƒ¨',
                    avatar: '',
                    role: 'ç»„ç»‡è€…',
                    creditScore: 94
                },
                status: 'open',
                isEnrolled: false,
                distance: 0.8,
                tags: ['ç¯®çƒ', 'ä½“è‚²', 'æ¯”èµ›', 'å‹è°Šèµ›']
            },
            {
                id: 5,
                title: 'æ ¡å›­éŸ³ä¹èŠ‚',
                type: 'æ–‡è‰ºæ¼”å‡º',
                category: 'culture',
                description: 'å¹´åº¦æ ¡å›­éŸ³ä¹ç››å…¸ï¼Œé‚€è¯·æ ¡å†…çŸ¥åä¹é˜Ÿå’Œæ ¡å¤–ä¸“ä¸šéŸ³ä¹äººåŒå°æ¼”å‡ºã€‚æ¶µç›–æ‘‡æ»šã€æ°‘è°£ã€æµè¡Œç­‰å¤šç§éŸ³ä¹é£æ ¼ã€‚',
                locationName: 'å¤§å­¦ç”Ÿæ´»åŠ¨ä¸­å¿ƒ',
                location: {
                    name: 'å¤§å­¦ç”Ÿæ´»åŠ¨ä¸­å¿ƒ',
                    address: 'å¹¿ä¸œè¯ç§‘å¤§å­¦äº‘æµ®æ ¡åŒºå¤§å­¦ç”Ÿæ´»åŠ¨ä¸­å¿ƒ'
                },
                startTime: '2024-12-24T19:00:00',
                endTime: '2024-12-24T22:30:00',
                registrationDeadline: '2024-12-23T23:59:59',
                currentParticipants: 856,
                maxParticipants: 1000,
                organizer: {
                    id: 5,
                    name: 'å­¦ç”Ÿä¼šæ–‡è‰ºéƒ¨',
                    avatar: '',
                    role: 'ç»„ç»‡è€…',
                    creditScore: 92
                },
                status: 'open',
                isEnrolled: false,
                distance: 0.6,
                tags: ['éŸ³ä¹', 'æ¼”å‡º', 'æ–‡è‰º', 'éŸ³ä¹èŠ‚']
            },
            {
                id: 6,
                title: 'å›¾ä¹¦é¦†å­¦ä¹ å°ç»„',
                type: 'å­¦ä¹ äº¤æµ',
                category: 'study',
                description: 'ä¸ºæœŸä¸€å‘¨çš„é›†ä¸­å­¦ä¹ æ´»åŠ¨ï¼Œæä¾›å®‰é™çš„å­¦ä¹ ç¯å¢ƒå’Œä¸“ä¸šçš„å­¦ä¹ æŒ‡å¯¼ã€‚æ¯æ—¥æœ‰ä¸åŒå­¦ç§‘çš„è€å¸ˆç°åœºç­”ç–‘ã€‚',
                locationName: 'å›¾ä¹¦é¦†ç ”è®¨å®¤',
                location: {
                    name: 'å›¾ä¹¦é¦†ç ”è®¨å®¤',
                    address: 'å¹¿ä¸œè¯ç§‘å¤§å­¦äº‘æµ®æ ¡åŒºå›¾ä¹¦é¦†ç ”è®¨å®¤'
                },
                startTime: '2024-12-19T09:00:00',
                endTime: '2024-12-25T21:00:00',
                registrationDeadline: '2024-12-18T23:59:59',
                currentParticipants: 42,
                maxParticipants: 50,
                organizer: {
                    id: 6,
                    name: 'å›¾ä¹¦é¦†',
                    avatar: '',
                    role: 'ç»„ç»‡è€…',
                    creditScore: 99
                },
                status: 'open',
                isEnrolled: false,
                distance: 0.4,
                tags: ['å­¦ä¹ ', 'å›¾ä¹¦é¦†', 'ç ”è®¨', 'äº¤æµ']
            }
        ];

        function log(message) {
            const logElement = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logElement.textContent += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
        }

        function checkData() {
            log('ğŸ” å¼€å§‹æ£€æŸ¥localStorageä¸­çš„æ´»åŠ¨æ•°æ®...');
            
            try {
                const stored = localStorage.getItem('campus_activities');
                if (!stored) {
                    log('âŒ localStorageä¸­æ²¡æœ‰æ‰¾åˆ°æ´»åŠ¨æ•°æ®');
                    updateStats([]);
                    return;
                }

                const activities = JSON.parse(stored);
                log(`âœ… æˆåŠŸè¯»å–æ´»åŠ¨æ•°æ®ï¼Œå…± ${activities.length} ä¸ªæ´»åŠ¨`);
                
                // åˆ†ææ•°æ®
                const basketballCount = activities.filter(activity => 
                    activity.title && (activity.title.includes('ç¯®çƒ') || activity.title.includes('ç¯®çƒèµ›'))
                ).length;
                
                const basketballPercentage = activities.length > 0 ? 
                    Math.round((basketballCount / activities.length) * 100) : 0;
                
                updateStats(activities, basketballCount, basketballPercentage);
                displayActivities(activities);
                
                // åˆ¤æ–­æ•°æ®çŠ¶æ€
                if (basketballPercentage > 80) {
                    log('âš ï¸ è­¦å‘Šï¼šæ£€æµ‹åˆ°è¿‡å¤šçš„ç¯®çƒæ´»åŠ¨ï¼Œæ•°æ®å¯èƒ½å¼‚å¸¸');
                    document.getElementById('dataStatus').textContent = 'âš ï¸';
                } else {
                    log('âœ… æ•°æ®çŠ¶æ€æ­£å¸¸');
                    document.getElementById('dataStatus').textContent = 'âœ…';
                }
                
            } catch (error) {
                log(`âŒ æ£€æŸ¥æ•°æ®æ—¶å‡ºé”™: ${error.message}`);
            }
        }

        function updateStats(activities, basketballCount = 0, basketballPercentage = 0) {
            document.getElementById('totalActivities').textContent = activities.length;
            document.getElementById('basketballCount').textContent = basketballCount;
            document.getElementById('basketballPercentage').textContent = basketballPercentage + '%';
        }

        function displayActivities(activities) {
            const listElement = document.getElementById('activityList');
            
            if (activities.length === 0) {
                listElement.innerHTML = '<p>æ²¡æœ‰æ‰¾åˆ°æ´»åŠ¨æ•°æ®</p>';
                return;
            }
            
            listElement.innerHTML = activities.map(activity => `
                <div class="activity-item">
                    <div class="activity-title">${activity.title || 'æœªå‘½åæ´»åŠ¨'}</div>
                    <div class="activity-info">
                        ç±»å‹: ${activity.type || activity.category || 'æœªçŸ¥'} | 
                        åœ°ç‚¹: ${activity.locationName || 'æœªè®¾ç½®'} | 
                        å‚ä¸äººæ•°: ${activity.currentParticipants || 0}/${activity.maxParticipants || 0}
                    </div>
                </div>
            `).join('');
        }

        function fixData() {
            log('ğŸ”§ å¼€å§‹ä¿®å¤æ´»åŠ¨æ•°æ®...');
            
            try {
                // ä¿å­˜æ­£ç¡®çš„æ´»åŠ¨æ•°æ®åˆ°localStorage
                localStorage.setItem('campus_activities', JSON.stringify(correctActivities));
                
                log(`âœ… å·²æˆåŠŸä¿®å¤æ´»åŠ¨æ•°æ®ï¼Œå…± ${correctActivities.length} ä¸ªå¤šæ ·åŒ–æ´»åŠ¨`);
                log('ğŸ“‹ ä¿®å¤åçš„æ´»åŠ¨åˆ—è¡¨:');
                correctActivities.forEach((activity, index) => {
                    log(`  ${index + 1}. ${activity.title} - ${activity.type}`);
                });
                
                // æ›´æ–°ç»Ÿè®¡å’Œæ˜¾ç¤º
                updateStats(correctActivities, 1, Math.round((1 / correctActivities.length) * 100));
                displayActivities(correctActivities);
                document.getElementById('dataStatus').textContent = 'âœ…';
                
                log('ğŸ‰ æ•°æ®ä¿®å¤å®Œæˆï¼è¯·åˆ·æ–°åº”ç”¨é¡µé¢æŸ¥çœ‹æ•ˆæœ');
                
            } catch (error) {
                log(`âŒ ä¿®å¤æ•°æ®æ—¶å‡ºé”™: ${error.message}`);
            }
        }

        function clearData() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ´»åŠ¨æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                try {
                    localStorage.removeItem('campus_activities');
                    log('ğŸ—‘ï¸ å·²æ¸…ç©ºæ´»åŠ¨æ•°æ®');
                    updateStats([]);
                    displayActivities([]);
                    document.getElementById('dataStatus').textContent = 'âŒ';
                } catch (error) {
                    log(`âŒ æ¸…ç©ºæ•°æ®æ—¶å‡ºé”™: ${error.message}`);
                }
            }
        }

        function exportData() {
            try {
                const stored = localStorage.getItem('campus_activities');
                if (!stored) {
                    log('âŒ æ²¡æœ‰æ•°æ®å¯ä»¥å¯¼å‡º');
                    return;
                }
                
                const activities = JSON.parse(stored);
                const dataStr = JSON.stringify(activities, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                const url = URL.createObjectURL(dataBlob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = `activities_backup_${new Date().toISOString().slice(0, 10)}.json`;
                link.click();
                
                URL.revokeObjectURL(url);
                log(`âœ… å·²å¯¼å‡º ${activities.length} ä¸ªæ´»åŠ¨æ•°æ®`);
                
            } catch (error) {
                log(`âŒ å¯¼å‡ºæ•°æ®æ—¶å‡ºé”™: ${error.message}`);
            }
        }

        function refreshPage() {
            log('ğŸ”„ å‡†å¤‡åˆ·æ–°åº”ç”¨é¡µé¢...');
            setTimeout(() => {
                window.open('http://localhost:3000/activities', '_blank');
                log('âœ… å·²åœ¨æ–°æ ‡ç­¾é¡µä¸­æ‰“å¼€æ´»åŠ¨é¡µé¢');
            }, 1000);
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥æ•°æ®
        window.onload = function() {
            log('ğŸš€ ç¯®çƒèµ›é—®é¢˜ä¿®å¤å·¥å…·å·²å¯åŠ¨');
            checkData();
        };
    </script>
</body>
</html>