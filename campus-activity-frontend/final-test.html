<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ´»åŠ¨åˆ›å»ºæµ‹è¯• - æœ€ç»ˆéªŒè¯</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .section {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #e8e8e8;
            border-radius: 6px;
        }
        .btn {
            background: #1890ff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover {
            background: #40a9ff;
        }
        .btn.danger {
            background: #ff4d4f;
        }
        .btn.danger:hover {
            background: #ff7875;
        }
        .btn.success {
            background: #52c41a;
        }
        .btn.success:hover {
            background: #73d13d;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .status.success {
            background: #f6ffed;
            border: 1px solid #b7eb8f;
            color: #52c41a;
        }
        .status.error {
            background: #fff2f0;
            border: 1px solid #ffccc7;
            color: #ff4d4f;
        }
        .status.warning {
            background: #fffbe6;
            border: 1px solid #ffe58f;
            color: #faad14;
        }
        .activity-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #e8e8e8;
            border-radius: 4px;
            padding: 10px;
        }
        .activity-item {
            padding: 8px;
            border-bottom: 1px solid #f0f0f0;
        }
        .activity-item:last-child {
            border-bottom: none;
        }
        .activity-item.new {
            background: #e6f7ff;
            border-left: 3px solid #1890ff;
        }
        pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }
        .step {
            margin: 10px 0;
            padding: 10px;
            background: #fafafa;
            border-radius: 4px;
        }
        .step-number {
            display: inline-block;
            width: 24px;
            height: 24px;
            background: #1890ff;
            color: white;
            text-align: center;
            line-height: 24px;
            border-radius: 50%;
            margin-right: 8px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ æ´»åŠ¨åˆ›å»ºé—®é¢˜ - æœ€ç»ˆéªŒè¯æµ‹è¯•</h1>
        
        <div class="section">
            <h3>ğŸ“‹ æµ‹è¯•æ­¥éª¤</h3>
            <div class="step">
                <span class="step-number">1</span>
                <strong>æ£€æŸ¥å½“å‰çŠ¶æ€</strong> - æŸ¥çœ‹localStorageä¸­çš„æ´»åŠ¨æ•°æ®
            </div>
            <div class="step">
                <span class="step-number">2</span>
                <strong>æ¸…ç†æµ‹è¯•ç¯å¢ƒ</strong> - æ¸…ç†ç°æœ‰æ•°æ®ï¼Œæ¨¡æ‹Ÿåˆå§‹çŠ¶æ€
            </div>
            <div class="step">
                <span class="step-number">3</span>
                <strong>æ¨¡æ‹Ÿåˆ›å»ºæ´»åŠ¨</strong> - åˆ›å»ºä¸€ä¸ªæ–°æ´»åŠ¨å¹¶æ·»åŠ åˆ°åˆ—è¡¨
            </div>
            <div class="step">
                <span class="step-number">4</span>
                <strong>éªŒè¯æ˜¾ç¤ºæ•ˆæœ</strong> - æ£€æŸ¥æ–°æ´»åŠ¨æ˜¯å¦æ­£ç¡®æ˜¾ç¤ºåœ¨åˆ—è¡¨ä¸­
            </div>
        </div>

        <div class="section">
            <h3>ğŸ”§ æµ‹è¯•æ§åˆ¶</h3>
            <button class="btn" onclick="step1_checkState()">æ­¥éª¤1: æ£€æŸ¥å½“å‰çŠ¶æ€</button>
            <button class="btn danger" onclick="step2_clearData()">æ­¥éª¤2: æ¸…ç†æµ‹è¯•ç¯å¢ƒ</button>
            <button class="btn success" onclick="step3_createActivity()">æ­¥éª¤3: æ¨¡æ‹Ÿåˆ›å»ºæ´»åŠ¨</button>
            <button class="btn" onclick="step4_verifyResult()">æ­¥éª¤4: éªŒè¯æ˜¾ç¤ºæ•ˆæœ</button>
            <button class="btn" onclick="runFullTest()">ğŸš€ è¿è¡Œå®Œæ•´æµ‹è¯•</button>
            <div id="testResult"></div>
        </div>

        <div class="section">
            <h3>ğŸ“Š å½“å‰æ´»åŠ¨åˆ—è¡¨</h3>
            <button class="btn" onclick="refreshActivityList()">åˆ·æ–°åˆ—è¡¨</button>
            <div id="activityList"></div>
        </div>

        <div class="section">
            <h3>ğŸ“ ä¿®å¤è¯¦æƒ…</h3>
            <div class="status success">
                <strong>âœ… å·²ä¿®å¤çš„é—®é¢˜ï¼š</strong>
                <ul>
                    <li><strong>ActivityList.vue</strong> - ç§»é™¤å¼ºåˆ¶æ¸…ç†localStorageçš„é€»è¾‘</li>
                    <li><strong>ActivityList.vue</strong> - ä»…åœ¨æ— æ•°æ®æ—¶åˆå§‹åŒ–é»˜è®¤æ•°æ®</li>
                    <li><strong>CreateActivity.vue</strong> - åˆ›å»ºæ´»åŠ¨åä¸å†é‡æ–°åŠ è½½æ•°æ®</li>
                    <li><strong>æ•°æ®æµç¨‹</strong> - æ–°æ´»åŠ¨ç›´æ¥æ·»åŠ åˆ°storeï¼Œé¿å…æ•°æ®ä¸¢å¤±</li>
                </ul>
            </div>
            <div class="status warning">
                <strong>âš ï¸ æµ‹è¯•è¦ç‚¹ï¼š</strong>
                <ul>
                    <li>æ–°æ´»åŠ¨åº”è¯¥å‡ºç°åœ¨åˆ—è¡¨é¡¶éƒ¨</li>
                    <li>åŸæœ‰æ´»åŠ¨æ•°æ®åº”è¯¥ä¿ç•™</li>
                    <li>é¡µé¢åˆ·æ–°åæ•°æ®åº”è¯¥æŒä¹…åŒ–</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        let testActivityId = null;
        let originalData = null;

        function step1_checkState() {
            const result = document.getElementById('testResult');
            const activities = localStorage.getItem('campus_activities');
            
            if (!activities) {
                result.innerHTML = '<div class="status warning">âš ï¸ localStorageä¸­æ²¡æœ‰æ´»åŠ¨æ•°æ®</div>';
            } else {
                try {
                    const parsed = JSON.parse(activities);
                    originalData = parsed; // ä¿å­˜åŸå§‹æ•°æ®
                    result.innerHTML = `
                        <div class="status success">
                            âœ… å½“å‰çŠ¶æ€æ£€æŸ¥å®Œæˆ
                            <br>æ´»åŠ¨æ•°é‡: ${parsed.length}
                            <pre>${JSON.stringify(parsed.map(a => ({id: a.id, title: a.title})), null, 2)}</pre>
                        </div>
                    `;
                } catch (e) {
                    result.innerHTML = '<div class="status error">âŒ localStorageæ•°æ®æ ¼å¼é”™è¯¯</div>';
                }
            }
        }

        function step2_clearData() {
            const result = document.getElementById('testResult');
            
            // ä¿å­˜åŸå§‹æ•°æ®ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰
            if (!originalData) {
                const activities = localStorage.getItem('campus_activities');
                if (activities) {
                    try {
                        originalData = JSON.parse(activities);
                    } catch (e) {
                        console.warn('æ— æ³•ä¿å­˜åŸå§‹æ•°æ®');
                    }
                }
            }
            
            // æ¸…ç†æ•°æ®
            localStorage.removeItem('campus_activities');
            result.innerHTML = '<div class="status success">âœ… æµ‹è¯•ç¯å¢ƒå·²æ¸…ç†</div>';
            
            setTimeout(refreshActivityList, 500);
        }

        function step3_createActivity() {
            const result = document.getElementById('testResult');
            
            try {
                // åˆ›å»ºæµ‹è¯•æ´»åŠ¨
                testActivityId = Date.now();
                const newActivity = {
                    id: testActivityId,
                    title: 'ğŸ†• æµ‹è¯•æ´»åŠ¨ - ' + new Date().toLocaleTimeString(),
                    type: 'test',
                    category: 'test',
                    locationName: 'æµ‹è¯•åœ°ç‚¹',
                    description: 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æ´»åŠ¨ï¼Œç”¨äºéªŒè¯ä¿®å¤æ•ˆæœ',
                    startTime: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString(),
                    endTime: new Date(Date.now() + 26 * 60 * 60 * 1000).toISOString(),
                    currentParticipants: 0,
                    maxParticipants: 20,
                    organizer: { id: 1, name: 'æµ‹è¯•ç”¨æˆ·', creditScore: 100 },
                    distance: 0.1,
                    isEnrolled: false,
                    status: 'open'
                };
                
                // è·å–ç°æœ‰æ´»åŠ¨
                let activities = [];
                const existing = localStorage.getItem('campus_activities');
                if (existing) {
                    activities = JSON.parse(existing);
                } else {
                    // å¦‚æœæ²¡æœ‰æ•°æ®ï¼Œåˆå§‹åŒ–é»˜è®¤æ•°æ®
                    activities = getDefaultActivities();
                }
                
                // æ·»åŠ æ–°æ´»åŠ¨åˆ°å¼€å¤´ï¼ˆæ¨¡æ‹ŸçœŸå®åˆ›å»ºé€»è¾‘ï¼‰
                activities.unshift(newActivity);
                
                // ä¿å­˜åˆ°localStorage
                localStorage.setItem('campus_activities', JSON.stringify(activities));
                
                result.innerHTML = `
                    <div class="status success">
                        âœ… æ´»åŠ¨åˆ›å»ºæˆåŠŸï¼
                        <br>æ´»åŠ¨ID: ${testActivityId}
                        <br>æ´»åŠ¨æ ‡é¢˜: ${newActivity.title}
                        <br>å½“å‰æ´»åŠ¨æ€»æ•°: ${activities.length}
                    </div>
                `;
                
                // è‡ªåŠ¨åˆ·æ–°åˆ—è¡¨
                setTimeout(refreshActivityList, 500);
                
            } catch (error) {
                result.innerHTML = `<div class="status error">âŒ åˆ›å»ºæ´»åŠ¨å¤±è´¥: ${error.message}</div>`;
            }
        }

        function step4_verifyResult() {
            const result = document.getElementById('testResult');
            
            try {
                const activities = localStorage.getItem('campus_activities');
                if (!activities) {
                    result.innerHTML = '<div class="status error">âŒ æ²¡æœ‰æ´»åŠ¨æ•°æ®å¯éªŒè¯</div>';
                    return;
                }
                
                const parsed = JSON.parse(activities);
                
                // æ£€æŸ¥æ–°æ´»åŠ¨æ˜¯å¦å­˜åœ¨
                const newActivity = parsed.find(a => a.id === testActivityId);
                
                if (newActivity) {
                    // æ£€æŸ¥æ˜¯å¦åœ¨åˆ—è¡¨é¡¶éƒ¨
                    const isFirst = parsed[0].id === testActivityId;
                    
                    result.innerHTML = `
                        <div class="status success">
                            âœ… éªŒè¯æˆåŠŸï¼
                            <br>âœ… æ–°æ´»åŠ¨å·²åˆ›å»º (ID: ${testActivityId})
                            <br>âœ… æ–°æ´»åŠ¨åœ¨åˆ—è¡¨${isFirst ? 'é¡¶éƒ¨' : 'å…¶ä»–ä½ç½®'}
                            <br>âœ… æ´»åŠ¨æ€»æ•°: ${parsed.length}
                            <br>âœ… æ•°æ®æŒä¹…åŒ–æ­£å¸¸
                        </div>
                    `;
                } else {
                    result.innerHTML = `
                        <div class="status error">
                            âŒ éªŒè¯å¤±è´¥ï¼
                            <br>âŒ æ–°æ´»åŠ¨æœªæ‰¾åˆ° (ID: ${testActivityId})
                            <br>âŒ å½“å‰æ´»åŠ¨æ•°é‡: ${parsed.length}
                        </div>
                    `;
                }
                
            } catch (error) {
                result.innerHTML = `<div class="status error">âŒ éªŒè¯å¤±è´¥: ${error.message}</div>`;
            }
        }

        function runFullTest() {
            const result = document.getElementById('testResult');
            result.innerHTML = '<div class="status warning">ğŸ”„ æ­£åœ¨è¿è¡Œå®Œæ•´æµ‹è¯•...</div>';
            
            setTimeout(() => {
                step1_checkState();
                setTimeout(() => {
                    step2_clearData();
                    setTimeout(() => {
                        step3_createActivity();
                        setTimeout(() => {
                            step4_verifyResult();
                        }, 1000);
                    }, 1000);
                }, 1000);
            }, 500);
        }

        function refreshActivityList() {
            const result = document.getElementById('activityList');
            
            try {
                const activities = localStorage.getItem('campus_activities');
                if (!activities) {
                    result.innerHTML = '<div class="status warning">âš ï¸ æ²¡æœ‰æ´»åŠ¨æ•°æ®</div>';
                    return;
                }
                
                const parsed = JSON.parse(activities);
                if (parsed.length === 0) {
                    result.innerHTML = '<div class="status warning">âš ï¸ æ´»åŠ¨åˆ—è¡¨ä¸ºç©º</div>';
                    return;
                }
                
                const listHTML = parsed.map((activity, index) => `
                    <div class="activity-item ${activity.id === testActivityId ? 'new' : ''}">
                        <strong>${activity.id === testActivityId ? 'ğŸ†• ' : ''}ID: ${activity.id}</strong> - ${activity.title}
                        <br><small>ç±»å‹: ${activity.type} | åœ°ç‚¹: ${activity.locationName} | å‚ä¸è€…: ${activity.currentParticipants}/${activity.maxParticipants}</small>
                        ${index === 0 ? '<br><small style="color: #52c41a;">ğŸ“ åˆ—è¡¨é¡¶éƒ¨</small>' : ''}
                    </div>
                `).join('');
                
                result.innerHTML = `
                    <div class="status success">
                        âœ… å½“å‰å…±æœ‰ ${parsed.length} ä¸ªæ´»åŠ¨ï¼š
                    </div>
                    <div class="activity-list">
                        ${listHTML}
                    </div>
                `;
                
            } catch (error) {
                result.innerHTML = `<div class="status error">âŒ æ˜¾ç¤ºæ´»åŠ¨åˆ—è¡¨å¤±è´¥: ${error.message}</div>`;
            }
        }

        function getDefaultActivities() {
            return [
                {
                    id: 1,
                    title: 'ä¸­åŒ»å…»ç”Ÿè®²åº§',
                    type: 'study',
                    category: 'study',
                    locationName: 'å­¦æœ¯æŠ¥å‘Šå…',
                    description: 'é‚€è¯·ä¸­åŒ»ä¸“å®¶è®²è§£ä¸­åŒ»å…»ç”ŸçŸ¥è¯†ï¼Œåˆ†äº«ä¼ ç»Ÿä¿å¥æ–¹æ³•ã€‚',
                    startTime: new Date(Date.now() + 2 * 24 * 60 * 60 * 1000).toISOString(),
                    endTime: new Date(Date.now() + 2 * 24 * 60 * 60 * 1000 + 2 * 60 * 60 * 1000).toISOString(),
                    currentParticipants: 15,
                    maxParticipants: 30,
                    organizer: { id: 2, name: 'ä¸­åŒ»å­¦é™¢', creditScore: 98 },
                    distance: 0.8,
                    isEnrolled: false,
                    status: 'open'
                },
                {
                    id: 2,
                    title: 'æ‘„å½±ä½œå“å±•è§ˆ',
                    type: 'culture',
                    category: 'culture',
                    locationName: 'è‰ºæœ¯å±•å…',
                    description: 'å±•ç¤ºå­¦ç”Ÿæ‘„å½±ä½œå“ï¼Œåˆ†äº«æ‘„å½±æŠ€å·§ï¼Œäº¤æµåˆ›ä½œå¿ƒå¾—ã€‚',
                    startTime: new Date(Date.now() + 3 * 24 * 60 * 60 * 1000).toISOString(),
                    endTime: new Date(Date.now() + 3 * 24 * 60 * 60 * 1000 + 3 * 60 * 60 * 1000).toISOString(),
                    currentParticipants: 12,
                    maxParticipants: 25,
                    organizer: { id: 3, name: 'æ‘„å½±åä¼š', creditScore: 92 },
                    distance: 0.3,
                    isEnrolled: false,
                    status: 'open'
                }
            ];
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥å½“å‰çŠ¶æ€
        window.onload = function() {
            refreshActivityList();
        };
    </script>
</body>
</html>