<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ´»åŠ¨æ•°æ®è°ƒè¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        button { margin: 5px; padding: 10px 15px; cursor: pointer; }
        .result { margin: 10px 0; padding: 10px; background: #f5f5f5; }
        .error { background: #ffe6e6; color: red; }
        .success { background: #e6ffe6; color: green; }
    </style>
</head>
<body>
    <h1>æ´»åŠ¨æ•°æ®è°ƒè¯•å·¥å…·</h1>
    
    <div class="test-section">
        <h3>æµ‹è¯•æ´»åŠ¨è¯¦æƒ…API</h3>
        <button onclick="testActivityDetail('1')">æµ‹è¯•æ´»åŠ¨ID=1</button>
        <button onclick="testActivityDetail('2')">æµ‹è¯•æ´»åŠ¨ID=2</button>
        <button onclick="testActivityDetail('3')">æµ‹è¯•æ´»åŠ¨ID=3</button>
        <button onclick="testActivityDetail('4')">æµ‹è¯•æ´»åŠ¨ID=4</button>
        <button onclick="testActivityDetail('5')">æµ‹è¯•æ´»åŠ¨ID=5</button>
        <button onclick="testActivityDetail('6')">æµ‹è¯•æ´»åŠ¨ID=6</button>
        <div id="api-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>æ£€æŸ¥æ•°æ®æº</h3>
        <button onclick="checkLocalStorage()">æ£€æŸ¥localStorage</button>
        <button onclick="checkGlobalData()">æ£€æŸ¥GlobalData</button>
        <div id="data-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>æ¨¡æ‹Ÿè·¯ç”±è·³è½¬</h3>
        <button onclick="simulateRoute('1')">è·³è½¬åˆ°æ´»åŠ¨è¯¦æƒ…(1)</button>
        <button onclick="simulateRoute('2')">è·³è½¬åˆ°æ´»åŠ¨è¯¦æƒ…(2)</button>
        <button onclick="simulateRoute('3')">è·³è½¬åˆ°æ´»åŠ¨è¯¦æƒ…(3)</button>
        <div id="route-result" class="result"></div>
    </div>

    <script type="module">
        // å¯¼å…¥å¿…è¦çš„æ¨¡å—
        import { getActivityDetail } from './src/api/activity.js';
        import { globalDataManager } from './src/api/global-data.js';
        
        window.testActivityDetail = async function(id) {
            const resultDiv = document.getElementById('api-result');
            resultDiv.innerHTML = `æ­£åœ¨æµ‹è¯•æ´»åŠ¨ID=${id}...`;
            
            try {
                console.log(`ğŸ” æµ‹è¯•æ´»åŠ¨ID: ${id}`);
                const result = await getActivityDetail(id);
                
                if (result && result.success && result.data) {
                    resultDiv.innerHTML = `
                        <div class="success">
                            âœ… æ´»åŠ¨${id}è·å–æˆåŠŸ<br>
                            ID: ${result.data.id}<br>
                            æ ‡é¢˜: ${result.data.title}<br>
                            ç±»å‹: ${result.data.type}<br>
                            ç±»åˆ«: ${result.data.category}<br>
                            çŠ¶æ€: ${result.data.status}<br>
                            æè¿°: ${result.data.description?.substring(0, 50)}...
                        </div>
                    `;
                    console.log('âœ… æ´»åŠ¨æ•°æ®:', result.data);
                } else {
                    resultDiv.innerHTML = `<div class="error">âŒ å“åº”æ ¼å¼é”™è¯¯: ${JSON.stringify(result)}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">âŒ è·å–æ´»åŠ¨${id}å¤±è´¥: ${error.message}</div>`;
                console.error('âŒ é”™è¯¯:', error);
            }
        };
        
        window.checkLocalStorage = function() {
            const resultDiv = document.getElementById('data-result');
            const localStorageData = localStorage.getItem('campus_activities');
            
            if (localStorageData) {
                const activities = JSON.parse(localStorageData);
                resultDiv.innerHTML = `
                    <div class="success">
                        ğŸ“¦ localStorageä¸­æœ‰${activities.length}ä¸ªæ´»åŠ¨<br>
                        ${activities.map(a => `ID:${a.id} - ${a.title}`).join('<br>')}
                    </div>
                `;
            } else {
                resultDiv.innerHTML = `<div class="error">ğŸ“¦ localStorageä¸­æ²¡æœ‰æ´»åŠ¨æ•°æ®</div>`;
            }
        };
        
        window.checkGlobalData = function() {
            const resultDiv = document.getElementById('data-result');
            const activities = globalDataManager.getActivities();
            
            resultDiv.innerHTML = `
                <div class="success">
                    ğŸŒ GlobalDataä¸­æœ‰${activities.length}ä¸ªæ´»åŠ¨<br>
                    ${activities.map(a => `ID:${a.id} - ${a.title}`).join('<br>')}
                </div>
            `;
            console.log('ğŸŒ GlobalDataæ´»åŠ¨:', activities);
        };
        
        window.simulateRoute = function(id) {
            const resultDiv = document.getElementById('route-result');
            resultDiv.innerHTML = `
                <div class="success">
                    ğŸš€ æ¨¡æ‹Ÿè·³è½¬åˆ°æ´»åŠ¨è¯¦æƒ…é¡µé¢<br>
                    è·¯ç”±å‚æ•°: id = ${id}<br>
                    å®é™…URL: http://localhost:3001/activity/${id}<br>
                    <a href="/activity/${id}" target="_blank">ç‚¹å‡»è·³è½¬åˆ°çœŸå®é¡µé¢</a>
                </div>
            `;
        };
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥æ•°æ®
        window.addEventListener('load', () => {
            console.log('ğŸ” è°ƒè¯•é¡µé¢å·²åŠ è½½');
            checkGlobalData();
        });
    </script>
</body>
</html>