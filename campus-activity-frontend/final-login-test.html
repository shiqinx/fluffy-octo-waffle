<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç™»å½•é—®é¢˜æœ€ç»ˆæµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 8px; }
        .result { margin: 10px 0; padding: 10px; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        input { margin: 5px; padding: 8px; width: 200px; border: 1px solid #ccc; border-radius: 4px; }
        button { padding: 10px 15px; margin: 5px; background: #1989fa; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #1677ff; }
        pre { background: #f8f9fa; padding: 10px; overflow-x: auto; max-height: 300px; overflow-y: auto; border-radius: 4px; }
        .form-group { margin: 15px 0; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        .test-case { margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>ğŸ¯ ç™»å½•é—®é¢˜æœ€ç»ˆæµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>ğŸ§ª è‡ªåŠ¨åŒ–æµ‹è¯•ç”¨ä¾‹</h2>
        <button onclick="runAllTests()">è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
        <div id="testResults"></div>
    </div>

    <script type="module">
        import { validateLoginParams } from './src/utils/validation.js'
        import { validatedApi } from './src/api/index.js'
        
        function addResult(message, type = 'info') {
            const resultsDiv = document.getElementById('testResults')
            const resultDiv = document.createElement('div')
            resultDiv.className = `result ${type}`
            resultDiv.innerHTML = message
            resultsDiv.appendChild(resultDiv)
        }
        
        async function runTest(testName, credentials, expectedResult = 'success') {
            addResult(`<div class="test-case"><strong>ğŸ§ª æµ‹è¯•: ${testName}</strong><br>å‚æ•°: ${JSON.stringify(credentials)}</div>`)
            
            try {
                const validatedParams = await validateLoginParams(credentials)
                addResult(`âœ… éªŒè¯æˆåŠŸ: ${JSON.stringify(validatedParams)}`, 'success')
                
                if (expectedResult === 'error') {
                    addResult(`âš ï¸ é¢„æœŸåº”è¯¥å¤±è´¥ï¼Œä½†éªŒè¯æˆåŠŸäº†`, 'warning')
                }
                
                return { success: true, data: validatedParams }
            } catch (error) {
                addResult(`âŒ éªŒè¯å¤±è´¥: ${error.message}`, 'error')
                
                if (expectedResult === 'success') {
                    addResult(`âš ï¸ é¢„æœŸåº”è¯¥æˆåŠŸï¼Œä½†éªŒè¯å¤±è´¥äº†`, 'warning')
                }
                
                return { success: false, error: error.message }
            }
        }
        
        window.runAllTests = async function() {
            document.getElementById('testResults').innerHTML = ''
            addResult('<h2>ğŸš€ å¼€å§‹è¿è¡Œæ‰€æœ‰æµ‹è¯•ç”¨ä¾‹</h2>')
            
            const testCases = [
                {
                    name: 'æ­£å¸¸å­¦å·ç™»å½•',
                    credentials: { studentId: '20210001', password: '123456' },
                    expected: 'success'
                },
                {
                    name: 'ç©ºå­¦å·',
                    credentials: { studentId: '', password: '123456' },
                    expected: 'error'
                },
                {
                    name: 'ç©ºå¯†ç ',
                    credentials: { studentId: '20210001', password: '' },
                    expected: 'error'
                },
                {
                    name: 'ç”¨æˆ·åç™»å½•',
                    credentials: { username: 'testuser', password: '123456' },
                    expected: 'success'
                },
                {
                    name: 'ç©ºç”¨æˆ·åå’Œå­¦å·',
                    credentials: { password: '123456' },
                    expected: 'error'
                },
                {
                    name: 'å­¦å·å’Œç”¨æˆ·åéƒ½å­˜åœ¨',
                    credentials: { studentId: '20210001', username: 'testuser', password: '123456' },
                    expected: 'success'
                },
                {
                    name: 'å¸¦è®°ä½å¯†ç é€‰é¡¹',
                    credentials: { studentId: '20210001', password: '123456', rememberMe: true },
                    expected: 'success'
                }
            ]
            
            let passedTests = 0
            let totalTests = testCases.length
            
            for (const testCase of testCases) {
                const result = await runTest(testCase.name, testCase.credentials, testCase.expected)
                if (result.success && testCase.expected === 'success') {
                    passedTests++
                } else if (!result.success && testCase.expected === 'error') {
                    passedTests++
                }
            }
            
            addResult(`<h2>ğŸ“Š æµ‹è¯•ç»“æœç»Ÿè®¡</h2>`)
            addResult(`é€šè¿‡: ${passedTests}/${totalTests} (${Math.round(passedTests/totalTests*100)}%)`, 
                     passedTests === totalTests ? 'success' : 'warning')
            
            if (passedTests === totalTests) {
                addResult('ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ç™»å½•é—®é¢˜å·²ä¿®å¤ï¼', 'success')
            } else {
                addResult('âš ï¸ éƒ¨åˆ†æµ‹è¯•å¤±è´¥ï¼Œéœ€è¦è¿›ä¸€æ­¥æ£€æŸ¥', 'warning')
            }
        }
    </script>
</body>
</html>