<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ´»åŠ¨åŠŸèƒ½æµ‹è¯• - ç¾åŒ–ç‰ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .test-card {
            background: white;
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .test-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }

        .test-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .test-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-right: 15px;
        }

        .test-1 .test-icon { background: linear-gradient(135deg, #FF6B6B, #FF8E53); }
        .test-2 .test-icon { background: linear-gradient(135deg, #4ECDC4, #44A08D); }
        .test-3 .test-icon { background: linear-gradient(135deg, #45B7D1, #2196F3); }
        .test-4 .test-icon { background: linear-gradient(135deg, #F7B731, #F5A623); }

        .test-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #2c3e50;
        }

        .test-description {
            color: #7f8c8d;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .test-button {
            width: 100%;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 15px;
        }

        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .test-1 .test-button { background: linear-gradient(135deg, #FF6B6B, #FF8E53); color: white; }
        .test-2 .test-button { background: linear-gradient(135deg, #4ECDC4, #44A08D); color: white; }
        .test-3 .test-button { background: linear-gradient(135deg, #45B7D1, #2196F3); color: white; }
        .test-4 .test-button { background: linear-gradient(135deg, #F7B731, #F5A623); color: white; }

        .result-box {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            min-height: 60px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            border-left: 4px solid #e9ecef;
            transition: all 0.3s ease;
        }

        .result-box.success {
            background: #d4edda;
            border-left-color: #28a745;
            color: #155724;
        }

        .result-box.error {
            background: #f8d7da;
            border-left-color: #dc3545;
            color: #721c24;
        }

        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }

        .status-indicator.success { background: #28a745; }
        .status-indicator.error { background: #dc3545; }
        .status-indicator.pending { background: #ffc107; }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .summary-section {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
        }

        .summary-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 20px;
        }

        .summary-stats {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 20px;
        }

        .stat-item {
            flex: 1;
            min-width: 120px;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #3498db;
        }

        .stat-label {
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .test-grid {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ¯ æ´»åŠ¨åŠŸèƒ½æµ‹è¯•</h1>
            <p class="subtitle">éªŒè¯æ´»åŠ¨åˆ›å»ºã€çŠ¶æ€è®¡ç®—ã€ä½ç½®ä¿¡æ¯å’Œåˆ—è¡¨è·å–åŠŸèƒ½</p>
        </header>

        <div class="test-grid">
            <!-- æµ‹è¯•1: æ´»åŠ¨åˆ›å»º -->
            <div class="test-card test-1">
                <div class="test-header">
                    <div class="test-icon">ğŸ“</div>
                    <h2 class="test-title">æ´»åŠ¨åˆ›å»º</h2>
                </div>
                <p class="test-description">æµ‹è¯•æ´»åŠ¨åˆ›å»ºåŠŸèƒ½ï¼ŒåŒ…æ‹¬åŸºæœ¬ä¿¡æ¯ã€æ—¶é—´è®¾ç½®å’Œä½ç½®ä¿¡æ¯</p>
                <button class="test-button" onclick="testActivityCreation()">
                    <span id="loading1" style="display:none;" class="loading"></span>
                    <span id="text1">æµ‹è¯•æ´»åŠ¨åˆ›å»º</span>
                </button>
                <div id="result1" class="result-box">ç­‰å¾…æµ‹è¯•...</div>
            </div>

            <!-- æµ‹è¯•2: çŠ¶æ€è®¡ç®— -->
            <div class="test-card test-2">
                <div class="test-header">
                    <div class="test-icon">ğŸ”„</div>
                    <h2 class="test-title">çŠ¶æ€è®¡ç®—</h2>
                </div>
                <p class="test-description">æµ‹è¯•æ´»åŠ¨çŠ¶æ€åŠ¨æ€è®¡ç®—ï¼ŒåŒ…æ‹¬æ‹›å‹Ÿä¸­ã€è¿›è¡Œä¸­ã€å·²ç»“æŸç­‰çŠ¶æ€</p>
                <button class="test-button" onclick="testStatusCalculation()">
                    <span id="loading2" style="display:none;" class="loading"></span>
                    <span id="text2">æµ‹è¯•çŠ¶æ€è®¡ç®—</span>
                </button>
                <div id="result2" class="result-box">ç­‰å¾…æµ‹è¯•...</div>
            </div>

            <!-- æµ‹è¯•3: ä½ç½®ä¿¡æ¯ -->
            <div class="test-card test-3">
                <div class="test-header">
                    <div class="test-icon">ğŸ“</div>
                    <h2 class="test-title">ä½ç½®ä¿¡æ¯</h2>
                </div>
                <p class="test-description">æµ‹è¯•æ´»åŠ¨ä½ç½®ä¿¡æ¯çš„ä¿å­˜å’Œè·å–ï¼ŒåŒ…æ‹¬åæ ‡å’Œåœ°ç‚¹åç§°</p>
                <button class="test-button" onclick="testLocationInfo()">
                    <span id="loading3" style="display:none;" class="loading"></span>
                    <span id="text3">æµ‹è¯•ä½ç½®ä¿¡æ¯</span>
                </button>
                <div id="result3" class="result-box">ç­‰å¾…æµ‹è¯•...</div>
            </div>

            <!-- æµ‹è¯•4: åˆ—è¡¨è·å– -->
            <div class="test-card test-4">
                <div class="test-header">
                    <div class="test-icon">ğŸ“‹</div>
                    <h2 class="test-title">åˆ—è¡¨è·å–</h2>
                </div>
                <p class="test-description">æµ‹è¯•æ´»åŠ¨åˆ—è¡¨è·å–åŠŸèƒ½ï¼ŒéªŒè¯æ–°åˆ›å»ºçš„æ´»åŠ¨èƒ½æ­£ç¡®æ˜¾ç¤º</p>
                <button class="test-button" onclick="testActivityList()">
                    <span id="loading4" style="display:none;" class="loading"></span>
                    <span id="text4">æµ‹è¯•åˆ—è¡¨è·å–</span>
                </button>
                <div id="result4" class="result-box">ç­‰å¾…æµ‹è¯•...</div>
            </div>
        </div>

        <div class="summary-section">
            <h2 class="summary-title">ğŸ“Š æµ‹è¯•æ€»ç»“</h2>
            <div class="summary-stats">
                <div class="stat-item">
                    <div class="stat-number" id="totalTests">0</div>
                    <div class="stat-label">æ€»æµ‹è¯•æ•°</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="passedTests">0</div>
                    <div class="stat-label">é€šè¿‡æµ‹è¯•</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="failedTests">0</div>
                    <div class="stat-label">å¤±è´¥æµ‹è¯•</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="successRate">0%</div>
                    <div class="stat-label">æˆåŠŸç‡</div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        // å¯¼å…¥å¿…è¦çš„æ¨¡å—
        import { globalDataManager } from '../src/api/globalDataManager.js';
        import { mockCreateActivity, mockGetActivityDetail, calculateActivityStatus, mockGetActivityList } from '../src/api/mock.js';
        import { campusBuildings } from '../src/config/map.js';

        // æµ‹è¯•æ•°æ®
        const testActivityData = {
            title: 'æµ‹è¯•æ´»åŠ¨ - ç¾åŒ–ç‰ˆ',
            description: 'è¿™æ˜¯ä¸€ä¸ªç”¨äºæµ‹è¯•åŠŸèƒ½çš„æ´»åŠ¨ï¼ŒåŒ…å«å®Œæ•´çš„ä½ç½®ä¿¡æ¯',
            category: 'study',
            maxParticipants: 10,
            startTime: new Date(Date.now() + 2 * 60 * 60 * 1000).toISOString().slice(0, 16),
            endTime: new Date(Date.now() + 4 * 60 * 60 * 1000).toISOString().slice(0, 16),
            location: campusBuildings[0], // ä½¿ç”¨ç¬¬ä¸€ä¸ªæ ¡å›­å»ºç­‘
            requiresApproval: false
        };

        let testResults = {
            total: 0,
            passed: 0,
            failed: 0
        };

        // æ›´æ–°æµ‹è¯•ç»Ÿè®¡
        function updateStats() {
            document.getElementById('totalTests').textContent = testResults.total;
            document.getElementById('passedTests').textContent = testResults.passed;
            document.getElementById('failedTests').textContent = testResults.failed;
            const rate = testResults.total > 0 ? Math.round((testResults.passed / testResults.total) * 100) : 0;
            document.getElementById('successRate').textContent = rate + '%';
        }

        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        function showLoading(testNum, show = true) {
            document.getElementById(`loading${testNum}`).style.display = show ? 'inline-block' : 'none';
            document.getElementById(`text${testNum}`).style.opacity = show ? '0.5' : '1';
        }

        // æ˜¾ç¤ºæµ‹è¯•ç»“æœ
        function showResult(testNum, result, isSuccess = true) {
            const resultBox = document.getElementById(`result${testNum}`);
            resultBox.className = `result-box ${isSuccess ? 'success' : 'error'}`;
            resultBox.innerHTML = `
                <span class="status-indicator ${isSuccess ? 'success' : 'error'}"></span>
                ${result}
            `;
        }

        // æµ‹è¯•1: æ´»åŠ¨åˆ›å»º
        window.testActivityCreation = async function() {
            showLoading(1, true);
            testResults.total++;
            
            try {
                const newActivity = await mockCreateActivity(testActivityData);
                
                if (newActivity && newActivity.id && newActivity.location) {
                    const result = `âœ… æ´»åŠ¨åˆ›å»ºæˆåŠŸï¼<br>
                    ID: ${newActivity.id}<br>
                    æ ‡é¢˜: ${newActivity.title}<br>
                    ä½ç½®: ${newActivity.location.name}<br>
                    åæ ‡: [${newActivity.location.coordinates[0]}, ${newActivity.location.coordinates[1]}]<br>
                    æŠ¥åæ—¶é—´: ${newActivity.enrollStartTime ? 'å·²è®¾ç½®' : 'æœªè®¾ç½®'}`;
                    
                    showResult(1, result, true);
                    testResults.passed++;
                } else {
                    throw new Error('æ´»åŠ¨åˆ›å»ºè¿”å›æ•°æ®ä¸å®Œæ•´');
                }
            } catch (error) {
                showResult(1, `âŒ æ´»åŠ¨åˆ›å»ºå¤±è´¥: ${error.message}`, false);
                testResults.failed++;
            }
            
            showLoading(1, false);
            updateStats();
        };

        // æµ‹è¯•2: çŠ¶æ€è®¡ç®—
        window.testStatusCalculation = async function() {
            showLoading(2, true);
            testResults.total++;
            
            try {
                // åˆ›å»ºä¸€ä¸ªæµ‹è¯•æ´»åŠ¨
                const testActivity = {
                    ...testActivityData,
                    startTime: new Date(Date.now() + 2 * 60 * 60 * 1000).toISOString(),
                    endTime: new Date(Date.now() + 4 * 60 * 60 * 1000).toISOString()
                };
                
                const status = calculateActivityStatus(testActivity);
                
                if (status && typeof status === 'string') {
                    const result = `âœ… çŠ¶æ€è®¡ç®—æˆåŠŸï¼<br>
                    å½“å‰æ—¶é—´: ${new Date().toLocaleString()}<br>
                    æ´»åŠ¨å¼€å§‹: ${new Date(testActivity.startTime).toLocaleString()}<br>
                    è®¡ç®—çŠ¶æ€: ${status}<br>
                    çŠ¶æ€ç±»å‹: ${typeof status}`;
                    
                    showResult(2, result, true);
                    testResults.passed++;
                } else {
                    throw new Error('çŠ¶æ€è®¡ç®—è¿”å›å€¼æ— æ•ˆ');
                }
            } catch (error) {
                showResult(2, `âŒ çŠ¶æ€è®¡ç®—å¤±è´¥: ${error.message}`, false);
                testResults.failed++;
            }
            
            showLoading(2, false);
            updateStats();
        };

        // æµ‹è¯•3: ä½ç½®ä¿¡æ¯
        window.testLocationInfo = async function() {
            showLoading(3, true);
            testResults.total++;
            
            try {
                const newActivity = await mockCreateActivity(testActivityData);
                const activityDetail = await mockGetActivityDetail(newActivity.id);
                
                if (activityDetail && activityDetail.location && activityDetail.location.coordinates) {
                    const coords = activityDetail.location.coordinates;
                    const isValidCoords = Array.isArray(coords) && coords.length === 2 && 
                                       typeof coords[0] === 'number' && typeof coords[1] === 'number';
                    
                    if (isValidCoords) {
                        const result = `âœ… ä½ç½®ä¿¡æ¯æµ‹è¯•æˆåŠŸï¼<br>
                        åœ°ç‚¹åç§°: ${activityDetail.location.name}<br>
                        è¯¦ç»†åœ°å€: ${activityDetail.location.address}<br>
                        ç»åº¦: ${coords[0]}<br>
                        çº¬åº¦: ${coords[1]}<br>
                        åæ ‡æ ¼å¼: æ­£ç¡®`;
                        
                        showResult(3, result, true);
                        testResults.passed++;
                    } else {
                        throw new Error('åæ ‡æ•°æ®æ ¼å¼ä¸æ­£ç¡®');
                    }
                } else {
                    throw new Error('ä½ç½®ä¿¡æ¯è·å–å¤±è´¥');
                }
            } catch (error) {
                showResult(3, `âŒ ä½ç½®ä¿¡æ¯æµ‹è¯•å¤±è´¥: ${error.message}`, false);
                testResults.failed++;
            }
            
            showLoading(3, false);
            updateStats();
        };

        // æµ‹è¯•4: åˆ—è¡¨è·å–
        window.testActivityList = async function() {
            showLoading(4, true);
            testResults.total++;
            
            try {
                // å…ˆåˆ›å»ºä¸€ä¸ªæ–°æ´»åŠ¨
                const newActivity = await mockCreateActivity(testActivityData);
                
                // è·å–æ´»åŠ¨åˆ—è¡¨
                const activities = await mockGetActivityList();
                
                if (Array.isArray(activities)) {
                    const foundNewActivity = activities.find(a => a.id === newActivity.id);
                    
                    if (foundNewActivity) {
                        const result = `âœ… åˆ—è¡¨è·å–æµ‹è¯•æˆåŠŸï¼<br>
                        æ€»æ´»åŠ¨æ•°: ${activities.length}<br>
                        æ–°æ´»åŠ¨ID: ${foundNewActivity.id}<br>
                        æ–°æ´»åŠ¨æ ‡é¢˜: ${foundNewActivity.title}<br>
                        æ–°æ´»åŠ¨ä½ç½®: ${foundNewActivity.locationName || foundNewActivity.location?.name}<br>
                        åˆ—è¡¨åŒ…å«æ–°æ´»åŠ¨: æ˜¯`;
                        
                        showResult(4, result, true);
                        testResults.passed++;
                    } else {
                        throw new Error('æ–°åˆ›å»ºçš„æ´»åŠ¨æœªåœ¨åˆ—è¡¨ä¸­æ‰¾åˆ°');
                    }
                } else {
                    throw new Error('æ´»åŠ¨åˆ—è¡¨ä¸æ˜¯æ•°ç»„æ ¼å¼');
                }
            } catch (error) {
                showResult(4, `âŒ åˆ—è¡¨è·å–æµ‹è¯•å¤±è´¥: ${error.message}`, false);
                testResults.failed++;
            }
            
            showLoading(4, false);
            updateStats();
        };

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ¯ æ´»åŠ¨åŠŸèƒ½æµ‹è¯•é¡µé¢å·²åŠ è½½');
            console.log('ğŸ“Š å¯ç”¨æµ‹è¯•é¡¹ç›®: æ´»åŠ¨åˆ›å»ºã€çŠ¶æ€è®¡ç®—ã€ä½ç½®ä¿¡æ¯ã€åˆ—è¡¨è·å–');
        });
    </script>
</body>
</html>