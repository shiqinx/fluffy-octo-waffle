<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¿®æ”¹å¯†ç åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>
    <h1>ä¿®æ”¹å¯†ç åŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="test-container">
        <h2>æ­¥éª¤1: æ¨¡æ‹Ÿç™»å½•</h2>
        <p>ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®æ¨¡æ‹Ÿç”¨æˆ·ç™»å½•</p>
        <button class="test-button" onclick="simulateLogin()">æ¨¡æ‹Ÿç™»å½•</button>
        <button class="test-button" onclick="checkAuthStatus()">æ£€æŸ¥è®¤è¯çŠ¶æ€</button>
        <div id="auth-status"></div>
    </div>
    
    <div class="test-container">
        <h2>æ­¥éª¤2: è®¿é—®ä¿®æ”¹å¯†ç é¡µé¢</h2>
        <p>ç™»å½•åï¼Œç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®è®¿é—®ä¿®æ”¹å¯†ç é¡µé¢</p>
        <button class="test-button" onclick="goToChangePassword()">è®¿é—®ä¿®æ”¹å¯†ç é¡µé¢</button>
        <button class="test-button" onclick="goToSettings()">è®¿é—®è®¾ç½®é¡µé¢</button>
        <div id="navigation-status"></div>
    </div>
    
    <div class="test-container">
        <h2>æ­¥éª¤3: æµ‹è¯•ä¿®æ”¹å¯†ç åŠŸèƒ½</h2>
        <p>åœ¨ä¿®æ”¹å¯†ç é¡µé¢æµ‹è¯•ä»¥ä¸‹åŠŸèƒ½ï¼š</p>
        <ul>
            <li>å½“å‰å¯†ç éªŒè¯</li>
            <li>æ–°å¯†ç å¼ºåº¦æ£€æµ‹</li>
            <li>å¯†ç ç¡®è®¤åŒ¹é…</li>
            <li>è¡¨å•æäº¤</li>
            <li>æˆåŠŸæç¤º</li>
        </ul>
        <button class="test-button" onclick="testPasswordStrength()">æµ‹è¯•å¯†ç å¼ºåº¦æ£€æµ‹</button>
        <div id="password-test-status"></div>
    </div>
    
    <div class="test-container">
        <h2>æ­¥éª¤4: æ¸…ç†æµ‹è¯•æ•°æ®</h2>
        <p>æµ‹è¯•å®Œæˆåï¼Œæ¸…ç†æµ‹è¯•æ•°æ®</p>
        <button class="test-button" onclick="clearTestData()">æ¸…ç†æµ‹è¯•æ•°æ®</button>
        <div id="cleanup-status"></div>
    </div>

    <script>
        function showStatus(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="status ${type}">${message}</div>`;
        }
        
        function simulateLogin() {
            try {
                // æ¨¡æ‹Ÿç™»å½•æ•°æ®
                const mockToken = 'mock-jwt-token-' + Date.now();
                const mockUser = {
                    id: 1,
                    studentId: '2021001',
                    name: 'æµ‹è¯•ç”¨æˆ·',
                    email: 'test@example.com'
                };
                
                // å­˜å‚¨åˆ°localStorage
                localStorage.setItem('token', mockToken);
                localStorage.setItem('user', JSON.stringify(mockUser));
                localStorage.setItem('loginTime', Date.now().toString());
                
                showStatus('auth-status', 'âœ… æ¨¡æ‹Ÿç™»å½•æˆåŠŸï¼ç”¨æˆ·ä¿¡æ¯å·²ä¿å­˜ã€‚', 'success');
                console.log('æ¨¡æ‹Ÿç™»å½•æˆåŠŸ:', { mockToken, mockUser });
                
            } catch (error) {
                showStatus('auth-status', 'âŒ æ¨¡æ‹Ÿç™»å½•å¤±è´¥: ' + error.message, 'error');
            }
        }
        
        function checkAuthStatus() {
            try {
                const token = localStorage.getItem('token');
                const user = localStorage.getItem('user');
                const loginTime = localStorage.getItem('loginTime');
                
                if (token && user && loginTime) {
                    const currentTime = Date.now();
                    const loginTimestamp = parseInt(loginTime);
                    const fourHours = 4 * 60 * 60 * 1000;
                    
                    if (currentTime - loginTimestamp > fourHours) {
                        showStatus('auth-status', 'âš ï¸ Tokenå·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•', 'error');
                    } else {
                        const userData = JSON.parse(user);
                        showStatus('auth-status', 
                            `âœ… ç”¨æˆ·å·²ç™»å½•<br>
                            ç”¨æˆ·å: ${userData.name}<br>
                            å­¦å·: ${userData.studentId}<br>
                            Token: ${token.substring(0, 20)}...`, 
                            'success');
                    }
                } else {
                    showStatus('auth-status', 'âŒ ç”¨æˆ·æœªç™»å½•', 'error');
                }
            } catch (error) {
                showStatus('auth-status', 'âŒ æ£€æŸ¥è®¤è¯çŠ¶æ€å¤±è´¥: ' + error.message, 'error');
            }
        }
        
        function goToChangePassword() {
            try {
                const token = localStorage.getItem('token');
                if (!token) {
                    showStatus('navigation-status', 'âŒ è¯·å…ˆç™»å½•', 'error');
                    return;
                }
                
                showStatus('navigation-status', 'ğŸ”„ æ­£åœ¨è·³è½¬åˆ°ä¿®æ”¹å¯†ç é¡µé¢...', 'info');
                window.location.href = '/change-password';
                
            } catch (error) {
                showStatus('navigation-status', 'âŒ è·³è½¬å¤±è´¥: ' + error.message, 'error');
            }
        }
        
        function goToSettings() {
            try {
                const token = localStorage.getItem('token');
                if (!token) {
                    showStatus('navigation-status', 'âŒ è¯·å…ˆç™»å½•', 'error');
                    return;
                }
                
                showStatus('navigation-status', 'ğŸ”„ æ­£åœ¨è·³è½¬åˆ°è®¾ç½®é¡µé¢...', 'info');
                window.location.href = '/settings';
                
            } catch (error) {
                showStatus('navigation-status', 'âŒ è·³è½¬å¤±è´¥: ' + error.message, 'error');
            }
        }
        
        function testPasswordStrength() {
            const testCases = [
                { password: '123', expected: 'å¼±' },
                { password: 'password', expected: 'å¼±' },
                { password: 'Password123', expected: 'ä¸­' },
                { password: 'Password123!', expected: 'å¼º' },
                { password: 'P@ssw0rd2024!', expected: 'å¼º' }
            ];
            
            let results = [];
            testCases.forEach(testCase => {
                const strength = checkPasswordStrength(testCase.password);
                const result = `å¯†ç : "${testCase.password}" -> å¼ºåº¦: ${strength} (æœŸæœ›: ${testCase.expected})`;
                results.push(result);
            });
            
            showStatus('password-test-status', 
                'ğŸ” å¯†ç å¼ºåº¦æ£€æµ‹ç»“æœ:<br>' + results.join('<br>'), 
                'info');
        }
        
        function checkPasswordStrength(password) {
            if (!password) return '';
            
            let score = 0;
            
            // é•¿åº¦æ£€æŸ¥
            if (password.length >= 8) score++;
            if (password.length >= 12) score++;
            
            // å­—ç¬¦ç±»å‹æ£€æŸ¥
            if (/[a-z]/.test(password)) score++;
            if (/[A-Z]/.test(password)) score++;
            if (/[0-9]/.test(password)) score++;
            if (/[^A-Za-z0-9]/.test(password)) score++;
            
            if (score <= 2) return 'å¼±';
            if (score <= 4) return 'ä¸­';
            return 'å¼º';
        }
        
        function clearTestData() {
            try {
                localStorage.removeItem('token');
                localStorage.removeItem('user');
                localStorage.removeItem('loginTime');
                
                showStatus('cleanup-status', 'âœ… æµ‹è¯•æ•°æ®å·²æ¸…ç†', 'success');
                console.log('æµ‹è¯•æ•°æ®æ¸…ç†å®Œæˆ');
                
            } catch (error) {
                showStatus('cleanup-status', 'âŒ æ¸…ç†å¤±è´¥: ' + error.message, 'error');
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥è®¤è¯çŠ¶æ€
        window.onload = function() {
            checkAuthStatus();
        };
    </script>
</body>
</html>