<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç™»å½•å‚æ•°éªŒè¯æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .result { margin: 10px 0; padding: 10px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        input { margin: 5px; padding: 5px; }
        button { padding: 10px 15px; margin: 5px; }
        pre { background: #f8f9fa; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>ğŸ” ç™»å½•å‚æ•°éªŒè¯æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>æµ‹è¯•å‚æ•°ä¼ é€’</h2>
        <input type="text" id="studentId" value="20210001" placeholder="å­¦å·">
        <input type="password" id="password" value="123456" placeholder="å¯†ç ">
        <button onclick="testParameterFlow()">æµ‹è¯•å‚æ•°æµç¨‹</button>
        <div id="flowResult"></div>
    </div>

    <div class="test-section">
        <h2>ç›´æ¥æµ‹è¯•éªŒè¯å‡½æ•°</h2>
        <button onclick="testValidationDirectly()">ç›´æ¥æµ‹è¯•éªŒè¯</button>
        <div id="validationResult"></div>
    </div>

    <script type="module">
        import { validateLoginParams } from './src/utils/validation.js'
        import { login } from './src/api/auth.js'
        
        window.testParameterFlow = async function() {
            const studentId = document.getElementById('studentId').value
            const password = document.getElementById('password').value
            const resultDiv = document.getElementById('flowResult')
            
            resultDiv.innerHTML = '<div class="result">æµ‹è¯•ä¸­...</div>'
            
            try {
                console.log('ğŸ” æ­¥éª¤1: åŸå§‹å‚æ•°', { studentId, password })
                
                // æ­¥éª¤1: æ„é€ ä¼ é€’ç»™authStoreçš„å‚æ•°
                const credentials = { studentId, password, rememberMe: false }
                console.log('ğŸ” æ­¥éª¤2: ä¼ é€’ç»™éªŒè¯çš„å‚æ•°', credentials)
                
                // æ­¥éª¤2: éªŒè¯å‚æ•°
                const validatedCredentials = await validateLoginParams(credentials)
                console.log('âœ… æ­¥éª¤3: éªŒè¯åçš„å‚æ•°', validatedCredentials)
                
                // æ­¥éª¤3: è°ƒç”¨ç™»å½•API
                const loginResult = await login(validatedCredentials)
                console.log('âœ… æ­¥éª¤4: ç™»å½•ç»“æœ', loginResult)
                
                resultDiv.innerHTML = `<div class="result success">
                    <strong>å‚æ•°æµç¨‹æµ‹è¯•æˆåŠŸ!</strong><br>
                    <pre>åŸå§‹å‚æ•°: ${JSON.stringify({ studentId, password }, null, 2)}
éªŒè¯åå‚æ•°: ${JSON.stringify(validatedCredentials, null, 2)}
ç™»å½•ç»“æœ: ${JSON.stringify(loginResult, null, 2)}</pre>
                </div>`
            } catch (error) {
                console.error('âŒ å‚æ•°æµç¨‹æµ‹è¯•å¤±è´¥:', error)
                
                resultDiv.innerHTML = `<div class="result error">
                    <strong>å‚æ•°æµç¨‹æµ‹è¯•å¤±è´¥!</strong><br>
                    <pre>é”™è¯¯: ${error.message || error}
é”™è¯¯è¯¦æƒ…: ${error.stack || 'æ— å †æ ˆä¿¡æ¯'}</pre>
                </div>`
            }
        }
        
        window.testValidationDirectly = async function() {
            const studentId = document.getElementById('studentId').value
            const password = document.getElementById('password').value
            const resultDiv = document.getElementById('validationResult')
            
            resultDiv.innerHTML = '<div class="result">éªŒè¯ä¸­...</div>'
            
            try {
                console.log('ğŸ” ç›´æ¥éªŒè¯å‚æ•°', { studentId, password })
                
                const testCases = [
                    { studentId: '', password: '123456' },
                    { studentId: '20210001', password: '' },
                    { studentId: '20210001', password: '123456' },
                    { studentId: 'abc', password: '123456' },
                    { studentId: '20210001', password: '123' }
                ]
                
                let results = []
                
                for (const testCase of testCases) {
                    try {
                        const result = await validateLoginParams(testCase)
                        results.push({ input: testCase, result: 'âœ… æˆåŠŸ', data: result })
                    } catch (error) {
                        results.push({ input: testCase, result: 'âŒ å¤±è´¥', error: error.message })
                    }
                }
                
                resultDiv.innerHTML = `<div class="result success">
                    <strong>éªŒè¯æµ‹è¯•å®Œæˆ!</strong><br>
                    <pre>${JSON.stringify(results, null, 2)}</pre>
                </div>`
            } catch (error) {
                console.error('âŒ éªŒè¯æµ‹è¯•å¤±è´¥:', error)
                
                resultDiv.innerHTML = `<div class="result error">
                    <strong>éªŒè¯æµ‹è¯•å¤±è´¥!</strong><br>
                    <pre>${error.message || error}</pre>
                </div>`
            }
        }
    </script>
</body>
</html>