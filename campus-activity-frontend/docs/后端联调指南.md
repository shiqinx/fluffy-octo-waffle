# 后端联调指南

## 当前状态分析

### ✅ 前端准备情况
1. **API接口已统一**: 所有API已整合到 `src/api/index.js`
2. **参数验证已规范**: 创建了 `src/utils/validation.js` 统一验证规则
3. **错误处理已完善**: 创建了 `src/utils/errorHandler.js` 统一错误处理
4. **Mock模式可控**: 通过 `VITE_USE_MOCK` 环境变量控制

### ❌ 当前问题
1. **后端服务未启动**: `http://localhost:8080` 无法连接
2. **Mock模式仍启用**: `.env.development` 中 `VITE_USE_MOCK=true`

## 联调准备步骤

### 1. 确保后端服务运行
```bash
# 检查后端服务是否在8080端口运行
netstat -an | findstr :8080

# 或使用PowerShell
Get-NetTCPConnection | Where-Object {$_.LocalPort -eq 8080}
```

### 2. 配置环境变量
创建 `.env.backend` 文件（已创建）：
```env
VITE_USE_MOCK=false
VITE_API_BASE_URL=http://localhost:8080/api
VITE_AMAP_KEY=30b170859f00b71edbd631aab944129a
VITE_DEBUG=true
VITE_BACKEND_MODE=true
```

### 3. 启动前端联调模式
```bash
# 使用后端联调配置启动
npm run dev -- --mode backend

# 或者临时修改环境变量
$env:VITE_USE_MOCK="false"
$env:VITE_API_BASE_URL="http://localhost:8080/api"
npm run dev
```

## API接口规范

### 认证接口
```
POST /api/auth/login
Content-Type: application/json

{
  "username": "studentId",
  "password": "password"
}

响应格式:
{
  "code": 200,
  "message": "登录成功",
  "data": {
    "token": "jwt_token",
    "user": {
      "id": 1,
      "username": "studentId",
      "nickname": "昵称",
      "avatar": "头像URL"
    }
  }
}
```

### 活动接口
```
GET /api/activities
POST /api/activities
PUT /api/activities/{id}
DELETE /api/activities/{id}
POST /api/activities/{id}/join
POST /api/activities/{id}/leave
```

## 常见问题排查

### 1. CORS错误
后端需要配置CORS允许前端域名：
```java
@CrossOrigin(origins = "http://localhost:5173")
```

### 2. 参数格式不匹配
前端已实现参数格式转换，确保后端接收格式：
- 学号: `username` 或 `studentId`
- 密码: `password`
- 活动数据: 已转换为驼峰命名

### 3. 响应格式不统一
后端响应需遵循统一格式：
```json
{
  "code": 200,
  "message": "success",
  "data": {}
}
```

## 联调测试用例

### 登录测试
```javascript
// 前端调用
const result = await validatedApi.login({
  username: "2021001",
  password: "123456"
});

// 期望后端接收
POST /api/auth/login
{
  "username": "2021001",
  "password": "123456"
}
```

### 创建活动测试
```javascript
// 前端调用
const result = await validatedApi.createActivity({
  title: "测试活动",
  description: "活动描述",
  startTime: "2024-01-01T10:00:00Z",
  endTime: "2024-01-01T12:00:00Z",
  location: "活动地点",
  maxParticipants: 50
});
```

## 下一步行动

1. **启动后端服务**: 确保在8080端口运行
2. **切换环境配置**: 使用 `.env.backend` 配置
3. **测试基础接口**: 先测试登录和获取用户信息
4. **逐步验证功能**: 按模块测试各个API接口

## 监控和调试

### 前端调试
- 浏览器开发者工具 Network 面板
- Console 查看详细错误日志
- 使用 `VITE_DEBUG=true` 启用调试模式

### 后端调试
- 检查后端日志
- 验证数据库连接
- 确认API路由配置

---

**结论**: 前端已完全准备好与后端联调，主要问题在于后端服务未启动。一旦后端服务正常运行，联调应该能够成功。