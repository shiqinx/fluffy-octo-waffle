<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¼ºåˆ¶åˆ·æ–°éªŒè¯ä¿®å¤</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .activity-item {
            padding: 15px;
            margin: 10px 0;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            background: #fafafa;
        }
        .activity-item:hover {
            border-color: #007bff;
            background: #e3f2fd;
            transform: translateY(-2px);
        }
        .test-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        .test-btn:hover {
            background: #0056b3;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ”§ å¼ºåˆ¶åˆ·æ–°éªŒè¯ä¿®å¤æ•ˆæœ</h1>
        <div class="warning">
            <strong>é‡è¦æç¤ºï¼š</strong><br>
            1. è¯·å…ˆæŒ‰ <strong>Ctrl+F5</strong> å¼ºåˆ¶åˆ·æ–°ä¸»åº”ç”¨é¡µé¢<br>
            2. æˆ–è€…æŒ‰ <strong>F12</strong> æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼Œå³é”®åˆ·æ–°æŒ‰é’®é€‰æ‹©"æ¸…ç©ºç¼“å­˜å¹¶ç¡¬æ€§é‡æ–°åŠ è½½"<br>
            3. ç„¶åå†å›æ¥æµ‹è¯•
        </div>
        
        <button class="test-btn" onclick="testAllActivities()">ğŸ§ª æµ‹è¯•æ‰€æœ‰æ´»åŠ¨</button>
        <button class="test-btn" onclick="clearCache()">ğŸ—‘ï¸ æ¸…é™¤æœ¬åœ°ç¼“å­˜</button>
        <button class="test-btn" onclick="checkCurrentPage()">ğŸ“‹ æ£€æŸ¥å½“å‰é¡µé¢</button>
        <button class="test-btn" onclick="forceReload()">ğŸ”„ å¼ºåˆ¶é‡æ–°åŠ è½½</button>
        
        <div id="log" class="log">ç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•...</div>
    </div>

    <div class="test-container">
        <h2>ğŸ“‹ æ´»åŠ¨åˆ—è¡¨ï¼ˆç‚¹å‡»æµ‹è¯•è¯¦æƒ…ï¼‰</h2>
        <div id="activity-list"></div>
    </div>

    <script>
        // æ¨¡æ‹Ÿæ­£ç¡®çš„æ´»åŠ¨æ•°æ®
        const correctActivities = [
            {
                id: "1",
                title: "ä¸­åŒ»å…»ç”Ÿè®²åº§",
                type: "lecture",
                description: "ä¸“ä¸šä¸­åŒ»å¸ˆè®²è§£æ—¥å¸¸å…»ç”ŸçŸ¥è¯†",
                time: "2024-01-15 14:00",
                location: "æ•™å­¦æ¥¼A101",
                organizer: "å¼ æ•™æˆ",
                image: "https://via.placeholder.com/300x200/4CAF50/ffffff?text=ä¸­åŒ»å…»ç”Ÿ"
            },
            {
                id: "2", 
                title: "ç¯®çƒå‹è°Šèµ›",
                type: "sports",
                description: "é™¢ç³»é—´ç¯®çƒäº¤æµæ¯”èµ›",
                time: "2024-01-16 16:00",
                location: "ä½“è‚²é¦†",
                organizer: "ä½“è‚²éƒ¨",
                image: "https://via.placeholder.com/300x200/2196F3/ffffff?text=ç¯®çƒèµ›"
            },
            {
                id: "3",
                title: "è‹±è¯­è§’æ´»åŠ¨",
                type: "academic",
                description: "è‹±è¯­å£è¯­ç»ƒä¹ äº¤æµæ´»åŠ¨",
                time: "2024-01-17 19:00", 
                location: "å¤–è¯­æ¥¼201",
                organizer: "è‹±è¯­åä¼š",
                image: "https://via.placeholder.com/300x200/FF9800/ffffff?text=è‹±è¯­è§’"
            },
            {
                id: "4",
                title: "ç¼–ç¨‹é©¬æ‹‰æ¾",
                type: "competition",
                description: "24å°æ—¶ç¼–ç¨‹æŒ‘æˆ˜èµ›",
                time: "2024-01-18 09:00",
                location: "è®¡ç®—æœºå®éªŒå®¤",
                organizer: "è®¡ç®—æœºåä¼š", 
                image: "https://via.placeholder.com/300x200/9C27B0/ffffff?text=ç¼–ç¨‹é©¬æ‹‰æ¾"
            },
            {
                id: "5",
                title: "å¿—æ„¿è€…æ‹›å‹Ÿ",
                type: "volunteer",
                description: "ç¤¾åŒºæœåŠ¡å¿—æ„¿è€…æ‹›å‹Ÿæ´»åŠ¨",
                time: "2024-01-19 14:00",
                location: "å­¦ç”Ÿæ´»åŠ¨ä¸­å¿ƒ",
                organizer: "å¿—æ„¿è€…åä¼š",
                image: "https://via.placeholder.com/300x200/F44336/ffffff?text=å¿—æ„¿è€…"
            },
            {
                id: "6",
                title: "æ‘„å½±å±•è§ˆ",
                type: "cultural",
                description: "æ ¡å›­æ‘„å½±ä½œå“å±•è§ˆ",
                time: "2024-01-20 10:00",
                location: "è‰ºæœ¯é¦†",
                organizer: "æ‘„å½±åä¼š",
                image: "https://via.placeholder.com/300x200/00BCD4/ffffff?text=æ‘„å½±å±•"
            }
        ];

        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : type === 'warning' ? 'warning' : '';
            logDiv.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function renderActivityList() {
            const listDiv = document.getElementById('activity-list');
            listDiv.innerHTML = '';
            
            correctActivities.forEach(activity => {
                const item = document.createElement('div');
                item.className = 'activity-item';
                item.innerHTML = `
                    <h3>${activity.title}</h3>
                    <p><strong>ID:</strong> ${activity.id} | <strong>ç±»å‹:</strong> ${activity.type}</p>
                    <p><strong>æ—¶é—´:</strong> ${activity.time}</p>
                    <p><strong>åœ°ç‚¹:</strong> ${activity.location}</p>
                    <p><strong>æè¿°:</strong> ${activity.description}</p>
                `;
                item.onclick = () => testActivityDetail(activity);
                listDiv.appendChild(item);
            });
        }

        function testActivityDetail(activity) {
            log(`ğŸ” æµ‹è¯•æ´»åŠ¨: ${activity.title} (ID: ${activity.id})`);
            
            // æ¨¡æ‹Ÿä¿®å¤åçš„æŸ¥æ‰¾é€»è¾‘
            const foundActivity = correctActivities.find(act => String(act.id) === String(activity.id));
            
            if (foundActivity) {
                log(`âœ… æ‰¾åˆ°æ´»åŠ¨: ${foundActivity.title}`, 'success');
                log(`ğŸ“ è·³è½¬é“¾æ¥åº”ä¸º: /activity/${activity.id}`);
                
                // å°è¯•åœ¨æ–°çª—å£æ‰“å¼€è¯¦æƒ…é¡µ
                const detailUrl = `/activity/${activity.id}`;
                log(`ğŸŒ æ­£åœ¨å°è¯•æ‰“å¼€: ${detailUrl}`);
                
                // æ£€æŸ¥æ˜¯å¦å¯ä»¥è®¿é—®
                fetch(detailUrl)
                    .then(response => {
                        if (response.ok) {
                            log(`âœ… é¡µé¢å¯è®¿é—®: ${detailUrl}`, 'success');
                            log(`ğŸ‘‰ è¯·æ‰‹åŠ¨åœ¨æ–°çª—å£ä¸­éªŒè¯æ˜¾ç¤ºå†…å®¹æ˜¯å¦ä¸º: ${foundActivity.title}`);
                        } else {
                            log(`âš ï¸ é¡µé¢å“åº”çŠ¶æ€: ${response.status}`, 'warning');
                        }
                    })
                    .catch(error => {
                        log(`âŒ æ— æ³•è®¿é—®é¡µé¢: ${error.message}`, 'error');
                    });
            } else {
                log(`âŒ æœªæ‰¾åˆ°æ´»åŠ¨: ${activity.title}`, 'error');
            }
        }

        function testAllActivities() {
            log('ğŸ§ª å¼€å§‹æµ‹è¯•æ‰€æœ‰æ´»åŠ¨...');
            let successCount = 0;
            let totalCount = correctActivities.length;
            
            correctActivities.forEach((activity, index) => {
                setTimeout(() => {
                    const foundActivity = correctActivities.find(act => String(act.id) === String(activity.id));
                    if (foundActivity && foundActivity.title === activity.title) {
                        successCount++;
                        log(`âœ… æ´»åŠ¨ ${index + 1}: ${activity.title} - æ­£å¸¸`, 'success');
                    } else {
                        log(`âŒ æ´»åŠ¨ ${index + 1}: ${activity.title} - å¤±è´¥`, 'error');
                    }
                    
                    if (index === totalCount - 1) {
                        log(`ğŸ“Š æµ‹è¯•å®Œæˆ: ${successCount}/${totalCount} æˆåŠŸ`, 
                            successCount === totalCount ? 'success' : 'error');
                    }
                }, index * 200);
            });
        }

        function clearCache() {
            log('ğŸ—‘ï¸ æ¸…é™¤ç¼“å­˜ä¸­...');
            
            // æ¸…é™¤localStorage
            localStorage.clear();
            log('âœ… localStorage å·²æ¸…é™¤');
            
            // æ¸…é™¤sessionStorage
            sessionStorage.clear();
            log('âœ… sessionStorage å·²æ¸…é™¤');
            
            // å°è¯•æ¸…é™¤service workerç¼“å­˜
            if ('caches' in window) {
                caches.keys().then(cacheNames => {
                    cacheNames.forEach(cacheName => {
                        caches.delete(cacheName);
                    });
                    log('âœ… Service Worker ç¼“å­˜å·²æ¸…é™¤');
                });
            }
            
            log('ğŸ”„ ç¼“å­˜æ¸…é™¤å®Œæˆï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•', 'success');
        }

        function checkCurrentPage() {
            log('ğŸ“‹ æ£€æŸ¥å½“å‰é¡µé¢çŠ¶æ€...');
            
            const currentUrl = window.location.href;
            const path = window.location.pathname;
            
            log(`ğŸ“ å½“å‰URL: ${currentUrl}`);
            log(`ğŸ“ å½“å‰è·¯å¾„: ${path}`);
            
            // æ£€æŸ¥æ˜¯å¦åœ¨æ´»åŠ¨è¯¦æƒ…é¡µ
            const activityMatch = path.match(/\/activity\/(\d+)/);
            if (activityMatch) {
                const activityId = activityMatch[1];
                log(`ğŸ¯ æ£€æµ‹åˆ°æ´»åŠ¨è¯¦æƒ…é¡µï¼Œæ´»åŠ¨ID: ${activityId}`);
                
                // æŸ¥æ‰¾å¯¹åº”çš„æ´»åŠ¨
                const activity = correctActivities.find(act => String(act.id) === String(activityId));
                if (activity) {
                    log(`ğŸ“ åº”è¯¥æ˜¾ç¤ºçš„æ´»åŠ¨: ${activity.title}`, 'success');
                } else {
                    log(`âŒ æœªæ‰¾åˆ°IDä¸º ${activityId} çš„æ´»åŠ¨`, 'error');
                }
                
                // æ£€æŸ¥é¡µé¢æ ‡é¢˜
                setTimeout(() => {
                    const titleElement = document.querySelector('h1, .activity-title, .title');
                    if (titleElement) {
                        const pageTitle = titleElement.textContent.trim();
                        log(`ğŸ·ï¸ é¡µé¢æ ‡é¢˜æ˜¾ç¤º: "${pageTitle}"`);
                        
                        if (activity && pageTitle.includes(activity.title)) {
                            log(`âœ… æ ‡é¢˜åŒ¹é…æ­£ç¡®ï¼`, 'success');
                        } else if (pageTitle.includes('ä¸­åŒ»å…»ç”Ÿè®²åº§')) {
                            log(`âŒ æ ‡é¢˜ä»ç„¶æ˜¾ç¤º"ä¸­åŒ»å…»ç”Ÿè®²åº§"ï¼Œä¿®å¤æœªç”Ÿæ•ˆï¼`, 'error');
                            log('ğŸ”§ è¯·å°è¯•ä»¥ä¸‹è§£å†³æ–¹æ¡ˆï¼š', 'warning');
                            log('1. æŒ‰ Ctrl+F5 å¼ºåˆ¶åˆ·æ–°é¡µé¢');
                            log('2. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜');
                            log('3. é‡å¯å¼€å‘æœåŠ¡å™¨');
                            log('4. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯');
                        } else {
                            log(`âš ï¸ æ ‡é¢˜ä¸åŒ¹é…ï¼Œæ˜¾ç¤ºä¸º: "${pageTitle}"`, 'warning');
                        }
                    } else {
                        log('âŒ æœªæ‰¾åˆ°é¡µé¢æ ‡é¢˜å…ƒç´ ', 'error');
                    }
                }, 1000);
            } else {
                log('â„¹ï¸ å½“å‰ä¸åœ¨æ´»åŠ¨è¯¦æƒ…é¡µ');
            }
        }

        function forceReload() {
            log('ğŸ”„ å¼ºåˆ¶é‡æ–°åŠ è½½é¡µé¢...');
            window.location.reload(true);
        }

        // åˆå§‹åŒ–
        renderActivityList();
        log('ğŸš€ å¼ºåˆ¶åˆ·æ–°éªŒè¯é¡µé¢å·²åŠ è½½', 'success');
        log('ğŸ’¡ å¦‚æœä¿®å¤ä»æœªç”Ÿæ•ˆï¼Œè¯·å°è¯•ä»¥ä¸‹æ­¥éª¤ï¼š', 'warning');
        log('1. åœ¨ä¸»åº”ç”¨é¡µé¢æŒ‰ Ctrl+F5 å¼ºåˆ¶åˆ·æ–°');
        log('2. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜');
        log('3. é‡å¯å¼€å‘æœåŠ¡å™¨ (npm run dev)');
        log('4. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°çš„ç½‘ç»œè¯·æ±‚');
    </script>
</body>
</html>