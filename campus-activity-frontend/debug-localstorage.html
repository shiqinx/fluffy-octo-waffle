<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è°ƒè¯•localStorageæ•°æ®</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 1200px; margin: 0 auto; }
        .section { background: #f5f5f5; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .btn { background: #1890ff; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin: 5px; }
        .btn:hover { background: #40a9ff; }
        pre { background: #f0f0f0; padding: 10px; border-radius: 4px; overflow-x: auto; }
        .error { color: red; }
        .success { color: green; }
        .info { color: blue; }
    </style>
</head>
<body>
    <h1>ğŸ” localStorageæ•°æ®è°ƒè¯•</h1>
    
    <div class="section">
        <h2>å½“å‰localStorageçŠ¶æ€</h2>
        <button class="btn" onclick="checkAllKeys()">æ£€æŸ¥æ‰€æœ‰localStorageæ•°æ®</button>
        <button class="btn" onclick="checkActivitiesData()">æ£€æŸ¥æ´»åŠ¨æ•°æ®</button>
        <button class="btn" onclick="clearAllData()">æ¸…ç†æ‰€æœ‰æ•°æ®</button>
        <button class="btn" onclick="forceDefaultData()">å¼ºåˆ¶è®¾ç½®é»˜è®¤æ•°æ®</button>
    </div>

    <div id="output"></div>

    <script>
        function log(message, type = 'info') {
            const output = document.getElementById('output');
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : 'info';
            output.innerHTML += `<div class="${className}">${new Date().toLocaleTimeString()}: ${message}</div>`;
        }

        function checkAllKeys() {
            log('=== æ£€æŸ¥æ‰€æœ‰localStorageé”®å€¼å¯¹ ===');
            const keys = Object.keys(localStorage);
            log(`å‘ç° ${keys.length} ä¸ªé”®:`, 'info');
            
            keys.forEach(key => {
                try {
                    const value = localStorage.getItem(key);
                    const parsed = JSON.parse(value);
                    log(`é”®: ${key}, ç±»å‹: ${Array.isArray(parsed) ? 'æ•°ç»„(' + parsed.length + 'é¡¹)' : typeof parsed}, å¤§å°: ${value.length} å­—ç¬¦`, 'success');
                } catch (e) {
                    log(`é”®: ${key}, åŸå§‹å€¼: ${value.substring(0, 100)}...`, 'info');
                }
            });
        }

        function checkActivitiesData() {
            log('=== æ£€æŸ¥æ´»åŠ¨æ•°æ®è¯¦æƒ… ===');
            const activitiesData = localStorage.getItem('campus_activities');
            
            if (!activitiesData) {
                log('âŒ æ²¡æœ‰æ‰¾åˆ°campus_activitiesæ•°æ®', 'error');
                return;
            }
            
            try {
                const activities = JSON.parse(activitiesData);
                log(`âœ… æˆåŠŸè§£ææ´»åŠ¨æ•°æ®ï¼Œå…± ${activities.length} ä¸ªæ´»åŠ¨`, 'success');
                
                activities.forEach((activity, index) => {
                    log(`æ´»åŠ¨ ${index + 1}: ID=${activity.id}, æ ‡é¢˜=${activity.title}, ç±»å‹=${activity.type || activity.category}`, 'success');
                });
                
                // æ£€æŸ¥æ˜¯å¦æœ‰IDå¤§äº6çš„æ´»åŠ¨ï¼ˆæ–°åˆ›å»ºçš„æ´»åŠ¨ï¼‰
                const newActivities = activities.filter(a => a.id > 6);
                if (newActivities.length > 0) {
                    log(`ğŸ‰ å‘ç° ${newActivities.length} ä¸ªæ–°åˆ›å»ºçš„æ´»åŠ¨ï¼`, 'success');
                    newActivities.forEach(activity => {
                        log(`æ–°æ´»åŠ¨: ${activity.title} (ID: ${activity.id})`, 'success');
                    });
                } else {
                    log('âš ï¸ æ²¡æœ‰å‘ç°æ–°åˆ›å»ºçš„æ´»åŠ¨ï¼ˆID > 6ï¼‰', 'info');
                }
                
            } catch (error) {
                log(`âŒ è§£ææ´»åŠ¨æ•°æ®å¤±è´¥: ${error.message}`, 'error');
                log(`åŸå§‹æ•°æ®: ${activitiesData.substring(0, 200)}...`, 'error');
            }
        }

        function clearAllData() {
            if (confirm('ç¡®å®šè¦æ¸…ç†æ‰€æœ‰localStorageæ•°æ®å—ï¼Ÿ')) {
                localStorage.clear();
                log('âœ… å·²æ¸…ç†æ‰€æœ‰localStorageæ•°æ®', 'success');
            }
        }

        function forceDefaultData() {
            const defaultActivities = [
                {
                    id: 1,
                    title: 'ä¸­åŒ»å…»ç”Ÿè®²åº§',
                    type: 'study',
                    category: 'study',
                    locationName: 'å­¦æœ¯æŠ¥å‘Šå…',
                    description: 'é‚€è¯·ä¸­åŒ»ä¸“å®¶è®²è§£ä¸­åŒ»å…»ç”ŸçŸ¥è¯†ï¼Œåˆ†äº«ä¼ ç»Ÿä¿å¥æ–¹æ³•ã€‚',
                    startTime: new Date(Date.now() + 2 * 24 * 60 * 60 * 1000).toISOString(),
                    endTime: new Date(Date.now() + 2 * 24 * 60 * 60 * 1000 + 2 * 60 * 60 * 1000).toISOString(),
                    currentParticipants: 15,
                    maxParticipants: 30,
                    organizer: { id: 2, name: 'ä¸­åŒ»å­¦é™¢', creditScore: 98 },
                    distance: 0.8,
                    isEnrolled: false,
                    status: 'open'
                },
                {
                    id: 2,
                    title: 'æ‘„å½±ä½œå“å±•è§ˆ',
                    type: 'culture',
                    category: 'culture',
                    locationName: 'è‰ºæœ¯å±•å…',
                    description: 'å±•ç¤ºå­¦ç”Ÿæ‘„å½±ä½œå“ï¼Œåˆ†äº«æ‘„å½±æŠ€å·§ï¼Œäº¤æµåˆ›ä½œå¿ƒå¾—ã€‚',
                    startTime: new Date(Date.now() + 3 * 24 * 60 * 60 * 1000).toISOString(),
                    endTime: new Date(Date.now() + 3 * 24 * 60 * 60 * 1000 + 3 * 60 * 60 * 1000).toISOString(),
                    currentParticipants: 12,
                    maxParticipants: 25,
                    organizer: { id: 3, name: 'æ‘„å½±åä¼š', creditScore: 92 },
                    distance: 0.3,
                    isEnrolled: false,
                    status: 'open'
                }
            ];
            
            localStorage.setItem('campus_activities', JSON.stringify(defaultActivities));
            log('âœ… å·²å¼ºåˆ¶è®¾ç½®é»˜è®¤æ´»åŠ¨æ•°æ®', 'success');
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
        window.onload = function() {
            checkAllKeys();
            checkActivitiesData();
        };
    </script>
</body>
</html>